<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 44 Informes reproducibles con R Markdown y Quarto | Fundamentos de ciencia de datos con R</title>
<meta name="author" content="Gema Fernández-Avilés y José-María Montero">
<meta name="description" content="Emilio L. Cano Universidad Rey Juan Carlos  44.1 ¿Por qué informes reproducibles?  El resultado final de un proyecto de análisis de datos terminará comunicándose a distintos niveles, tanto aguas...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Capítulo 44 Informes reproducibles con R Markdown y Quarto | Fundamentos de ciencia de datos con R">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/cover.png">
<meta property="og:description" content="Emilio L. Cano Universidad Rey Juan Carlos  44.1 ¿Por qué informes reproducibles?  El resultado final de un proyecto de análisis de datos terminará comunicándose a distintos niveles, tanto aguas...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 44 Informes reproducibles con R Markdown y Quarto | Fundamentos de ciencia de datos con R">
<meta name="twitter:description" content="Emilio L. Cano Universidad Rey Juan Carlos  44.1 ¿Por qué informes reproducibles?  El resultado final de un proyecto de análisis de datos terminará comunicándose a distintos niveles, tanto aguas...">
<meta name="twitter:image" content="/img/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="bs4_book.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentos de ciencia de datos con R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
</form>

      <nav aria-label="Contenido"><h2>Contenido</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Ciencia, datos, software… y científicos</li>
<li><a class="" href="ciencia-datos.html"><span class="header-section-number">1</span> ¿Es la ciencia de datos una ciencia?</a></li>
<li><a class="" href="metodologia.html"><span class="header-section-number">2</span> Metodología en ciencia de datos</a></li>
<li><a class="" href="ch-110003.html"><span class="header-section-number">3</span> R para ciencia de datos</a></li>
<li><a class="" href="cap-etica.html"><span class="header-section-number">4</span> Ética en la ciencia de datos</a></li>
<li class="book-part">Bienvenidos a la jungla de datos</li>
<li><a class="" href="datos-sql.html"><span class="header-section-number">5</span> Gestión de bases de datos relacionales</a></li>
<li><a class="" href="cap-nosql.html"><span class="header-section-number">6</span> Gestión de bases de datos NoSQL</a></li>
<li><a class="" href="DGDQM.html"><span class="header-section-number">7</span> Gobierno, gestión y calidad del dato</a></li>
<li><a class="" href="id_130009.html"><span class="header-section-number">8</span> Integración y limpieza de datos</a></li>
<li><a class="" href="chap-feature.html"><span class="header-section-number">9</span> Selección y transformación de variables</a></li>
<li><a class="" href="chap-herramientas.html"><span class="header-section-number">10</span> Herramientas para el análisis en ciencia de datos</a></li>
<li><a class="" href="id_120006-aed.html"><span class="header-section-number">11</span> Análisis exploratorio de datos</a></li>
<li class="book-part">Fundamentos de estadística</li>
<li><a class="" href="Funda-probab.html"><span class="header-section-number">12</span> Probabilidad</a></li>
<li><a class="" href="Fundainfer.html"><span class="header-section-number">13</span> Inferencia estadística</a></li>
<li><a class="" href="muestreo.html"><span class="header-section-number">14</span> Muestreo y remuestreo</a></li>
<li class="book-part">Modelización estadística</li>
<li><a class="" href="cap-lm.html"><span class="header-section-number">15</span> Modelización lineal</a></li>
<li><a class="" href="cap-glm.html"><span class="header-section-number">16</span> Modelos lineales generalizados</a></li>
<li><a class="" href="cap-gam.html"><span class="header-section-number">17</span> Modelos aditivos generalizados</a></li>
<li><a class="" href="cap-mxm.html"><span class="header-section-number">18</span> Modelos mixtos</a></li>
<li><a class="" href="cap-sparse.html"><span class="header-section-number">19</span> Modelos sparse y métodos penalizados de regresión</a></li>
<li><a class="" href="cap-series-temp.html"><span class="header-section-number">20</span> Modelización de series temporales</a></li>
<li><a class="" href="cap-discriminante.html"><span class="header-section-number">21</span> Análisis discriminante</a></li>
<li><a class="" href="cap-conjunto.html"><span class="header-section-number">22</span> Análisis conjunto</a></li>
<li><a class="" href="tablas-contingencia.html"><span class="header-section-number">23</span> Análisis de tablas de contingencia</a></li>
<li class="book-part">Machine learning supervisado</li>
<li><a class="" href="cap-arboles.html"><span class="header-section-number">24</span> Árboles de clasificación y regresión</a></li>
<li><a class="" href="cap-svm.html"><span class="header-section-number">25</span> Máquinas de vector soporte</a></li>
<li><a class="" href="cap-knn.html"><span class="header-section-number">26</span> Clasificador k-vecinos más próximos</a></li>
<li><a class="" href="cap-naive-bayes.html"><span class="header-section-number">27</span> Naive Bayes</a></li>
<li><a class="" href="cap-bagg-rf.html"><span class="header-section-number">28</span> Métodos ensamblados: bagging y random forest</a></li>
<li><a class="" href="cap-boosting-xgboost.html"><span class="header-section-number">29</span> Boosting y el algoritmo XGBoost</a></li>
<li class="book-part">Machine learning no supervisado</li>
<li><a class="" href="jerarquico.html"><span class="header-section-number">30</span> Análisis cluster: clusterización jerárquica</a></li>
<li><a class="" href="no-jerarquico.html"><span class="header-section-number">31</span> Análisis cluster: clusterización no jerárquica</a></li>
<li><a class="" href="acp.html"><span class="header-section-number">32</span> Análisis de componentes principales</a></li>
<li><a class="" href="an%C3%A1lisis-factorial.html"><span class="header-section-number">33</span> Análisis factorial</a></li>
<li><a class="" href="escalamiento-multidimensional.html"><span class="header-section-number">34</span> Escalamiento multidimensional</a></li>
<li><a class="" href="correspondencias.html"><span class="header-section-number">35</span> Análisis de correspondencias</a></li>
<li class="book-part">Deep learning</li>
<li><a class="" href="capNN.html"><span class="header-section-number">36</span> Redes neuronales artificiales</a></li>
<li><a class="" href="cap-redes-convol.html"><span class="header-section-number">37</span> Redes neuronales convolucionales</a></li>
<li class="book-part">Ciencia de datos de texto y redes</li>
<li><a class="" href="mineria-textos.html"><span class="header-section-number">38</span> Minería de textos</a></li>
<li><a class="" href="grafos.html"><span class="header-section-number">39</span> Análisis de grafos y redes sociales</a></li>
<li class="book-part">Ciencia de datos espaciales</li>
<li><a class="" href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></li>
<li><a class="" href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="" href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li><a class="" href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></li>
<li class="book-part">Comunica y colabora</li>
<li><a class="active" href="id_120007-informes.html"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></li>
<li><a class="" href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></li>
<li><a class="" href="geoproces.html"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li class="book-part">Casos de estudio en ciencia de datos</li>
<li><a class="" href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></li>
<li><a class="" href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></li>
<li><a class="" href="cap-twitter.html"><span class="header-section-number">50</span> ¿Cómo twitea Elon Musk?</a></li>
<li><a class="" href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de Rstudio a su periódico</a></li>
<li><a class="" href="paro-clm.html"><span class="header-section-number">52</span> Crisis: impacto en el paro de Castilla-La Mancha</a></li>
<li><a class="" href="cap-rfm.html"><span class="header-section-number">53</span> Segmentación de clientes en el comerico minorista</a></li>
<li><a class="" href="cap-medicina.html"><span class="header-section-number">54</span> Análisis de datos en medicina</a></li>
<li><a class="" href="cap-futbol.html"><span class="header-section-number">55</span> Messi y Ronaldo: dos ídolos desde la perspectiva de los datos</a></li>
<li><a class="" href="cambioclimatico.html"><span class="header-section-number">56</span> Un dato sobre el cambio climático</a></li>
<li><a class="" href="cap-ree.html"><span class="header-section-number">57</span> Predicción de consumo eléctrico con redes neuronales</a></li>
<li><a class="" href="cap-sist-exp.html"><span class="header-section-number">58</span> Implementación de un sistema experto en el ámbito pediátrico</a></li>
<li><a class="" href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></li>
<li><a class="" href="cap-fraude.html"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></li>
<li><a class="" href="referncias.html">Referncias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="id_120007-informes" class="section level1" number="44">
<h1>
<span class="header-section-number">Capítulo 44</span> Informes reproducibles con R Markdown y Quarto<a class="anchor" aria-label="anchor" href="#id_120007-informes"><i class="fas fa-link"></i></a>
</h1>
<p><em>Emilio L. Cano</em></p>
<p>Universidad Rey Juan Carlos</p>
<div id="por-qué-informes-reproducibles" class="section level2" number="44.1">
<h2>
<span class="header-section-number">44.1</span> ¿Por qué informes reproducibles?<a class="anchor" aria-label="anchor" href="#por-qu%C3%A9-informes-reproducibles"><i class="fas fa-link"></i></a>
</h2>
<p>
El resultado final de un proyecto de análisis de datos terminará
comunicándose a distintos niveles, tanto <em>aguas arriba</em> como <em>aguas abajo</em>.
Esta comunicación es “la última milla” del flujo de análisis que se
esquematizaba en la Fig. <a href="#fig:problem2"><strong>??</strong></a>. Se llama genéricamente
“informe” a cualquiera de estos resultados que se pueden producir en
distintos formatos de destino. Estos informes estarán compuestos de múltiples elementos como
texto, gráficos, resultados numéricos, tablas, etc. Además, es posible que haya
que generarlos en distintos formatos (por ejemplo html o pdf, entre otros), para diferentes destinos, como la Web, documentos imprimibles o
presentaciones. Finalmente, con una alta probabilidad varias personas
intervendrán en el proceso, y la <strong>trazabilidad</strong> (reproducibilidad) del análisis
mejorará el proyecto de forma global.</p>
<p>La forma de abordar el problema es típicamente con un enfoque <em>corta-pega</em>,
en el que primero se realiza todo el análisis de datos con el software
estadístico y después se utilizan
los resultados del análisis como base de un informe escrito, posiblemente
con algunas iteraciones del proceso si el proyecto tiene cierta envergadura.
El software estadístico comercial suele incluir formas de generar resultados listos
para integrar en un informe, pero habitualmente bajo este paradigma de incluir el
resultado a posteriori <span class="citation">(<a href="referncias.html#ref-leisch2002sweave">Leisch 2002</a>)</span>.</p>
<p>Esta forma de trabajar genera un alto coste de mantenimiento (debido a la regeneración manual del informe) a la vez que
provoca inconsistencias (por ejemplo entre unos grupos y otros,
entre diferentes analistas, etc.), errores, contenidos desactualizados o no
reproducibles. Este enfoque es propenso a fallos de organización y gestión de un proyecto, lo se traduce en
vulnerabilidades especialmente en la ejecución de software, simulaciones, etc.
Además, cada vez que hay que hacer un cambio, hay que hacerlo en muchos
sitios, con la consiguiente pérdida de tiempo y posibles errores.</p>
<p>El enfoque de la <strong>investigación reproducible</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;El objetivo de la investigación reproducible es vincular instrucciones específicas a los análisis y datos experimentales, de modo que los informes puedan recrearse entendidos mejor y verificados. &lt;span class="citation"&gt;(&lt;a href="referncias.html#ref-rrtaskview"&gt;Kuhn 2019&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>229</sup></a> supera muchos de los obstáculos a la
hora de preparar informes de análisis de datos. El objetivo es
unir instrucciones para análisis de datos con datos experimentales de forma que
los resultados se puedan volver a obtener automáticamente, entender mejor y verificar.</p>
<p>
Un concepto muy relacionado que se utiliza en <strong>R</strong> es la <strong>programación
literaria</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;La programación literaria es una metodología que combina un lenguaje de programación con un lenguaje de documentación &lt;span class="citation"&gt;(&lt;a href="referncias.html#ref-knuth1984literate"&gt;Knuth 1984&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>230</sup></a>, mediante la cual se combina un lenguaje de programación como <strong>R</strong> con documentación de todo tipo (por ejemplo comentarios en el
código fuente o inclusión de ficheros <em>readme</em>).</p>
<p>Con el enfoque de la investigación reproducible, lo que se hace es darle la vuelta
al enfoque <em>corta-pega</em>, de forma que se escribe el informe a la vez que se realiza
el análisis, incrustando el código dentro del propio informe. Obviamente, es necesario
un sistema que consolide el informe con los resultados del código, y esto es lo
que nos permite <strong>R</strong> y <strong>RStudio</strong> mediante archivos <strong>R Markdown</strong> y su evolución reciente a <strong>Quarto</strong>. El desarrollo de <strong>Quarto</strong> está patrocinado por la empresa Posit, PBC, donde anteriormente crearon <strong>R Markdown</strong> que compartía los mismos objetivos, pero estaba dirigido principalmente a usuarios del lenguaje <strong>R</strong>. El mismo equipo central trabaja tanto en <strong>R Markdown</strong> como en <strong>Quarto</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://quarto.org/about.html" class="uri"&gt;https://quarto.org/about.html&lt;/a&gt;&lt;/p&gt;'><sup>231</sup></a>.</p>
<p>Las ventajas de utilizar un enfoque reproducible se pueden resumir en:</p>
<ul>
<li><p>Si el mismo analista tiene que volver al análisis en el futuro, los
resultados se pueden volver a obtener automáticamente de nuevo fácil y comprensiblemente.</p></li>
<li><p>En el caso de que en el proyecto participen más analistas, toda la explicación
está a mano.</p></li>
<li><p>Cualquier cambio en un punto del análisis (por ejemplo, añadir una
variable a un modelo) se puede realizar de una sola vez y los cambios
en los resultados y gráficos se actualizarán automáticamente.</p></li>
<li><p>Los resultados se pueden verificar por terceros en caso necesario. Un
caso paradigmático fue el escándalo de los ensayos de cáncer en Duke en 2011<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt; &lt;a href="http://www.nytimes.com/2011/07/08/health/research/08genes.html" class="uri"&gt;http://www.nytimes.com/2011/07/08/health/research/08genes.html&lt;/a&gt;&lt;/p&gt;'><sup>232</sup></a>.
No obstante es un tema que cada vez se demanda más en otros campos
fuera de la investigación clínica (por ejemplo en publicaciones de
cualquier tipo).</p></li>
</ul>
<p>El flujo de trabajo sería el siguiente: los contenidos se encuentran en ficheros
de texto plano, con código y texto explicativo. Estos ficheros fuente, se compilan y producen los materiales en los
formatos necesarios. Los cambios se hacen una vez, y todos los materiales son
actualizados adecuadamente.</p>
<p>A continuación se abordará el enfoque reproducible. Para el otro enfoque,
simplemente basta copiar los resultados de la consola y los gráficos de la pestaña <em>Plots</em>
del panel inferior derecho en cualquier editor de documentos.</p>
<div id="markdown-r-markdown-quarto-y-rstudio" class="section level3" number="44.1.1">
<h3>
<span class="header-section-number">44.1.1</span> Markdown, R Markdown, Quarto y RStudio<a class="anchor" aria-label="anchor" href="#markdown-r-markdown-quarto-y-rstudio"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Markdown</strong> es un lenguaje de marcas ligero que fue creado con la intención de ser más legible y fácil de escribir que el código HTML, aunque actualmente se utiliza para otros formatos de salida.
Al ser ficheros de texto plano los ficheros se pueden leer bajo
cualquier circunstancia, con una sintaxis muy sencilla que permite leerlo
directamente por las personas, o ser convertido por un ordenador
en otro formato más elaborado, como por ejemplo HTML
(página web), pdf o Microsoft Word. En <strong>RStudio</strong>, se pueden crear ficheros <strong>R Markdown</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://rmarkdown.rstudio.com" class="uri"&gt;https://rmarkdown.rstudio.com&lt;/a&gt;&lt;/p&gt;'><sup>233</sup></a>
utilizando esta sintaxis para
las explicaciones del análisis, e incluir dentro “trozos” (<em>chunks</em>) de
código, de forma que, al generar el informe, el resultado de ese código queda
incluido en el documento de salida. Así, si una vez terminado el informe se ha olvidado,
por ejemplo,
incluir un gráfico, sólo hay que añadir las líneas de código que lo crean y
volver a generar el informe.</p>
<p><strong>R Markdown</strong> ha evolucionado a un nuevo formato denominado <strong>Quarto</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://quarto.org" class="uri"&gt;https://quarto.org&lt;/a&gt;&lt;/p&gt;'><sup>234</sup></a>, que extiende aún más la funcionalidad de Markdown y está pensado para ser usado con otros lenguajes de programación. En esencia, y a los efectos de este capítulo, hay pocas diferencias.</p>
<p>Para poder utilizar las capacidades de <strong>R Markdown</strong> y <strong>Quarto</strong>, es necesario tener instalado
el paquete <code>knitr</code> <span class="citation">(<a href="referncias.html#ref-xie2017dynamic">Xie 2017</a>)</span>, que utiliza también otros paquetes como <code>rmarkdown</code>.
Aunque <code>knitr</code> no forma parte del <code>tidyverse</code>, sí es un enfoque moderno de <strong>R</strong>
que vino a hacer más fácil la generación de documentos que se hacía en <strong>R</strong> base
con la función <code>Sweave</code> <span class="citation">(<a href="referncias.html#ref-leisch2002sweave">Leisch 2002</a>)</span>. Para usar <strong>Quarto</strong> se necesita también el paquete <code>quarto</code> <span class="citation">(<a href="referncias.html#ref-R-quarto">Allaire 2022</a>)</span> y tener instalado el software <strong>quarto</strong> en el ordenador<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;La instalación es trivial para cualquier sistema desde la web de quarto, &lt;a href="https://quarto.org" class="uri"&gt;https://quarto.org&lt;/a&gt;.&lt;/p&gt;'><sup>235</sup></a>.</p>
<p>Para crear un nuevo documento <strong>Quarto</strong>, se selecciona <em>Quarto Document…</em> en el
icono de nuevo archivo de la barra de herramientas o en el menú <em>File</em>. Entonces
se abre el cuadro de diálogo <em>New Quarto Document</em>. Hay varios
tipos de archivos que se pueden crear, que producirán formatos diferentes: <em>Document</em> (documento),
<em>Presentation</em> (presentación de diapositivas) e <em>Interactive</em> (aplicación web interactiva con Shiny u Observable JS). De momento se verán los documentos. Se puede crear un archivo <strong>Quarto</strong> vacío si no se quiere crear la estructura. Para que se cree con una estructura mínima,
se necesita un título del documento y un autor, que después se podrán cambiar. También se selecciona un formato de salida por defecto, que puede ser HTML (para ver en el navegador), PDF, o Word. Esto también se podrá cambiar después, por lo que la forma más eficiente de trabajar es empezar con HTML, cuya previsualización es más rápida, y cuando esté el resultado final generar el archivo en el formato deseado.</p>
<p>
Se puede seleccionar la <em>Engine</em> entre <em>knitr</em> (<strong>R</strong>) y <em>Jupyter</em> (<strong>Python</strong>), y también elegir si se quiere utilizar el editor visual (por defecto). Con el editor visual se pueden utilizar menús para editar el texto y dar el formato Markdown sin esfuerzo. Al hacer clic en el botón <em>Create</em> de la ventana <em>New Quarto Document</em>, se abre en
el editor de <strong>RStudio</strong> un documento quarto (extensión .qmd) con una estructura básica a modo de plantilla. Los elementos principales de un archivo <strong>Quarto</strong> aparecen en esta plantilla:</p>
<p></p>
<ul>
<li><p><strong>Encabezado YAML</strong>: constituyen la configuración del documento, y controlan sobre todo las opciones del formato de salida, es decir, cómo se verá el resultado final. Este encabezado se encuentra entre dos líneas con tres guiones (<code>---</code>),
donde se expresan las opciones como <code>opcion: valor</code>, y estos valores además se pueden anidar. Dispone de ayuda contextual, de forma que pulsando la combinación de teclas CTRL+ESPACIO aparecen las opciones que se pueden configurar y los posibles valores. Esta parte del documento es constituye el <strong>formato</strong> del documento.</p></li>
<li><p><strong>Texto formateado</strong>: con una sintaxis muy sencilla, se puede dar formato al texto, como negritas, listas, etc. En el editor visual se puede hacer con los menús y botones de la barra de herramientas del editor.</p></li>
</ul>
<p></p>
<ul>
<li>
<strong>Fragmentos de código (<em>chunks</em>)</strong>: al generar el documento, se ejecutará el código dentro de estos
fragmentos, y en el documento resultante se mostrará el resultado. En cada fragmento de código aparecen dos botones que sirven para ejecutar todos los <em>chunks</em> anteriores y para ejecutar el <em>chunk</em> actual. Junto con el texto formateado constituyen el <strong>contenido</strong> del documento.</li>
</ul>
<p>La barra de herramientas del editor ofrece algunas opciones:</p>
<ul>
<li>
<p>El botón <em>Render</em> convierte (“renderiza” en lenguaje informático) el documento <strong>Quarto</strong> produciendo el archivo de salida configurado. Se puede desplegar un menú para cambiar el formato de salida y otras opciones. Al crear el documento solo aparece el formato de salida elegido, pero se puede cambiar el encabezado para poder convertir el documento a distintos formatos. Por ejemplo si se cambia el encabezado que se ha creado por defecto por el siguiente, se puede generar el archivo de salida en html o word seleccionando en la lista desplegable junto al botón <em>Render</em>:</p>
<pre><code>````
---
title: "Título del informe"
format: 
html: default
docx: default
editor: visual
---
````</code></pre>
</li>
<li><p>El botón de opciones permite cambiar la forma en que se mostrarán las salidas al ejecutar el código desde el editor.</p></li>
<li><p>El botón <em>Insert a new code chunk</em> nos permite insertar un nuevo fragmento de código.</p></li>
<li><p>Las flechas de navegación permiten moverse entre los <em>chunks</em> del
documento. También
se puede usar el selector de esquema en la parte inferior para ir a un fragmento de código o
apartado concreto del documento.</p></li>
<li><p>Desde el menú <em>Run</em> se puede ejecutar el código de los distintos <em>chunks</em>.</p></li>
<li><p>El menú <em>Publish</em> nos permitiría publicar el documento en algún servicio como <a href="https://rpubs.com"><em>RPubs</em></a></p></li>
<li><p>El botón <em>Outline</em> muestra un esquema para navegar por el documento, donde aparecerán los encabezados formateados con Markdown.</p></li>
<li><p>Se puede cambiar entre el editor visual y el del código fuente con los botones <em>Source</em> y <em>Visual</em> en la parte superior del editor.</p></li>
</ul>
<p></p>
<p>Para generar el documento, se guarda el archivo en cualquier carpeta de nuestro
proyecto y se utiliza el icono de conversión (“renderizado”). La Fig. <a href="id_120007-informes.html#fig:ch-120007-captura-quarto">44.1</a> muestra en el panel izquierdo el archivo fuente en el editor visual, con alguna opción adicional añadida a la plantilla por defecto, y en el panel derecho el informe renderizado. Si en vez de pulsarlo directamente se selecciona el
triángulo de la derecha, se puede seleccionar el formato de salida (html, pdf o Word)
si se han incluido esos formatos en el encabezado YAML como se ha indicado.
El formato PDF requiere tener instalada una
distribución del sistema de edición libre LaTeX<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Se puede instalar una distribución
ligera de LaTeX con el paquete &lt;code&gt;tinytex&lt;/code&gt; ejecutando &lt;code&gt;tinytex::install_tinytex()&lt;/code&gt;
habiendo instalado previamente dicho paquete.&lt;/p&gt;"><sup>236</sup></a>.
El archivo de destino, con extensión .html, .pdf o .docx según el caso,
quedará guardado en la carpeta donde se encuentre el archivo quarto.
Dependiendo de las opciones configuradas, el archivo se abrirá automáticamente
en una ventana nueva de <strong>RStudio</strong> (por defecto),
o en la pestaña <em>Viewer</em> del panel inferior derecho, o en el visor de pdf
integrado en <strong>RStudio</strong> (pdf). Para poder abrir archivos .docx será necesario tener
instalado <strong>Microsoft Word</strong> o algún otro programa que pueda abrirlo, como <strong>LibreOffice</strong>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch-120007-captura-quarto"></span>
<img src="img/cdr_quarto.png" alt='Informe Quarto y el documento de salida que produce su conversión ("renderizado") con algunas opciones adicionales' width="60%"><p class="caption">
Figura 44.1: Informe Quarto y el documento de salida que produce su conversión (“renderizado”) con algunas opciones adicionales
</p>
</div>
<p></p>
<p>Se puede compilar el informe tantas veces como se quiera con el icono <em>Render</em>.
Para trabajo en curso, se recomienda ir previsualizando en formato HTML, y una vez
sea definitivo generar el formato de destino final. Para la conversión de
formatos, <strong>RStudio</strong> integra la aplicación
<a href="https://pandoc.org">pandoc</a>.</p>
<p></p>
<p>Hay una guía rápida de
Markdown (<em>Markdown Quick Reference</em>) disponible en el menú de ayuda de <strong>RStudio</strong>, así como enlaces a dos
<em>Cheatsheets</em>: <em>R Markdown Cheatsheet</em> y <em>R Markdown Reference Guide</em>. Esta última es
la más completa y donde se encuentran todas las opciones disponibles (que sirven
para los documentos <strong>Quarto</strong> aunque en la propia web de <strong>Quarto</strong> hay una documentación más completa). En los siguientes
apartados se revisan las opciones más habituales que cubren un amplio
abanico de proyectos.</p>
</div>
</div>
<div id="documentos-quarto" class="section level2" number="44.2">
<h2>
<span class="header-section-number">44.2</span> Documentos Quarto<a class="anchor" aria-label="anchor" href="#documentos-quarto"><i class="fas fa-link"></i></a>
</h2>
<p>En esta sección se detalla cómo añadir contenido y configuración a un documento Quarto con algunas de las opciones más interesantes para la Ciencia de Datos reproducible.</p>
<div id="encabezado-yaml-y-configuración" class="section level3" number="44.2.1">
<h3>
<span class="header-section-number">44.2.1</span> Encabezado YAML y configuración<a class="anchor" aria-label="anchor" href="#encabezado-yaml-y-configuraci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Las opciones de configuración del documento se establecen en este encabezamiento.
Al crear el documento con la plantilla, se crea el siguiente
encabezado:</p>
<pre><code>---
title: "Título del informe"
format: html
editor: visual
---</code></pre>
<p>Ya se ha visto cómo se pueden añadir más formatos, poniendo uno en cada línea e “indentando” con el tabulador las distintas opciones. Cada formato a su vez puede incluir opciones, que de nuevo se indican con nuevas líneas que se “indentan” debajo del formato.</p>
<p></p>
<div class="infobox">
<p>La “indentación” se refiere al número de espacios en blanco (o tabulaciones)
al principio de cada línea. Las opciones que estén “dentro” de otra, deben tener la misma “indentación” (el mismo número de espacios en blanco al principio de la línea). Véase un ejemplo más completo debajo.
En el encabezado YAML la incorrecta “indentación” puede provocar errores al generar el informe.</p>
</div>
<p>Además del título (opción <code>title</code>), se pueden incluir autor (opción <code>author</code>) y fecha (opción <code>date</code>).
Estos elementos son cadenas de texto que aparecerán al principio del documento
de salida. Se debe cuidar que estén entre comillas para evitar
posibles errores. El elemento <code>format</code> indica el formato de salida.</p>
<p></p>
<p>La cantidad de opciones que se pueden incluir en el encabezado YAML es enorme y no tiene cabida en este capítulo. Algunas de las más utilizadas son <code>lang</code> para indicar el idioma del documento (“es” para español),
<code>bibliography</code> para indicar un fichero bibtex de bibliografía, o <code>toc</code> para incluir una tabla de contenidos. Algunas son específicas del formato. Por ejemplo, una muy útil es <code>reference-doc</code> para documentos de Word, con la que se puede indicar una plantilla personalizada para usar colores corporativos u otras opciones de diseño del informe<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;La plantilla se debe crear a partir de un archivo generado con &lt;strong&gt;Quarto&lt;/strong&gt;, modificando los estilos del documento y añadiendo elementos como encabezados y pies de página.&lt;/p&gt;"><sup>237</sup></a>. Para documentos html se puede incluir una hoja de estilos con la opción <code>css</code>. La lista completa para cada uno de los formatos soportados por <strong>Quarto</strong> se puede consultar en la guía de referencia en <a href="https://quarto.org/docs/reference/" class="uri">https://quarto.org/docs/reference/</a>.</p>
<p>El siguiente encabezado YAML fijaría el ancho y el alto de las figuras (en pulgadas) para el formato de salida html, además de las otras opciones comentadas:</p>
<pre><code>---
title: "Título del informe"
format: 
  html:
    fig-width: 8
    fig-height: 6
    css: estilos.css
  docx: 
    toc: true
    reference-doc: plantilla.docx
  pdf: default
lang: "es"
bibliography: bibliografia.bib
---</code></pre>
<p>Una explicación detallada del uso de hojas de estilo CSS queda fuera del alcance de este libro. Un ejemplo sencillo para formatear bloques con identificador (nombres precedidos por <code>#</code>) y bloques con clase (nombres precedidos por <code>.</code>) sería el siguiente:</p>
<pre><code>#parrafoazul {
   color: blue;
}

.enfatizar {
   font-size: 1.2em;
}</code></pre>
</div>
<div id="formateado-de-texto" class="section level3" number="44.2.2">
<h3>
<span class="header-section-number">44.2.2</span> Formateado de texto<a class="anchor" aria-label="anchor" href="#formateado-de-texto"><i class="fas fa-link"></i></a>
</h3>
<p>Incluir títulos, énfasis en el texto y listas
es muy sencillo, y a menudo no se necesita mucho más para realizar un informe.
En el informe que se crea con la plantilla ya se ven algunas opciones:</p>
<ul>
<li><p>Los encabezados se crean poniendo al principio de la línea tantos símbolos
almohadilla (<code>##</code>) como nivel de título se desee (dos almohadillas, apartado, tres
almohadillas, subapartado, etc.) Una almohadilla sería para el título del
informe, si no se especificara en el encabezado.</p></li>
<li><p>Para poner texto en <strong>negrita</strong>, se incluye entre dos asteriscos a cada lado: <code>**negrita**</code>.</p></li>
<li><p>Para poner texto en formato <code>monoespaciado</code>, tipo código, se pone entre tildes
graves (<em>backticks</em>, <code>`</code> ): <code>`monoespaciado`</code>.</p></li>
<li><p>Los <a href="#">enlaces</a> se crean con: <code>[texto del enlace](http://ejemplo.com)</code>.</p></li>
</ul>
<p>Existen otras opciones sencillas, que se pueden ver en la <em>Markdown Quick Reference</em>
del menú <em>Help</em>:</p>
<ul>
<li><p><em>Cursiva</em> rodeando el texto con un solo asterisco a cada lado (o guión bajo): <code>_cursiva_</code>.</p></li>
<li><p>Listas poniendo al principio de la línea un asterisco, guión o signo más:</p></li>
</ul>
<pre><code>    * Primer elemento de la lista
    * Segundo elemento de la lista
      + Primer elemento dentro del segundo
      + Segundo elemento dentro del segundo
    * ...</code></pre>
<ul>
<li>Listas ordenadas poniendo un número y un punto al principio de la línea:</li>
</ul>
<pre><code>    1. Primer elemento
    2. segundo elemento
    3. ...</code></pre>
<ul>
<li><p>Imágenes de cualquier tipo como: <code>![](ruta_a_la_imagen)</code>.</p></li>
<li><p>Superíndices<sup>sup</sup> y subíndices<sub>sub</sub> con el texto entre símbolos <code>^</code> y <code>~</code> respectivamente.</p></li>
<li><p>Ecuaciones en formato <code>LaTeX</code>, por ejemplo <span class="math inline">\(\sum x_i\)</span> sería <code>$\sum x_i$</code>.</p></li>
<li><p>Saltos de línea (añadiendo más de dos espacios al final de la línea) y saltos de página (tres o más asteriscos, <code>*</code>, o guiones medios, <code>-</code>, en una línea).</p></li>
<li><p>Tablas, usando guiones medios y barras verticales para separar filas y columnas:</p></li>
</ul>
<pre><code>    Primer encabezado      | Segundo encabezado
    ---------------------- | ---------------------
    Contenido de la celda  | Contenido de la celda
    Contenido de la celda  | Contenido de la celda</code></pre>
<p>Con estas opciones se cubren las necesidades de la práctica totalidad de
proyectos de análisis. No obstante, dependiendo del formato de salida se
pueden añadir otras opciones de formato.</p>
</div>
<div id="inclusión-de-código-en-el-documento" class="section level3" number="44.2.3">
<h3>
<span class="header-section-number">44.2.3</span> Inclusión de código en el documento<a class="anchor" aria-label="anchor" href="#inclusi%C3%B3n-de-c%C3%B3digo-en-el-documento"><i class="fas fa-link"></i></a>
</h3>
<p>Se pueden crear archivos <strong>Quarto</strong> sin incluir nada de código, simplemente
para crear documentos editables fácilmente. Sin embargo, la verdadera potencia
de <strong>Quarto</strong> es la posibilidad de incluir código de <strong>R</strong> (y también de otros
lenguajes) en los documentos. Como ya se avazó, el código se incluye, principalmente,
en forma de <em>chunks</em> o bloques de código.</p>
<p></p>
<p>Un <em>chunk</em> consta de unos marcadores
de inicio y final del <em>chunk</em>, entre los cuales se insertan expresiones de <strong>R</strong> que se
ejecutarán al generar el documento de salida. El marcador de inicio son tres
símbolos de tilde grave seguidos de unas llaves con la letra r
dentro. El marcador de cierre del <em>chunk</em> son de nuevo
tres tildes graves, sin más. Y dentro del <em>chunk</em> se pueden poner expresiones de <strong>R</strong> de la misma forma en que se trabaja con los <em>scripts</em>. Al convertir (“renderizar”) el documento, el código se ejecutará con las opciones que se indiquen como se explica más adelante, y el archivo de salida incluirá el resultado de la ejecución del <em>chunk</em>. El siguiente sería un ejemplo de código para incluir gráficos en el informe.</p>
<pre><code>```
library(CDR)
library(corrplot)
mcor_tic &lt;- cor(TIC2021)  
corrplot.mixed(mcor_tic, order = 'AOE')
```</code></pre>
<p>En todo caso, no hay que escribir los marcadores de inicio y final, ya que
se dispone del atajo de teclado <code>CTRL+ALT+I</code> que lo hace automáticamente, o,
alternativamente, el icono <em>Insert a new code chunk</em> de la barra de herramientas del
editor.
Una vez se tiene el cursor dentro de un <em>chunk</em>, se puede ejecutar una expresión
como del mismo modo que se hace en un <em>script</em> (<code>CTRL+ENTER</code>), o el <em>chunk</em> completo
(<code>MAYUS+CTRL+ENTER</code>).</p>
<p>A veces es necesario incluir algún resultado de <strong>R</strong> en medio del texto
y no como un bloque. En esos casos se puede insertar un bloque en línea
poniendo, entre dos tildes graves, la letra <code>r</code> como primer carácter,
y después una expresión de <strong>R</strong> que se pueda “imprimir” como cadena de texto:</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb666-1"><a href="id_120007-informes.html#cb666-1" tabindex="-1"></a><span class="in">`r expresion_de_R `</span>    </span></code></pre></div>
<p></p>
<p>Una opción muy interesante de los informes de <strong>Quarto</strong> es la parametrización.
Esta opción es muy útil para informes automatizados que pueden
cambiar dependiendo de algún valor, por ejemplo del fichero de datos, la fecha,
o cualquier otro valor. Estos parámetros se crean como elementos del encabezado
YAML de la forma:</p>
<pre><code>params:
  parametro: valor</code></pre>
<p>que después se pueden usar en los <em>chunks</em> de código como <code>params$parametro</code>.
La verdadera potencia de esta característica es cuando se convierte el documento
desde un <em>script</em> en el que los parámetros son resultados de algún tipo de
operación en los datos (por ejemplo, un informe de análisis de inventario solo de una
tienda donde se han producido roturas de stock el día x).
En vez de utilizar el botón <em>Render</em>, en estos casos se usa la función <code>quarto_render()</code>,
una de cuyas opciones es <code>execute_params</code>, donde se pasarían los valores de los parámetros en forma
de lista cuyos elementos tienen el nombre de los parámetros.</p>
</div>
<div id="opciones-de-los-bloques-de-código-chunks" class="section level3" number="44.2.4">
<h3>
<span class="header-section-number">44.2.4</span> Opciones de los bloques de código (<em>chunks</em>)<a class="anchor" aria-label="anchor" href="#opciones-de-los-bloques-de-c%C3%B3digo-chunks"><i class="fas fa-link"></i></a>
</h3>
<p>Al renderizar un informe que contiene <em>chunks</em> sin configurar ninguna opción,
el informe mostrará por defecto el código de entrada y las salidas
(textos y gráficos), así como todos los mensajes que se pueden producir.</p>
<p>Opcionalmente, justo después del marcador de inicio del <em>chunk</em> se pueden añadir opciones del mismo mediante líneas que comienzan por el llamado <em>hashpipe</em>, que es una almohadilla seguida de la barra vertical, <code>#|</code> y a continuación la opción y su valor, de la misma forma que se hacía en el encabezado YAML para las opciones del documento, es decir, <code>opcion: valor</code>.</p>
<p>El <em>chunk</em> que se muestra a continuación tiene como identificador “ejemplo”,
y como opciones <code>echo: false</code> y <code>fig.align: 'center'</code>, lo que indica que el código
no se mostrará en el informe final y que el gráfico producido se alineará en el centro
del texto.</p>
<pre><code>```
#| label: "Ejemplo"
#| echo: false
#| fig-align: 'center'
plot(cars)
```</code></pre>
<p>Las opciones de <em>chunk</em> se pueden incluir de forma global en el documento estableciéndolas en el encabezado YAML del mismo, por ejemplo para mantener las opciones anteriores en todos los <em>chunks</em> por defecto:</p>
<pre><code>---
title: "Mi documento"
format: html
knitr:
  opts_chunk: 
    echo: false
    fig-align: 'center'
---</code></pre>
<p>Es importante señalar que las opciones establecidas en los <em>chunks</em> tienen prioridad a las opciones establecidas en el documento.</p>
<p>Hay varias opciones de <em>chunk</em> que tienen que ver con la presentación en la salida. Por defecto, si se produce un error, el proceso se detiene y no se genera
el archivo de destino. Este comportamiento, y otras muchas opciones,
se pueden configurar como opciones del <em>chunk</em>. Las más habituales son: <code>error: true</code> para mostrar los errores y no detener la generación del documento; <code>warning: false</code> y <code>message: false</code> para no mostrar <em>warnings</em> ni mensajes respectivamente; <code>include: false</code> para ejecutar el código pero no mostrar ningún tipo de salida; <code>eval: false</code> para no ejecutar el codigo; <code>results: "hide"</code> para indicar que no se muestren los resultados (otras opciones son <code>asis</code>, <code>hold</code> o <code>markup</code>); <code>comment: simbolo</code> para cambiar el símbolo que se usará como comentario del output (a veces es conveniente simplemente no poner comentario, es decir, <code>""</code>). Estas opciones del <em>chunk</em> se pueden incluir a nivel global en el encabezado YAML como se ha indicado anteriormente. La lista completa de opciones se encuentra en la <em>R Markdown reference guide</em>
que está disponible en el menú <em>Help/Cheatsheets</em>, o a la <a href="https://quarto.org/docs/computations/execution-options.html">documentación de Quarto sobre opciones de ejecución</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://quarto.org/docs/computations/execution-options.html" class="uri"&gt;https://quarto.org/docs/computations/execution-options.html&lt;/a&gt;&lt;/p&gt;'><sup>238</sup></a>.</p>
<p>Una característica muy cómoda es usar la ayuda contextual al escribir las opciones del <em>chunk</em>. Al comenzar a escribir, o pulsando la combinación de teclas <code>CTRL+ESPACIO</code>, se
muestran las opciones disponibles, y al seleccionar una opción, si tiene
varios posibles valores aparecen también para seleccionar.</p>
</div>
<div id="referencias-cruzadas-y-formateo-de-tablas" class="section level3" number="44.2.5">
<h3>
<span class="header-section-number">44.2.5</span> Referencias cruzadas y formateo de tablas<a class="anchor" aria-label="anchor" href="#referencias-cruzadas-y-formateo-de-tablas"><i class="fas fa-link"></i></a>
</h3>
<p></p>
<p>La salida tabular por defecto de la consola normalmente no es adecuada para un informe. En su lugar, lo que se desea es tener una tabla formateada adecuadamente para el formato de salida. Se pueden incluir en los informes de <strong>Quarto</strong> tablas formateadas de calidad. Para ello, se debe utilizar alguna función que formatee la tabla de acuerdo al formato de salida (HTML, PDF, Word) y, a veces, configurar la opción <code>results</code> del <em>chunk</em> como <code>'asis'</code>. Muchas de estas funciones preparan automáticamente el formato según el fichero de salida que se está generando.
Por ejemplo, el siguiente <em>chunk</em> generaría una tabla en cualquiera de los formatos de salida usando la función <code>kable</code> del paquete <code>knitr</code>:</p>
<pre><code> ```{r}
 knitr::kable(TIC2021)
 ```
 </code></pre>
<p>Hay otros paquetes con multitud de opciones de formato y presentación para las tablas como <code>xtable</code>, <code>flextable</code>, <code>kableExtra</code>, <code>DT</code>, o <code>gt</code>. Se anima al lector a consultar la documentación de estos paquetes para aprender a crear tablas de calidad que comuniquen adecuadamente los resultados de los análisis.</p>
<p></p>
<p>Tanto las tablas como las figuras se deben referenciar adecuadamente en los informes. Para ello se utilizan las <strong>referencias cruzadas</strong> de los informes <strong>Quarto</strong>. Para poder referenciar un gráfico creado en un <em>chunk</em>, es necesario: i) que el <em>chunk</em> tenga una etiqueta (<code>label: 'etiqueta'</code>); ii) que el <em>chunk</em> tenga una opción <code>fig-cap</code> para el título de la figura. Entonces el gráfico se puede referenciar en cualquier lugar del documento <strong>Quarto</strong> simplemente escribiendo <code>@etiqueta</code>. Por ejemplo, el siguiente <em>chunk</em> crearía el gráfico de la figura <a href="id_120007-informes.html#fig:ch-120007-ref-fig">44.2</a>, y en el texto se referenciaría como “<code>Figura @fig-tic</code>”.</p>
<pre><code>```{r}
#| label: "fig-tic"
#| fig-cap: "Ventas vs. % empresas con banda ancha"
library('ggplot2')
library('CDR')
TIC2021 |&gt; 
  ggplot(aes(ebroad, esales)) +
  geom_point() +
  geom_smooth(method = "lm")
```</code></pre>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch-120007-ref-fig"></span>
<img src="120007_Infor_quarto_files/figure-html/ch-120007-ref-fig-1.png" alt="Ventas vs. \% Empresas con banda ancha" width="55%"><p class="caption">
Figura 44.2: Ventas vs. % Empresas con banda ancha
</p>
</div>
<p></p>
<p>En cuanto a las tablas, igualmente el <em>chunk</em> que las crea debe tener una etiqueta. El título de la tabla en este caso lo proporcionará la propia función que la crea. A modo de ejemplo, el siguiente <em>chunk</em> crearía la Tabla <a href="id_120007-informes.html#tab:ch-120007-ref-tab">44.1</a> ya formateada con la función <code>flextable()</code> del paquete homónimo <span class="citation">(<a href="referncias.html#ref-R-flextable">Gohel and Skintzos 2022</a>)</span>, y en el texto se referenciaría como “<code>Tabla @tab-tic</code>”.</p>
<pre><code>```{r}
#| label: "tab-tic"
#| fig-cap: "Contaminación media NOx según tipo de estación"
library(dplyr)
library(flextable)
contam_mad |&gt;
  filter(nom_abv == "NOx") |&gt;
  group_by(tipo) |&gt; 
  summarise(Media = mean(daily_mean, na.rm = TRUE), n = n(), 
            Desv.Tip = sd(daily_mean, na.rm = TRUE),
            Perdidos = sum(is.na(daily_mean))) |&gt; 
  flextable() |&gt; 
  set_caption("Contaminación media NOx según tipo de estación.") |&gt; 
  autofit()
```</code></pre>
<template id="83b44d56-8a6d-41f6-89bc-837d7554aae8"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  border-color: transparent;
  caption-side: top;
}
.tabwid-caption-bottom table{
  caption-side: bottom;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
.katex-display {
    margin: 0 0 !important;
}
</style>
<div class="tabwid">
<style>.cl-37a70642{}.cl-379e8f80{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-37a1bbce{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-37a1bbd8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-37a1d172{width:1.109in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d17c{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d17d{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d186{width:0.888in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d187{width:1.109in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d188{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d189{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d190{width:0.888in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d191{width:1.109in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d192{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d193{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-37a1d19a{width:0.888in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-379acd82{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}</style>
<div class="inline-table"><table class="cl-37a70642">
<caption>
<span id="tab:ch-120007-ref-tab">Tabla 44.1: </span><span class="cl-379acd82">Contaminación media NOx según tipo de estación.</span>
</caption>

<thead><tr style="overflow-wrap:break-word;">
<td class="cl-37a1d172"><p class="cl-37a1bbce"><span class="cl-379e8f80">tipo</span></p></td>
<td class="cl-37a1d17c"><p class="cl-37a1bbd8"><span class="cl-379e8f80">Media</span></p></td>
<td class="cl-37a1d17d"><p class="cl-37a1bbd8"><span class="cl-379e8f80">n</span></p></td>
<td class="cl-37a1d17c"><p class="cl-37a1bbd8"><span class="cl-379e8f80">Desv.Tip</span></p></td>
<td class="cl-37a1d186"><p class="cl-37a1bbd8"><span class="cl-379e8f80">Perdidos</span></p></td>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-37a1d187"><p class="cl-37a1bbce"><span class="cl-379e8f80">Fondo</span></p></td>
<td class="cl-37a1d188"><p class="cl-37a1bbd8"><span class="cl-379e8f80">64.11108</span></p></td>
<td class="cl-37a1d189"><p class="cl-37a1bbd8"><span class="cl-379e8f80">49,656</span></p></td>
<td class="cl-37a1d188"><p class="cl-37a1bbd8"><span class="cl-379e8f80">61.48603</span></p></td>
<td class="cl-37a1d190"><p class="cl-37a1bbd8"><span class="cl-379e8f80">70</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-37a1d187"><p class="cl-37a1bbce"><span class="cl-379e8f80">Suburbanas</span></p></td>
<td class="cl-37a1d188"><p class="cl-37a1bbd8"><span class="cl-379e8f80">32.87574</span></p></td>
<td class="cl-37a1d189"><p class="cl-37a1bbd8"><span class="cl-379e8f80">12,414</span></p></td>
<td class="cl-37a1d188"><p class="cl-37a1bbd8"><span class="cl-379e8f80">32.13426</span></p></td>
<td class="cl-37a1d190"><p class="cl-37a1bbd8"><span class="cl-379e8f80">39</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-37a1d191"><p class="cl-37a1bbce"><span class="cl-379e8f80">Tráfico</span></p></td>
<td class="cl-37a1d192"><p class="cl-37a1bbd8"><span class="cl-379e8f80">81.27392</span></p></td>
<td class="cl-37a1d193"><p class="cl-37a1bbd8"><span class="cl-379e8f80">33,104</span></p></td>
<td class="cl-37a1d192"><p class="cl-37a1bbd8"><span class="cl-379e8f80">68.13974</span></p></td>
<td class="cl-37a1d19a"><p class="cl-37a1bbd8"><span class="cl-379e8f80">83</span></p></td>
</tr>
</tbody>
</table></div>
</div></template><div class="flextable-shadow-host" id="ee05bbec-72df-4ce9-b63c-c0fc72b1bfe5"></div>
<script>
var dest = document.getElementById("ee05bbec-72df-4ce9-b63c-c0fc72b1bfe5");
var template = document.getElementById("83b44d56-8a6d-41f6-89bc-837d7554aae8");
var caption = template.content.querySelector("caption");
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>
</div>
</div>
<div id="otros-formatos" class="section level2" number="44.3">
<h2>
<span class="header-section-number">44.3</span> Otros formatos<a class="anchor" aria-label="anchor" href="#otros-formatos"><i class="fas fa-link"></i></a>
</h2>
<p></p>
<p>El formato <strong>Quarto</strong> es solo uno de los que se pueden utilizar
para aplicar la reproducibilidad que motiva este capítulo. Como se ha comentado, es la nueva generación de <strong>R Markdown</strong>, archivos que pueden seguir creándose con <strong>RStudio</strong>. En <strong>R</strong> base
se pueden crear archivos <code>Sweave</code>, con sintaxis LaTeX para la
narrativa y bloques de código <strong>R</strong>. También es posible crear archivos R HTML,
con la narrativa en HTML. Los identificadores de los bloques son ligeramente
distintos, así como las opciones disponibles, aunque la filosofía es la misma.
<strong>R Markdown</strong> y ahora <strong>Quarto</strong> han ido desplazando estos otros formatos al ser más versátil (puede
generar cualquiera de los otros formatos, y además otros como .docx).</p>
<p>En cuanto a los formatos de salida, hay una cantidad de opciones muy interesante
que queda fuera de los objetivos de este libro. A continuación se relacionan
algunos de ellos, si bien se puede consultar el libro de <span class="citation">Xie, Allaire, and Grolemund (<a href="referncias.html#ref-xie2019r">2019</a>)</span> y la documentación de <strong>Quarto</strong> para
ver detalles.</p>
<ul>
<li><p><strong>Notebooks</strong>: es un tipo especial de salida HTML, más indicado cuando
se quieren ir probando cosas guardando el resultado parcial de lo ejecutado en el html.</p></li>
<li><p><strong>Presentaciones</strong>: es posible crear presentaciones PowerPoint y usar una plantilla,
como se vio con los documentos de Word. Se utiliza una sintaxis muy sencilla
y se puede incluir código y resultados igual que en un informe. Otros formatos de
presentaciones son Reveal JS y beamer (LaTeX) y con <strong>Quarto</strong>, además, ioslides, slidify y xaringan (HTML).</p></li>
<li><p><strong>Tableros</strong> (<em>dashboards</em>): pueden ser estáticos, usando el paquete <code>flexdashboard</code>,
útiles para comunicar resultados en un par de pantallazos. </p></li>
<li><p><strong>Shiny</strong>: aplicaciones web interactivas que responden a inputs del usuario (<em>reactive</em>). Estas aplicaciones se tratan en detalla en el Cap. <a href="shiny.html#shiny">45</a>. </p></li>
<li><p><strong>Websites</strong>: websites sencillos con páginas enlazadas en el mismo directorio.</p></li>
<li><p><strong>Blog</strong>: directamente como proyecto <strong>Quarto</strong>, o con el paquete <code>blogdown</code>, se pueden generar sitios web completos al estilo de un blog con páginas.</p></li>
<li><p><strong>Libros</strong>: directamente como proyecto <strong>Quarto</strong>, o con el paquete <code>bookdown</code>, se pueden crear libros en varios formatos. El material de este libro está creado con <code>bookdown</code>.</p></li>
<li><p><strong>Tutoriales</strong>: aparecieron en <strong>RStudio</strong> 1.3; se pueden crear documentos interactivos con preguntas y navegación usando sintaxis <strong>R Markdown</strong>.</p></li>
<li><p><strong>Tufte Handouts</strong>: un tipo especial de documento con anotaciones al margen
que comunica muy bien.</p></li>
</ul>
<p></p>
<div id="resumen-34" class="section level3 unnumbered infobox_resume">
<h3>Resumen<a class="anchor" aria-label="anchor" href="#resumen-34"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>En la comunicación de resultados, es esencial seguir un enfoque reproducible.</li>
<li>
<strong>R Markdown</strong> y su evolución <strong>Quarto</strong> es el formato más versátil para crear informes reproducibles que
permitan una trazabilidad de los análisis.</li>
<li>
<strong>RStudio</strong> permite trabajar eficientemente con <strong>R Markdown</strong> y <strong>Quarto</strong> a través de ayuda y opciones.</li>
<li>El encabezado YAML del informe contiene la configuración global, que puede incluir parámetros para automatización.</li>
<li>La narrativa del informe se escribe en Markdown, con una sintaxis extremadamente sencilla.</li>
<li>El código se puede incluir en forma de bloques (<em>chunks</em>) o en línea.</li>
<li>En las opciones del <em>chunk</em> se puede personalizar
la forma en que se ejecutará y mostrará en el informe.</li>
<li>Los informes <strong>R Markdown</strong> y <strong>Quarto</strong> se pueden generar en formatos HTML, PDF y Word, entre otros.</li>
<li>En los informes <strong>Quarto</strong> se pueden hacer referencias cruzadas a tablas, figuras y otros elementos del documento.</li>
<li>Hay otros formatos más elaborados que merece la pena explorar.</li>
</ul>
</div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></div>
<div class="next"><a href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Índice capítulo"><h2>Índice capítulo</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#id_120007-informes"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li>
<a class="nav-link" href="#por-qu%C3%A9-informes-reproducibles"><span class="header-section-number">44.1</span> ¿Por qué informes reproducibles?</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#markdown-r-markdown-quarto-y-rstudio"><span class="header-section-number">44.1.1</span> Markdown, R Markdown, Quarto y RStudio</a></li></ul>
</li>
<li>
<a class="nav-link" href="#documentos-quarto"><span class="header-section-number">44.2</span> Documentos Quarto</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#encabezado-yaml-y-configuraci%C3%B3n"><span class="header-section-number">44.2.1</span> Encabezado YAML y configuración</a></li>
<li><a class="nav-link" href="#formateado-de-texto"><span class="header-section-number">44.2.2</span> Formateado de texto</a></li>
<li><a class="nav-link" href="#inclusi%C3%B3n-de-c%C3%B3digo-en-el-documento"><span class="header-section-number">44.2.3</span> Inclusión de código en el documento</a></li>
<li><a class="nav-link" href="#opciones-de-los-bloques-de-c%C3%B3digo-chunks"><span class="header-section-number">44.2.4</span> Opciones de los bloques de código (chunks)</a></li>
<li><a class="nav-link" href="#referencias-cruzadas-y-formateo-de-tablas"><span class="header-section-number">44.2.5</span> Referencias cruzadas y formateo de tablas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#otros-formatos"><span class="header-section-number">44.3</span> Otros formatos</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#resumen-34">Resumen</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentos de ciencia de datos con R</strong>" coordinado por <a href="https://blog.uclm.es/gemafaviles/" class="text-light">Gema Fernández-Avilés y José-María Montero</a>. Generado por última vez el día 2023-06-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro ha sido generado con el paquete de R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

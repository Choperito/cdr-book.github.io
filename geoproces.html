<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 47 Geoprocesamiento en nube | Fundamentos de ciencia de datos con R</title>
<meta name="author" content="Gema Fernández-Avilés y José-María Montero">
<meta name="description" content="Dominic Royé Fundación de la Investigación del Clima  47.1 Introducción El planteamiento de un problema basado en datos de diversos proveedores habitualmente implica la descarga de grandes...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Capítulo 47 Geoprocesamiento en nube | Fundamentos de ciencia de datos con R">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/cover.png">
<meta property="og:description" content="Dominic Royé Fundación de la Investigación del Clima  47.1 Introducción El planteamiento de un problema basado en datos de diversos proveedores habitualmente implica la descarga de grandes...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 47 Geoprocesamiento en nube | Fundamentos de ciencia de datos con R">
<meta name="twitter:description" content="Dominic Royé Fundación de la Investigación del Clima  47.1 Introducción El planteamiento de un problema basado en datos de diversos proveedores habitualmente implica la descarga de grandes...">
<meta name="twitter:image" content="/img/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="bs4_book.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentos de ciencia de datos con <strong>R</strong></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
</form>

      <nav aria-label="Contenido"><h2>Contenido</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li><a class="" href="pr%C3%B3logo-by-julia-silge.html">Prólogo (by Julia Silge)</a></li>
<li><a class="" href="pr%C3%B3logo-por-yanina-bellini.html">Prólogo (por Yanina Bellini)</a></li>
<li class="book-part">Ciencia, datos, software… y científicos</li>
<li><a class="" href="ciencia-datos.html"><span class="header-section-number">1</span> ¿Es la ciencia de datos una ciencia?</a></li>
<li><a class="" href="metodologia.html"><span class="header-section-number">2</span> Metodología en ciencia de datos</a></li>
<li><a class="" href="ch-110003.html"><span class="header-section-number">3</span> R para ciencia de datos</a></li>
<li><a class="" href="cap-etica.html"><span class="header-section-number">4</span> Ética en la ciencia de datos</a></li>
<li class="book-part">Bienvenidos a la jungla de datos</li>
<li><a class="" href="datos-sql.html"><span class="header-section-number">5</span> Gestión de bases de datos relacionales</a></li>
<li><a class="" href="cap-nosql.html"><span class="header-section-number">6</span> Gestión de bases de datos NoSQL</a></li>
<li><a class="" href="DGDQM.html"><span class="header-section-number">7</span> Gobierno, gestión y calidad del dato</a></li>
<li><a class="" href="cap-130009.html"><span class="header-section-number">8</span> Integración y limpieza de datos</a></li>
<li><a class="" href="chap-feature.html"><span class="header-section-number">9</span> Selección y transformación de variables</a></li>
<li><a class="" href="chap-herramientas.html"><span class="header-section-number">10</span> Herramientas para el análisis en ciencia de datos</a></li>
<li><a class="" href="cap-120006-aed.html"><span class="header-section-number">11</span> Análisis exploratorio de datos</a></li>
<li class="book-part">Fundamentos de estadística</li>
<li><a class="" href="Funda-probab.html"><span class="header-section-number">12</span> Probabilidad</a></li>
<li><a class="" href="Fundainfer.html"><span class="header-section-number">13</span> Inferencia estadística</a></li>
<li><a class="" href="muestreo.html"><span class="header-section-number">14</span> Muestreo y remuestreo</a></li>
<li class="book-part">Modelización estadística</li>
<li><a class="" href="cap-lm.html"><span class="header-section-number">15</span> Modelización lineal</a></li>
<li><a class="" href="cap-glm.html"><span class="header-section-number">16</span> Modelos lineales generalizados</a></li>
<li><a class="" href="cap-gam.html"><span class="header-section-number">17</span> Modelos aditivos generalizados</a></li>
<li><a class="" href="cap-mxm.html"><span class="header-section-number">18</span> Modelos mixtos</a></li>
<li><a class="" href="cap-sparse.html"><span class="header-section-number">19</span> Modelos \(\textit{sparse}\) y métodos penalizados de regresión</a></li>
<li><a class="" href="cap-series-temp.html"><span class="header-section-number">20</span> Modelización de series temporales</a></li>
<li><a class="" href="cap-discriminante.html"><span class="header-section-number">21</span> Análisis discriminante</a></li>
<li><a class="" href="cap-conjunto.html"><span class="header-section-number">22</span> Análisis conjunto</a></li>
<li><a class="" href="tablas-contingencia.html"><span class="header-section-number">23</span> Análisis de tablas de contingencia</a></li>
<li class="book-part">Machine learning supervisado</li>
<li><a class="" href="cap-arboles.html"><span class="header-section-number">24</span> Árboles de clasificación y regresión</a></li>
<li><a class="" href="cap-svm.html"><span class="header-section-number">25</span> Máquinas de vector soporte</a></li>
<li><a class="" href="cap-knn.html"><span class="header-section-number">26</span> Clasificador \(k\)-vecinos más próximos</a></li>
<li><a class="" href="cap-naive-bayes.html"><span class="header-section-number">27</span> Naive Bayes</a></li>
<li><a class="" href="cap-bagg-rf.html"><span class="header-section-number">28</span> Métodos ensamblados: \(\bf \textit {bagging}\) y \(\bf \textit{random}\) \(\bf \textit{forest}\)</a></li>
<li><a class="" href="cap-boosting-xgboost.html"><span class="header-section-number">29</span> \(\bf \textit{Boosting}\) y el algoritmo XGBoost</a></li>
<li class="book-part">Machine learning no supervisado</li>
<li><a class="" href="cap-cluster.html"><span class="header-section-number">30</span> Análisis clúster: clusterización jerárquica</a></li>
<li><a class="" href="no-jerarquico.html"><span class="header-section-number">31</span> Análisis clúster: clusterización no jerárquica</a></li>
<li><a class="" href="acp.html"><span class="header-section-number">32</span> Análisis de componentes principales</a></li>
<li><a class="" href="af.html"><span class="header-section-number">33</span> Análisis factorial</a></li>
<li><a class="" href="mds.html"><span class="header-section-number">34</span> Escalamiento multidimensional</a></li>
<li><a class="" href="correspondencias.html"><span class="header-section-number">35</span> Análisis de correspondencias</a></li>
<li class="book-part">Deep learning</li>
<li><a class="" href="capNN.html"><span class="header-section-number">36</span> Redes neuronales artificiales</a></li>
<li><a class="" href="cap-redes-convol.html"><span class="header-section-number">37</span> Redes neuronales convolucionales</a></li>
<li class="book-part">Ciencia de datos de texto y redes</li>
<li><a class="" href="mineria-textos.html"><span class="header-section-number">38</span> Minería de textos</a></li>
<li><a class="" href="grafos.html"><span class="header-section-number">39</span> Análisis de grafos y redes sociales</a></li>
<li class="book-part">Ciencia de datos espaciales</li>
<li><a class="" href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></li>
<li><a class="" href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="" href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li><a class="" href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></li>
<li class="book-part">Comunica y colabora</li>
<li><a class="" href="cap-120007-informes.html"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></li>
<li><a class="" href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></li>
<li><a class="active" href="geoproces.html"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li class="book-part">Casos de estudio en ciencia de datos</li>
<li><a class="" href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></li>
<li><a class="" href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></li>
<li><a class="" href="cap-twitter.html"><span class="header-section-number">50</span> ¿Cómo tuitea Elon Musk?</a></li>
<li><a class="" href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de RStudio a su periódico favorito</a></li>
<li><a class="" href="paro-clm.html"><span class="header-section-number">52</span> El impacto de las crisis financiera y de la COVID-19 en el paro de CLM</a></li>
<li><a class="" href="cap-rfm.html"><span class="header-section-number">53</span> Segmentación de clientes en el comercio minorista</a></li>
<li><a class="" href="cap-medicina.html"><span class="header-section-number">54</span> Análisis de datos en medicina</a></li>
<li><a class="" href="cap-futbol.html"><span class="header-section-number">55</span> Messi y Ronaldo: dos ídolos desde la perspectiva de los datos</a></li>
<li><a class="" href="cambioclimatico.html"><span class="header-section-number">56</span> Una nota sobre el cambio climático</a></li>
<li><a class="" href="cap-sist-exp.html"><span class="header-section-number">57</span> Implementación de un sistema experto en el ámbito pediátrico</a></li>
<li><a class="" href="cap-ree.html"><span class="header-section-number">58</span> Predicción de consumo eléctrico con redes neuronales artificiales</a></li>
<li><a class="" href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></li>
<li><a class="" href="cap-fraude.html"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></li>
<li><a class="" href="referencias.html">Referencias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="geoproces" class="section level1" number="47">
<h1>
<span class="header-section-number">Capítulo 47</span> Geoprocesamiento en nube<a class="anchor" aria-label="anchor" href="#geoproces"><i class="fas fa-link"></i></a>
</h1>
<p><em>Dominic Royé</em></p>
<p>Fundación de la Investigación del Clima</p>
<div id="introducción-24" class="section level2" number="47.1">
<h2>
<span class="header-section-number">47.1</span> Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n-24"><i class="fas fa-link"></i></a>
</h2>
<p>El planteamiento de un problema basado en datos de diversos proveedores habitualmente implica la descarga de grandes volúmenes de datos. La actual proliferación de servicios de Open Data, despliegues de sensores y diversas fuentes, incluyendo los satélites, dificulta su procesamiento en equipos personales. El gran crecimiento en grandes volúmenes de datos espaciotemporales de tipo vectorial o <em>raster</em> lleva a la necesidad en trabajar con servicios en nube para ahorrar tiempo computacional y espacio de almacenamiento. En la actualidad existen diferentes servicios de geoprocesamiento en nube que ayudan a hacer análisis online sin necesidad de descargar los datos ni preocuparse por el rendimiento computacional. Uno de estos servicios es Google Earth Engine (GEE), donde se combina un catálogo de varios petabytes de imágenes satelitales y conjuntos de datos geoespaciales multidimensionales (vectorial y <em>raster</em>) de alta resolución con capacidades de análisis a escala planetaria. Este servicio gratuito para uso no comercial incluye incluso la posibilidad de crear aplicaciones.</p>
<p>GEE consiste en una API con bibliotecas de cliente para JavaScript y Python que traducen (a la lengua nativa que es JavaScript) los análisis geoespaciales y hacen posible acceder a los datos. No es necesario descargar grandes volúmenes de datos ni configurar la computación. Para el lenguaje de <strong>R</strong> se puede hacer uso del paquete <code>rgee</code>, que hace puente entre <strong>R</strong> y la API GEE.</p>
<p>En este capítulo se utiliza el conjunto de datos “NOAA CDR OISST v02r01”, una interpolación óptima de la temperatura diaria de la superficie del mar (OISST, por sus siglas en inglés) con una resolución de 1/4 grados (27 km). Los datos los proporciona la National Oceanic and Atmospheric Administration (NOAA); son campos completos de temperatura oceánica construidos mediante la combinación de observaciones ajustadas por sesgo de diferentes plataformas (satélites, barcos, boyas) en una cuadrícula global regular, con lagunas estimadas por interpolación. Los datos satelitales del radiómetro avanzado de muy alta resolución (AVHRR, por sus siglas en inglés) proporcionan la entrada principal que permite la alta cobertura temporal-espacial desde finales de 1981 hasta el presente<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Véase &lt;a href="https://developers.google.com/earth-engine/datasets/catalog/NOAA_CDR_OISST_V2_1" class="uri"&gt;https://developers.google.com/earth-engine/datasets/catalog/NOAA_CDR_OISST_V2_1&lt;/a&gt;.&lt;/p&gt;'><sup>290</sup></a> <span class="citation">(<a href="referencias.html#ref-reynolds2008">R. W. Reynolds, Banzon, and Program 2008</a>)</span>.</p>
<p>Dicho lo anterior, el objetivo de este capítulo es mostrar el potencial del uso de las API directamente en <strong>R</strong>. El resultado se empleará en el Cap. <a href="cambioclimatico.html#cambioclimatico">56</a>.</p>
</div>
<div id="sintaxis-de-google-earth-engine" class="section level2" number="47.2">
<h2>
<span class="header-section-number">47.2</span> Sintaxis de Google Earth Engine<a class="anchor" aria-label="anchor" href="#sintaxis-de-google-earth-engine"><i class="fas fa-link"></i></a>
</h2>
<p>Con ayuda de GEE se preprocesan los datos de tal manera que el resultado son las anomalías estivales en forma de <em>raster</em> para cada año entre 1981 y 2022. El primer paso consiste en crear el usuario en <a href="earthengine.google.com">earthengine.google.com</a>. Además, es necesario instalar CLI de Gcloud (<a href="https://cloud.google.com/sdk/docs/install?hl=es-419" class="uri">https://cloud.google.com/sdk/docs/install?hl=es-419</a>).</p>
<p>No obstante, antes se deben conocer algunos conceptos fundamentales sobre la sintaxis en GEE. En general, el lenguaje nativo es Javascript, que se caracteriza por una gramática en la que se combinan funciones y variables usando el punto, que se sustituye por el “$” en <strong>R</strong>. Todas las funciones de GEE en <strong>R</strong> empiezan por el prefijo ee_* (<code>ee_print()</code>, <code>ee_image_to_drive()</code>). Los términos más relevantes son los siguientes:</p>
<ul>
<li>
<em>ImageCollection</em>: serie temporal de imágenes.</li>
<li>
<em>Geometry</em>: dato vectorial.</li>
<li>
<em>Functions</em>: <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> aplica funciones sobre <em>ImageCollections</em>, <code>ee.Date()</code> define una fecha, <code>filterDate()</code> permite filtrar por fecha una <em>ImageCollection</em>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> selecciona una banda, etc.</li>
</ul>
<p>Muchas funciones son similares a las de <code>tidyverse</code>.</p>
<p>Se puede obtener más información en <a href="https://r-spatial.github.io/rgee/reference/rgee-package.html" class="uri">https://r-spatial.github.io/rgee/reference/rgee-package.html</a> y en la propia página de GEE.</p>
</div>
<div id="primeros-pasos" class="section level2" number="47.3">
<h2>
<span class="header-section-number">47.3</span> Primeros pasos<a class="anchor" aria-label="anchor" href="#primeros-pasos"><i class="fas fa-link"></i></a>
</h2>
<p>Después de darse de alta en GEE y haber instalado CLI Gcloud en el sistema operativo, se crea un entorno virtual de Python con todas las dependencias de GEE usando la función <code>ee_install()</code>.</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/">rgee</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ee_install</span><span class="op">(</span><span class="op">)</span> <span class="co"># crear entorno virtual de Python; ¡solo una vez!</span></span>
<span><span class="fu">ee_check</span><span class="op">(</span><span class="op">)</span>   <span class="co"># comprobar si todo está correcto</span></span></code></pre></div>
<p>Antes de pasar a programar con la sintaxis propia de GEE, se debe autenticar e inicializar GEE empleando la función <code>ee_Initialize()</code>.</p>
<div class="sourceCode" id="cb719"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ee_Initialize</span><span class="op">(</span>drive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># autenticar e inicializar GEE</span></span>
<span><span class="fu">ee_user_info</span><span class="op">(</span><span class="op">)</span> <span class="co"># inf sobre usuario</span></span></code></pre></div>
<p>Hay que tener en cuenta que, únicamente cuando se envían tareas, GEE ejecuta el cálculo en los servidores enviando todos los objetos creados. En la mayoría de los pasos se crean objetos <em>EarthEngine</em> sin ejecutarse, que se ejecutan en las últimas fases del análisis.</p>
<p>Por ejemplo, se puede seleccionar la banda NDVI del producto MODIS MOD13A2 e imprimir los metadatos del primer día disponible con <code>ee_print()</code>. El número de elementos que se puede ver con esta función está limitado a 5.000.</p>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># imageCollection NDVI</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="st">'MODIS/006/MOD13A2'</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'NDVI'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># metadatos</span></span>
<span><span class="fu">ee_print</span><span class="op">(</span><span class="va">img</span><span class="op">$</span><span class="fu">first</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
</div>
<div id="cálculo-de-anomalías-en-la-temperatura-del-mar-mediterráneo" class="section level2" number="47.4">
<h2>
<span class="header-section-number">47.4</span> Cálculo de anomalías en la temperatura del mar Mediterráneo<a class="anchor" aria-label="anchor" href="#c%C3%A1lculo-de-anomal%C3%ADas-en-la-temperatura-del-mar-mediterr%C3%A1neo"><i class="fas fa-link"></i></a>
</h2>
<div id="definiciones-previas" class="section level3" number="47.4.1">
<h3>
<span class="header-section-number">47.4.1</span> Definiciones previas<a class="anchor" aria-label="anchor" href="#definiciones-previas"><i class="fas fa-link"></i></a>
</h3>
<p>Los datos NOAA CDR OISST contienen la temperatura oceánica superficial para todo el globo terráqueo; por eso, se fija un rectángulo que cubre la extensión del mar Mediterráneo como objeto de estudio.</p>
<div class="sourceCode" id="cb721"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extensión del Mar Mediterráneo</span></span>
<span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Polygon</span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6.046418548121442</span>, <span class="fl">46.733937391710846</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6.046418548121442</span>, <span class="fl">29.680544334046786</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42.469206451878556</span>, <span class="fl">29.680544334046786</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42.469206451878556</span>, <span class="fl">46.733937391710846</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    proj <span class="op">=</span> <span class="st">"EPSG:4326"</span>,</span>
<span>    geodesic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">geom</span> <span class="co">#vemos que es un objeto EarthEngine de tipo geometría</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span> <span class="co"># construcción javascript</span></span></code></pre></div>
<p>En el siguiente paso se define el período de interés: 1982-2022.</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startDate</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Date</span><span class="op">(</span><span class="st">'1982-01-01'</span><span class="op">)</span> <span class="co"># fecha inicio</span></span>
<span><span class="va">endDate</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Date</span><span class="op">(</span><span class="st">'2023-01-16'</span><span class="op">)</span> <span class="co"># fecha final</span></span></code></pre></div>
<p>Se puede acceder a todas las colecciones (<em>ImageCollection</em>) indicando su identifcación. Además, se filtran y se recortan los datos con respecto al período y a la extensión fijada. Finalmente se selecciona la banda o variable de interés <code>sst</code> (<em>surface sea temperature</em>).</p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collection_era5</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="st">"NOAA/CDR/OISST/V2_1"</span><span class="op">)</span><span class="op">$</span></span>
<span>                    <span class="fu">filterDate</span><span class="op">(</span><span class="va">startDate</span>, <span class="va">endDate</span><span class="op">)</span><span class="op">$</span></span>
<span>                      <span class="fu">filterBounds</span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">$</span></span>
<span>                       <span class="fu">select</span><span class="op">(</span><span class="st">'sst'</span><span class="op">)</span></span></code></pre></div>
<p>Por último, se procede a calcular el número de años en el período fijado.</p>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numberOfyears</span> <span class="op">&lt;-</span> <span class="va">endDate</span><span class="op">$</span><span class="fu">difference</span><span class="op">(</span><span class="va">startDate</span>, <span class="st">'years'</span><span class="op">)</span><span class="op">$</span><span class="fu">round</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="promedio-estival" class="section level3" number="47.4.2">
<h3>
<span class="header-section-number">47.4.2</span> Promedio estival<a class="anchor" aria-label="anchor" href="#promedio-estival"><i class="fas fa-link"></i></a>
</h3>
<p>Después de las anteriores definiciones se crea una nueva colección con el promedio estival de cada año durante el período objeto de estudio. Para ello se crea una lista de los años sobre la que se mapea otra función. Esta función se debe pasar con <code>ee_utilspyfunc()</code>, que traduce una función <strong>R</strong> a una de Python.</p>
<p>En la función personalizada se filtran los meses de verano, se calcula el promedio de sus valores diarios y se multiplica por 0,01, un factor de escala. Cuando se crean nuevas colecciones es importante fijar la nueva fecha con <code><a href="http://talgalili.github.io/dendextend/reference/set.html">set()</a></code>.</p>
<div class="sourceCode" id="cb725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span></span>
<span>  <span class="va">ee</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="fu">sequence</span><span class="op">(</span><span class="fl">0</span>, <span class="va">numberOfyears</span><span class="op">$</span><span class="fu">subtract</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span><span class="op">)</span><span class="op">$</span> </span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="fu">ee_utils_pyfunc</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">dayOffset</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">yr</span> <span class="op">=</span> <span class="va">startDate</span><span class="op">$</span><span class="fu">advance</span><span class="op">(</span><span class="va">dayOffset</span>, <span class="st">'years'</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'year'</span><span class="op">)</span></span>
<span>    <span class="va">start</span> <span class="op">=</span> <span class="va">ee</span><span class="op">$</span><span class="va">Date</span><span class="op">$</span><span class="fu">fromYMD</span><span class="op">(</span><span class="va">yr</span>, <span class="fl">12L</span>, <span class="fl">1L</span><span class="op">)</span></span>
<span>    <span class="va">end</span> <span class="op">=</span> <span class="va">ee</span><span class="op">$</span><span class="va">Date</span><span class="op">$</span><span class="fu">fromYMD</span><span class="op">(</span><span class="va">yr</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span>, <span class="fl">2L</span>, <span class="fl">28L</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">collection_era5</span><span class="op">$</span></span>
<span>    <span class="fu">filterDate</span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">multiply</span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">set</span><span class="op">(</span><span class="st">'system:time_start'</span>, <span class="va">start</span><span class="op">$</span><span class="fu">millis</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>En el siguiente paso se calcula la temperatura media estival entre 1982 y 2010, como período de referencia para las anomalías.</p>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msst</span> <span class="op">&lt;-</span> <span class="va">collection_era5</span><span class="op">$</span><span class="fu">filterDate</span><span class="op">(</span><span class="st">'1982-01-01'</span>,<span class="st">'2010-12-31'</span><span class="op">)</span><span class="op">$</span></span>
<span>         <span class="fu">filter</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Filter</span><span class="op">$</span><span class="fu">calendarRange</span><span class="op">(</span><span class="fl">12L</span>,<span class="fl">2L</span>,<span class="st">'month'</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>          <span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>            <span class="fu">multiply</span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>Se aplica otra función personalizada sobre las medias estivales de todos los años en la que se resta la temperatura del período de referencia, obteniéndose así las diferencias entre la temperatura media de cada año en el período estival y la temperatura media global del período estival en 1982-2010.</p>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anom</span> <span class="op">&lt;-</span> <span class="va">yearly</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span><span class="fu">ee_utils_pyfunc</span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="va">im</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">im</span><span class="op">$</span><span class="fu">subtract</span><span class="op">(</span><span class="va">msst</span><span class="op">)</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">'system:time_start'</span>,           </span>
<span>                         <span class="va">im</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'system:time_start'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Se puede crear un mapa interactivo de un año concreto aplicando la función <code>Map.addLayer()</code> (Fig. <a href="geoproces.html#fig:interactive-map-plot">47.1</a>). En este paso es la primera vez que GEE calcula lo que se ha creado anteriormente.</p>
<div class="sourceCode" id="cb728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metadatos </span></span>
<span><span class="fu">ee_print</span><span class="op">(</span><span class="va">anom</span><span class="op">$</span><span class="fu">first</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># año 1982</span></span>
<span></span>
<span><span class="co"># mapa interactiva del año 1982</span></span>
<span><span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="fl">9</span>, <span class="fl">40</span>, <span class="fl">5</span><span class="op">)</span> <span class="co"># centrar mapa en el mediterráneo con nivel de zoom 5</span></span>
<span></span>
<span><span class="co"># crear mapa con leyenda</span></span>
<span><span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span></span>
<span>  eeObject <span class="op">=</span> <span class="va">anom</span><span class="op">$</span><span class="fu">first</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  visParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/flip.html">rev</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>,</span>
<span>    max <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"MED_SST"</span></span>
<span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="va">Map</span><span class="op">$</span><span class="fu">addLegend</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, max <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                    palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/flip.html">rev</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              name <span class="op">=</span> <span class="st">"SST Anomaly"</span>, </span>
<span>              position <span class="op">=</span> <span class="st">"bottomright"</span>, </span>
<span>              bins <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:interactive-map-plot"></span>
<img src="img/interactivo_mapa_geopro.png" alt="Mapa interactivo del mar Mediterráneo (1982)." width="60%"><p class="caption">
Figura 47.1: Mapa interactivo del mar Mediterráneo (1982).
</p>
</div>
<p>Hasta este momento no se ha enviado una tarea para que GEE la realice. Para ello hay que exportar las anomalías de cada año en formato <code>geotiff</code>. La función <code>ee_imagecollection_to_local()</code> facilita la exportación de todas las capas de una <em>ImageCollection</em>. En cambio, la función <code>ee_image_to_drive()</code> exporta datos individuales de una única imagen a Google Drive. El argumento <code>scale</code> indica con qué resolución se exporta. Aunque la resolución de los datos originales es de 27 km, se fija una resolución de 2 km, lo que implica una interpolación en la exportación por razones de estética en la visualización.</p>
<div class="sourceCode" id="cb729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># carpeta temporal o cualquier otra ruta</span></span>
<span></span>
<span><span class="va">ic_drive_files_2</span> <span class="op">&lt;-</span> <span class="fu">ee_imagecollection_to_local</span><span class="op">(</span></span>
<span>  ic <span class="op">=</span> <span class="va">anom</span>,</span>
<span>  region <span class="op">=</span> <span class="va">geom</span>,</span>
<span>  fileFormat <span class="op">=</span> <span class="st">"GEO_TIFF"</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  lazy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"rast_"</span><span class="op">)</span>, <span class="co"># prefijo del archivo</span></span>
<span>  add_metadata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>En resumen, este ejemplo ha mostrado una pequeña parte de la capacidad del geoprocesamiento en manejar grandes volúmenes de datos sin que implique su descarga ni el cálculo localmente. Pero también es posible manejar datos vectoriales u otros datos de alta resolución. Incluso se puede llegar a crear apliaciones basadas en GEE.</p>
</div>
<div id="resumen-46" class="section level3 unnumbered infobox_resume">
<h3>Resumen<a class="anchor" aria-label="anchor" href="#resumen-46"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>El aumento del volumen de datos que ha tenido lugar en los últimos años ha llevado a la necesidad de utilizar servicios de geoprocesamiento en nube que ayuden a llevar a cabo su análisis online, sin necesidad de descargar los datos ni de preocuparse por el rendimiento computacional.</p></li>
<li><p>Uno de estos servicios es Google Earth Engine, donde se combina un catálogo de imágenes satelitales y conjuntos de datos geoespaciales multidimensionales de alta resolución con capacidades de análisis a escala planetaria.</p></li>
<li><p>En este ejemplo que se utiliza en el capítulo, se muestra cómo procesar la temperatura oceánica superficial para calcular las anomalías de temperatura de la cuenca mediterránea en la estación estival, desde 1982 a 2022.</p></li>
</ul>
</div>

</div>
</div>




  <div class="chapter-nav">
<div class="prev"><a href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></div>
<div class="next"><a href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Índice del capítulo"><h2>Índice del capítulo</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#geoproces"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li><a class="nav-link" href="#introducci%C3%B3n-24"><span class="header-section-number">47.1</span> Introducción</a></li>
<li><a class="nav-link" href="#sintaxis-de-google-earth-engine"><span class="header-section-number">47.2</span> Sintaxis de Google Earth Engine</a></li>
<li><a class="nav-link" href="#primeros-pasos"><span class="header-section-number">47.3</span> Primeros pasos</a></li>
<li>
<a class="nav-link" href="#c%C3%A1lculo-de-anomal%C3%ADas-en-la-temperatura-del-mar-mediterr%C3%A1neo"><span class="header-section-number">47.4</span> Cálculo de anomalías en la temperatura del mar Mediterráneo</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#definiciones-previas"><span class="header-section-number">47.4.1</span> Definiciones previas</a></li>
<li><a class="nav-link" href="#promedio-estival"><span class="header-section-number">47.4.2</span> Promedio estival</a></li>
<li><a class="nav-link" href="#resumen-46">Resumen</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentos de ciencia de datos con <strong>R</strong></strong>" coordinado por <a href="https://blog.uclm.es/gemafaviles/" class="text-light">Gema Fernández-Avilés y José-María Montero</a>. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro ha sido generado con el paquete de R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

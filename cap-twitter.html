<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 50 ¿Cómo twitea Elon Musk? | Fundamentos de ciencia de datos con R</title>
<meta name="author" content="Gema Fernández-Avilés y José-María Montero">
<meta name="description" content="Mariluz Congosto Universidad Carlos III de madrid  50.1 Introducción  El objetivo de este caso de uso es arrojar luz, de manera objetiva, sobre un fenómeno social de interés general: el uso de...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Capítulo 50 ¿Cómo twitea Elon Musk? | Fundamentos de ciencia de datos con R">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/cover.png">
<meta property="og:description" content="Mariluz Congosto Universidad Carlos III de madrid  50.1 Introducción  El objetivo de este caso de uso es arrojar luz, de manera objetiva, sobre un fenómeno social de interés general: el uso de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 50 ¿Cómo twitea Elon Musk? | Fundamentos de ciencia de datos con R">
<meta name="twitter:description" content="Mariluz Congosto Universidad Carlos III de madrid  50.1 Introducción  El objetivo de este caso de uso es arrojar luz, de manera objetiva, sobre un fenómeno social de interés general: el uso de...">
<meta name="twitter:image" content="/img/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="bs4_book.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentos de ciencia de datos con R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
</form>

      <nav aria-label="Contenido"><h2>Contenido</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Ciencia, datos, software… y científicos</li>
<li><a class="" href="ciencia-datos.html"><span class="header-section-number">1</span> ¿Es la ciencia de datos una ciencia?</a></li>
<li><a class="" href="metodologia.html"><span class="header-section-number">2</span> Metodología en ciencia de datos</a></li>
<li><a class="" href="ch-110003.html"><span class="header-section-number">3</span> R para ciencia de datos</a></li>
<li><a class="" href="cap-etica.html"><span class="header-section-number">4</span> Ética en la ciencia de datos</a></li>
<li class="book-part">Bienvenidos a la jungla de datos</li>
<li><a class="" href="datos-sql.html"><span class="header-section-number">5</span> Gestión de bases de datos relacionales</a></li>
<li><a class="" href="cap-nosql.html"><span class="header-section-number">6</span> Gestión de bases de datos NoSQL</a></li>
<li><a class="" href="DGDQM.html"><span class="header-section-number">7</span> Gobierno, gestión y calidad del dato</a></li>
<li><a class="" href="id_130009.html"><span class="header-section-number">8</span> Integración y limpieza de datos</a></li>
<li><a class="" href="chap-feature.html"><span class="header-section-number">9</span> Selección y transformación de variables</a></li>
<li><a class="" href="chap-herramientas.html"><span class="header-section-number">10</span> Herramientas para el análisis en ciencia de datos</a></li>
<li><a class="" href="id_120006-aed.html"><span class="header-section-number">11</span> Análisis exploratorio de datos</a></li>
<li class="book-part">Fundamentos de estadística</li>
<li><a class="" href="Funda-probab.html"><span class="header-section-number">12</span> Probabilidad</a></li>
<li><a class="" href="Fundainfer.html"><span class="header-section-number">13</span> Inferencia estadística</a></li>
<li><a class="" href="muestreo.html"><span class="header-section-number">14</span> Muestreo y remuestreo</a></li>
<li class="book-part">Modelización estadística</li>
<li><a class="" href="cap-lm.html"><span class="header-section-number">15</span> Modelización lineal</a></li>
<li><a class="" href="cap-glm.html"><span class="header-section-number">16</span> Modelos lineales generalizados</a></li>
<li><a class="" href="cap-gam.html"><span class="header-section-number">17</span> Modelos aditivos generalizados</a></li>
<li><a class="" href="cap-mxm.html"><span class="header-section-number">18</span> Modelos mixtos</a></li>
<li><a class="" href="cap-sparse.html"><span class="header-section-number">19</span> Modelos sparse y métodos penalizados de regresión</a></li>
<li><a class="" href="cap-series-temp.html"><span class="header-section-number">20</span> Modelización de series temporales</a></li>
<li><a class="" href="cap-discriminante.html"><span class="header-section-number">21</span> Análisis discriminante</a></li>
<li><a class="" href="cap-conjunto.html"><span class="header-section-number">22</span> Análisis conjunto</a></li>
<li><a class="" href="tablas-contingencia.html"><span class="header-section-number">23</span> Análisis de tablas de contingencia</a></li>
<li class="book-part">Machine learning supervisado</li>
<li><a class="" href="cap-arboles.html"><span class="header-section-number">24</span> Árboles de clasificación y regresión</a></li>
<li><a class="" href="cap-svm.html"><span class="header-section-number">25</span> Máquinas de vector soporte</a></li>
<li><a class="" href="cap-knn.html"><span class="header-section-number">26</span> Clasificador k-vecinos más próximos</a></li>
<li><a class="" href="cap-naive-bayes.html"><span class="header-section-number">27</span> Naive Bayes</a></li>
<li><a class="" href="cap-bagg-rf.html"><span class="header-section-number">28</span> Métodos ensamblados: bagging y random forest</a></li>
<li><a class="" href="cap-boosting-xgboost.html"><span class="header-section-number">29</span> Boosting y el algoritmo XGBoost</a></li>
<li class="book-part">Machine learning no supervisado</li>
<li><a class="" href="jerarquico.html"><span class="header-section-number">30</span> Análisis cluster: clusterización jerárquica</a></li>
<li><a class="" href="no-jerarquico.html"><span class="header-section-number">31</span> Análisis cluster: clusterización no jerárquica</a></li>
<li><a class="" href="acp.html"><span class="header-section-number">32</span> Análisis de componentes principales</a></li>
<li><a class="" href="an%C3%A1lisis-factorial.html"><span class="header-section-number">33</span> Análisis factorial</a></li>
<li><a class="" href="escalamiento-multidimensional.html"><span class="header-section-number">34</span> Escalamiento multidimensional</a></li>
<li><a class="" href="correspondencias.html"><span class="header-section-number">35</span> Análisis de correspondencias</a></li>
<li class="book-part">Deep learning</li>
<li><a class="" href="capNN.html"><span class="header-section-number">36</span> Redes neuronales artificiales</a></li>
<li><a class="" href="cap-redes-convol.html"><span class="header-section-number">37</span> Redes neuronales convolucionales</a></li>
<li class="book-part">Ciencia de datos de texto y redes</li>
<li><a class="" href="mineria-textos.html"><span class="header-section-number">38</span> Minería de textos</a></li>
<li><a class="" href="grafos.html"><span class="header-section-number">39</span> Análisis de grafos y redes sociales</a></li>
<li class="book-part">Ciencia de datos espaciales</li>
<li><a class="" href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></li>
<li><a class="" href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="" href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li><a class="" href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></li>
<li class="book-part">Comunica y colabora</li>
<li><a class="" href="id_120007-informes.html"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></li>
<li><a class="" href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></li>
<li><a class="" href="geoproces.html"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li class="book-part">Casos de estudio en ciencia de datos</li>
<li><a class="" href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></li>
<li><a class="" href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></li>
<li><a class="active" href="cap-twitter.html"><span class="header-section-number">50</span> ¿Cómo twitea Elon Musk?</a></li>
<li><a class="" href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de Rstudio a su periódico</a></li>
<li><a class="" href="paro-clm.html"><span class="header-section-number">52</span> Crisis: impacto en el paro de Castilla-La Mancha</a></li>
<li><a class="" href="cap-rfm.html"><span class="header-section-number">53</span> Segmentación de clientes en el comerico minorista</a></li>
<li><a class="" href="cap-medicina.html"><span class="header-section-number">54</span> Análisis de datos en medicina</a></li>
<li><a class="" href="cap-futbol.html"><span class="header-section-number">55</span> Messi y Ronaldo: dos ídolos desde la perspectiva de los datos</a></li>
<li><a class="" href="cambioclimatico.html"><span class="header-section-number">56</span> Un dato sobre el cambio climático</a></li>
<li><a class="" href="cap-ree.html"><span class="header-section-number">57</span> Predicción de consumo eléctrico con redes neuronales</a></li>
<li><a class="" href="cap-sist-exp.html"><span class="header-section-number">58</span> Implementación de un sistema experto en el ámbito pediátrico</a></li>
<li><a class="" href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></li>
<li><a class="" href="cap-fraude.html"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></li>
<li><a class="" href="referncias.html">Referncias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cap-twitter" class="section level1" number="50">
<h1>
<span class="header-section-number">Capítulo 50</span> ¿Cómo twitea Elon Musk?<a class="anchor" aria-label="anchor" href="#cap-twitter"><i class="fas fa-link"></i></a>
</h1>
<p><em>Mariluz Congosto</em></p>
<p>Universidad Carlos III de madrid</p>
<div id="introducción-25" class="section level2" number="50.1">
<h2>
<span class="header-section-number">50.1</span> Introducción <a class="anchor" aria-label="anchor" href="#introducci%C3%B3n-25"><i class="fas fa-link"></i></a>
</h2>
<p>El objetivo de este caso de uso es arrojar luz, de manera objetiva, sobre un <strong>fenómeno social</strong> de interés general: el uso de Twitter por parte de <strong>Elon Musk</strong>. Este multimillonario adquirió la red social el 28 de octubre de 2022 y, desde entonces, ha tomado decisiones drásticas, como reducir la plantilla y lanzar nuevos servicios de pago de manera apresurada. Su constante cambio de rumbo queda reflejado en su actividad frenética en Twitter, donde es un usuario muy activo.</p>
<p>Este caso de estudio aborda, una vez descargados los <em>tweets</em> mediante las <strong>APIs de Twitter</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Para el caso de estudio que se desarrolla se ha usado la librería &lt;code&gt;rtweet&lt;/code&gt; para acceder a la &lt;strong&gt;API Standard (V1.1)&lt;/strong&gt; (accesible a todo el mundo). Para obtener las credenciales que permiten trabajar en &lt;strong&gt;modo usuario&lt;/strong&gt; se facilita el script de &lt;strong&gt;python make_token_Twitter.ipynb&lt;/strong&gt; en github &lt;a href="https://github.com/congosto/token_API_V1.1**" class="uri"&gt;https://github.com/congosto/token_API_V1.1**&lt;/a&gt;. Este &lt;em&gt;script&lt;/em&gt; se puede ejecutar en el entorno Google Colab &lt;a href="https://colab.research.google.com/" class="uri"&gt;https://colab.research.google.com/&lt;/a&gt;.&lt;/p&gt;'><sup>249</sup></a>, cómo adaptarlos mediante minería de textos (<a href="mineria-textos.html#mineria-textos">38</a>) para su <strong>análisis</strong> y <strong>visualización</strong>. Se representa el contenido de estos mensajes mediante nubes de palabras, <em>scatters plots</em> y <em>timelines</em>. Este conjunto de gráficas ofrecerán distintas vistas de los datos que, sin duda, ayudarán a comprender los cambios de comunicación desde que adquirió Twitter.</p>
</div>
<div id="análisis-visual-de-los-tweets-de-elon-musk" class="section level2" number="50.2">
<h2>
<span class="header-section-number">50.2</span> Análisis visual de los <em>tweets</em> de Elon Musk <a class="anchor" aria-label="anchor" href="#an%C3%A1lisis-visual-de-los-tweets-de-elon-musk"><i class="fas fa-link"></i></a>
</h2>
<p>Las librerías que se utilizan son las siguientes:</p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span>    <span class="co"># manipulación de datos</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org">"lubridate"</a></span><span class="op">)</span>    <span class="co"># formato de fechas</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://scales.r-lib.org">"scales"</a></span><span class="op">)</span>       <span class="co"># manejo de escalas numéricas</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/juliasilge/tidytext">"tidytext"</a></span><span class="op">)</span>     <span class="co"># manipulación de textos</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lepennec/ggwordcloud">"ggwordcloud"</a></span><span class="op">)</span>  <span class="co"># creación de una nube de palabras</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"RColorBrewer"</span><span class="op">)</span> <span class="co"># paleta de colores</span></span></code></pre></div>
<p>El rango de fechas elegido para delimitar temporalmente los tweets de Elon Musk va desde el 16-06-2022 hasta el 22-12-2022. Este rango es adecuado para visualizar la actividad e impacto del perfil de Musk antes y después de la adquisición de Twitter.</p>
<p>Se cargan los datos de la librería <code>CDR</code> del libro.</p>
<div class="sourceCode" id="cb746"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tweets_user</span> <span class="op">&lt;-</span> <span class="fu">CDR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/CDR/man/elon_musk.html">elon_musk</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Cambiar a formato fecha</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>created_at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">created_at</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%dT%H:%M:%S"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span> <span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Una vez obtenidos los datos, se les puede dar forma. Los datos incluyen fechas, textos, tipos de <em>tweets</em> y métricas que pueden ser representados mediante gráficos. A continuación, se definen unos parámetros generales a todas las gráficas: la fecha de la compra de Twitter, el color de los distintos tipos de mensajes (<em>original</em>, <em>quoted</em>, <em>reply</em>, <em>retweeted</em>).</p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fecha en la que Elon Musk compró Twitter</span></span>
<span><span class="va">compra_twitter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2022-10-28"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Se ordena la leyenda del tipo de tweet</span></span>
<span><span class="va">order_tipo_tweet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"quoted"</span>, <span class="st">"reply"</span>, <span class="st">"retweeted"</span><span class="op">)</span></span>
<span><span class="va">tweets_user</span><span class="op">$</span><span class="va">tipo_tweet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">tweets_user</span><span class="op">$</span><span class="va">tipo_tweet</span>, levels <span class="op">=</span> <span class="va">order_tipo_tweet</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Se define el color de los elementos de la leyenda del tipo de tweet</span></span>
<span><span class="va">my_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"retweeted"</span> <span class="op">=</span> <span class="st">"purple"</span>, <span class="st">"reply"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"quoted"</span> <span class="op">=</span> <span class="st">"green"</span>, <span class="st">"original"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div id="cuáles-son-los-temas-más-recurrentes" class="section level3" number="50.2.1">
<h3>
<span class="header-section-number">50.2.1</span> ¿Cuáles son los temas más recurrentes? <a class="anchor" aria-label="anchor" href="#cu%C3%A1les-son-los-temas-m%C3%A1s-recurrentes"><i class="fas fa-link"></i></a>
</h3>
<p>Para representar los términos más frecuentes en los tweets de Elon Musk se utiliza una nube de palabras. Esta representación gráfica se crea mediante la librería <code>ggwordcloud</code>, que funciona en el entorno <code>ggplot</code>.</p>
<p>El texto de los mensajes se encuentra en la variable <code>full_text</code>, la cual se limpia eliminando las URLs y los <em>handles</em> de los usuarios. Además, se añade una columna para distinguir los textos anteriores y posteriores a la compra de Twitter.</p>
<p>Posteriormente, se descomponen los textos en palabras independientes, se eliminan las <em>stop words</em> y se calcula la frecuencia de aparición de cada palabra.</p>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">stop_words</span><span class="op">)</span> <span class="co"># Descarga las stop words de la librería tidytext</span></span>
<span></span>
<span><span class="va">corpus_text</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>text_plain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"http\\S+\\s*"</span>, <span class="st">""</span>, <span class="va">full_text</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Quita las URL</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>text_plain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"RT @\\w+:"</span>, <span class="st">""</span>, <span class="va">text_plain</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Quita los RTs</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>text_plain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"&amp;amp;"</span>, <span class="st">"&amp;"</span>, <span class="va">text_plain</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Rectifica el &amp;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>text_plain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"@\\w+"</span>, <span class="st">""</span>, <span class="va">text_plain</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Quita las menciones</span></span>
<span>  <span class="co"># Crea una columna para distinguir el periodo antes/después de la compra</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>periodo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">created_at</span> <span class="op">&lt;</span> <span class="va">compra_twitter</span>,</span>
<span>    <span class="st">"Antes de la compra"</span>, <span class="st">"Después de la compra"</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">text_plain</span>, <span class="va">periodo</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">text_plain</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Convierte las frases en un conjunto de palabras</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">stop_words</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Elimina las stop words</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">periodo</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Agrupa por palabras</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> freq <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Calcula la frecuencia de cada palabra</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span><span class="op">)</span> <span class="co"># Ordena de mayor a menor frecuencia de aparición</span></span>
<span></span>
<span><span class="co"># print (corpus_text) # Descomentar para ver el resultado final </span></span></code></pre></div>
<p>Para generar la nube de palabras de Elon Musk, se utiliza la función <code><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area()</a></code>. Esta función toma como entrada la lista de palabras y su frecuencia, y genera una comparación entre antes y después de la compra de Twitter (Fig. <a href="cap-twitter.html#fig:elon-musk-nube-words">50.1</a>.</p>
<p>La proporción del tamaño de las palabras en la nube está en función de su frecuencia y se utiliza la librería <code>RColorBrewer</code> para definir la paleta de colores.</p>
<p>El resultado muestra que, antes de la compra de Twitter, Musk centraba su atención en sus empresas y en la guerra de Rusia-Ucrania. Sin embargo, tras la adquisición, su temática se relaciona con su nueva propiedad.</p>
<div class="sourceCode" id="cb749"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paleta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"Dark2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">corpus_text</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">word</span>, group <span class="op">=</span> <span class="va">periodo</span>, size <span class="op">=</span> <span class="va">freq</span>, color <span class="op">=</span> <span class="va">freq</span><span class="op">)</span>,</span>
<span>    angle <span class="op">=</span> <span class="fl">0.35</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_area</a></span><span class="op">(</span>max_size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span> <span class="op">+</span> <span class="co"># tamaño de las letras según frecuencia</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="va">paleta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">periodo</span><span class="op">)</span> <span class="op">+</span> <span class="co"># desdobla gráfica</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span> <span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey50"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:elon-musk-nube-words"></span>
<img src="212050_cd_elon_musk_files/figure-html/elon-musk-nube-words-1.png" alt="Palabras más frecuentes de Elon Musk en Twitter, antes y después de su compra" width="60%"><p class="caption">
Figura 50.1: Palabras más frecuentes de Elon Musk en Twitter, antes y después de su compra
</p>
</div>
</div>
<div id="quiénes-son-los-usuarios-con-los-que-más-conversa" class="section level3" number="50.2.2">
<h3>
<span class="header-section-number">50.2.2</span> ¿Quiénes son los usuarios con los que más conversa? <a class="anchor" aria-label="anchor" href="#qui%C3%A9nes-son-los-usuarios-con-los-que-m%C3%A1s-conversa"><i class="fas fa-link"></i></a>
</h3>
<p>Es posible visualizar con quiénes ha conversado Elon Musk con mayor frecuencia. Para ello, se pueden utilizar las respuestas que ha dado a otros usuarios en Twitter. Estas respuestas se obtienen de la variable <code>full_text</code>.</p>
<p>Para identificar con quiénes ha interactuado más Musk, se extraen los <em>handles</em> de los comentarios y se añade una columna para distinguir las menciones antes y después de la adquisición de Twitter. A continuación, se calcula la frecuencia de aparición de cada <em>handle</em>.</p>
<div class="sourceCode" id="cb750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">stop_words</span><span class="op">)</span></span>
<span><span class="va">corpus_menciones</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Extrae los handles de los comentarios con una expresión regular "@\\w+"</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mentions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tipo_tweet</span> <span class="op">==</span> <span class="st">"reply"</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">full_text</span>, <span class="st">"@\\w+"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Crea una columna para distinguir el periodo antes/después de la compra</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>periodo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">created_at</span> <span class="op">&lt;</span> <span class="va">compra_twitter</span>,</span>
<span>    <span class="st">"Antes de la compra"</span>, <span class="st">"Después de la compra"</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">mentions</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>    <span class="co"># elimina las filas vacías</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mentions</span>, <span class="va">periodo</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co"># selecciona menciones y periodo</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mentions</span>, <span class="va">periodo</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> freq <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,  .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># calcula frec. de palabra</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span><span class="op">)</span> <span class="co"># ordena de mayor a menor frec. de aparición</span></span>
<span></span>
<span><span class="co"># print (corpus_menciones) # Descomentar para ver el resultado final </span></span></code></pre></div>
<p>Una vez que los datos han sido procesados, se utiliza la función <code><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area()</a></code> para generar la nube de palabras correspondiente a las menciones en los tweets de Elon Musk.</p>
<p>Para ello, se toma la lista de menciones y su frecuencia, y se utiliza la misma operación que se realizó con la nube de palabras anterior.</p>
<p>El resultado (Fig. <a href="cap-twitter.html#fig:elon-musk-nube-menciones">50.2</a>) muestra que algunos interlocutores se mantienen, otros pierden protagonismo y aparecen otros nuevos. Se mantienen @BillyM2k (comediante) y @WholeMarsBlog (relacionado con temas de Marte). Pierden protagonismo @teslaownersSVm, @EvaFoxU, @PPathole y @Teslarati (relacionados con Tesla). Ganan protagonismo @stillgray (<em>influencer</em>), @micsolana (capital riesgo) y @Jason (emprendedor).</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paleta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"Dark2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html">geom_text_wordcloud_area</a></span><span class="op">(</span> <span class="co">#  dibuja la nube de palabras</span></span>
<span>    data <span class="op">=</span> <span class="va">corpus_menciones</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">mentions</span>, size <span class="op">=</span> <span class="va">freq</span>, color <span class="op">=</span> <span class="va">freq</span><span class="op">)</span>, angle <span class="op">=</span> <span class="fl">0.35</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_area</a></span><span class="op">(</span>max_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="va">paleta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">periodo</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span> <span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey50"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:elon-musk-nube-menciones"></span>
<img src="212050_cd_elon_musk_files/figure-html/elon-musk-nube-menciones-1.png" alt="Usuarios con los que dialoga Elon Musk antes y después de la compra de Twitter" width="60%"><p class="caption">
Figura 50.2: Usuarios con los que dialoga Elon Musk antes y después de la compra de Twitter
</p>
</div>
</div>
<div id="cuál-es-su-rutina-de-publicación" class="section level3" number="50.2.3">
<h3>
<span class="header-section-number">50.2.3</span> ¿Cuál es su rutina de publicación? <a class="anchor" aria-label="anchor" href="#cu%C3%A1l-es-su-rutina-de-publicaci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Para analizar la distribución horaria de los tweets de Elon Musk, se examina la frecuencia de publicación de <em>tweets</em> cada hora de cada día. Dado que la residencia declarada de Musk es Austin (Texas), se ajustará la hora de los tweets al huso horario de esta ciudad, ya que la hora proporcionada por Twitter está en GMT.</p>
<p>Debido a que los datos abarcan un período largo, desde junio hasta diciembre, se acotarán a 15 días antes y después de la compra de Twitter. Es importante tener en cuenta que la fecha de creación de los tweets (<code>created_at</code>) se presenta en formato fecha-hora, y cada día consta de 86.400 segundos (60 segundos * 60 minutos * 24 horas).</p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tweets_user_hour</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Cambiamos al huso horario de Texas</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>created_at <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"US/Central"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Filtra los tweets anteriores a la compra de de Twitter</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">created_at</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="va">compra_twitter</span> <span class="op">-</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">created_at</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="va">compra_twitter</span> <span class="op">+</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una nueva columna para la fecha</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_in_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una nueva columna para la hora</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hour_tweet <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">created_at</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Agrupamos el número de tweets por tipo y hora</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time_in_days</span>, <span class="va">hour_tweet</span>, <span class="va">tipo_tweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Calculamos el número de tweets por día, hora y tipo</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> num_tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print (tweets_user_hour) # Descomentar para ver el resultado final </span></span></code></pre></div>
<p>A continuación, se recalcan los días de la semana que son festivos en color rojo para apreciar si hay distinta rutina.</p>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">festivos</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Cambiamos al huso horario de Texas</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>created_at <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"US/Central"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Filtramos los tweets anteriores a la compra de de Twitter</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">created_at</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="va">compra_twitter</span> <span class="op">-</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">created_at</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="va">compra_twitter</span> <span class="op">+</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una columna con el tiempo en días</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_in_days <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"1 day"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Agrupamos por día</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time_in_days</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculamos el número de tweets por día</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> num_tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una columna con el día de la semana</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week_day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">time_in_days</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una columna para colorear los días según sean festivos o no</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>festivo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">time_in_days</span><span class="op">)</span> <span class="op">==</span> <span class="fl">7</span> <span class="op">|</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">time_in_days</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print (festivos) # Desencomentar para ver el resultado final </span></span></code></pre></div>
<p>Finalmente, se representa un gráfico de dispersión (<em>scatter plot</em>) con las coordenadas de las horas del día (eje X) y los días seleccionados (eje Y), utilizando la función <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>. El tamaño del punto es proporcional al número de <em>tweets</em> en esa hora y día, y el color el tipo de tweet (<em>original</em>, <em>reply</em>, <em>quoted</em> y <em>retweeted</em>). Se marca una línea horizontal con la función <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline()</a></code> en la fecha de compra de Twitter y se crea un eje X doble para que sea más fácil ver las horas debido a la altura de la gráfica.</p>
<p>La Fig. <a href="cap-twitter.html#fig:elon-musk-rutina">50.3</a> muestra que no hay una rutina clara en la publicación de tweets de Elon Musk. Esto podría deberse a que viaja mucho. La mayoría de sus mensajes son comentarios y han aumentado considerablemente desde la compra de Twitter. El máximo número de <em>tweets</em> por hora fue 10.</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tweets_user_hour</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">hour_tweet</span>,</span>
<span>      y <span class="op">=</span> <span class="va">time_in_days</span>, </span>
<span>      size <span class="op">=</span> <span class="va">num_tweets</span>,</span>
<span>      color <span class="op">=</span> <span class="va">tipo_tweet</span></span>
<span>     <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># separa las fechas antes y después de la compra</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">compra_twitter</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># define una etiqueta de tiempo por día</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_y_datetime</a></span><span class="op">(</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%d-%b-%y(%a)"</span>, <span class="co"># formato fecha (día semana abreviado)</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 day"</span>, <span class="co"># una marca de tiempo cada día</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co"># ajustes de márgenes</span></span>
<span>  <span class="co"># Definimos una etiqueta para cada hora</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">23</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># crea un vector de 0 a 23</span></span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">dup_axis</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># duplica el eje X</span></span>
<span>  <span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span> x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">""</span>, size <span class="op">=</span> <span class="st">"N. tweets"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># ajusta las leyendas en dos filas para que no se trunquen</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># indica la posición de la leyenda y el color de las fechas</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">festivos</span><span class="op">$</span><span class="va">festivo</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:elon-musk-rutina"></span>
<img src="212050_cd_elon_musk_files/figure-html/elon-musk-rutina-1.png" alt="Rutina de publicación de Elon Musk. (huso horario de Texas)" width="60%"><p class="caption">
Figura 50.3: Rutina de publicación de Elon Musk. (huso horario de Texas)
</p>
</div>
</div>
<div id="cuál-es-su-timeline-de-publicación" class="section level3" number="50.2.4">
<h3>
<span class="header-section-number">50.2.4</span> ¿Cuál es su <em>timeline</em> de publicación? <a class="anchor" aria-label="anchor" href="#cu%C3%A1l-es-su-timeline-de-publicaci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Ahora se analiza cómo se distribuyen los <em>tweets</em> en el tiempo por tipo de tweet. Se resaltará la fecha de compra de Twitter con una anotación para facilitar la comparación de la frecuencia anterior y posterior a esta fecha.</p>
<p>Se crea una columna con la fecha redondeada a días, se agrupan los <em>tweets</em> por fecha y el tipo de tweet y se calcula su número para cada día.</p>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tweets_user_day</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una columna con el tiempo en días</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_in_days <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"1 day"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Agrupamos el número de tweets por día y tipo</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time_in_days</span>, <span class="va">tipo_tweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculalos el número de tweets por día y tipo</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> num_tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,  .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print (tweets_user_day) # descomentar para ver el resultado</span></span></code></pre></div>
<p>En la Fig. <a href="cap-twitter.html#fig:elon-musk-line-chart">50.4</a> se puede observar un incremento en el número de publicaciones después de la compra de Twitter. De hecho, se publicaron casi el doble de tweets en comparación con el periodo anterior a la adquisición de la plataforma. Asimismo, se puede ver, al igual que en la Fig. <a href="cap-twitter.html#fig:elon-musk-rutina">50.3</a>, que la mayoría de los <em>tweets</em> de Elon Musk fueron comentarios.</p>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tweets_user_day</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_in_days</span>, y <span class="op">=</span> <span class="va">num_tweets</span>, fill <span class="op">=</span> <span class="va">tipo_tweet</span><span class="op">)</span>,alpha <span class="op">=</span> <span class="fl">0.7</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">compra_twitter</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># compra de Twitter</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span> <span class="co"># señala el evento</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">compra_twitter</span> <span class="op">-</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">num_tweets</span><span class="op">)</span>,</span>
<span>      label <span class="op">=</span> <span class="st">"Elon Musk\ncompra Twitter"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"gray45"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op">(</span>   <span class="co"># flecha con curva para señalar el evento</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">compra_twitter</span> <span class="op">-</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">num_tweets</span><span class="op">)</span>,</span>
<span>      xend <span class="op">=</span> <span class="va">compra_twitter</span>,</span>
<span>      yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">num_tweets</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.80</span></span>
<span>    <span class="op">)</span>,</span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="st">"inch"</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"gray20"</span>, curvature <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_datetime</a></span><span class="op">(</span> <span class="co"># ajusta la escala de tiempo y su formato</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%d\n%b"</span>,</span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 week"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>  <span class="co"># ajusta el formato del eje Y</span></span>
<span>    name <span class="op">=</span> <span class="st">"Num. Tweets por día"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/number.html">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_color</span><span class="op">)</span> <span class="op">+</span> <span class="co"># aplica colores definidos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span> x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Num. Tweets por día"</span>, fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:elon-musk-line-chart"></span>
<img src="212050_cd_elon_musk_files/figure-html/elon-musk-line-chart-1.png" alt="Publicación de Tweets por día de Elon Musk" width="60%"><p class="caption">
Figura 50.4: Publicación de Tweets por día de Elon Musk
</p>
</div>
</div>
<div id="cuál-es-el-impacto-de-sus-tweets" class="section level3" number="50.2.5">
<h3>
<span class="header-section-number">50.2.5</span> ¿Cuál es el impacto de sus <em>tweets</em>? <a class="anchor" aria-label="anchor" href="#cu%C3%A1l-es-el-impacto-de-sus-tweets"><i class="fas fa-link"></i></a>
</h3>
<p>Para comparar los <em>tweets</em> propios publicados (sin <em>retweets</em>) y el impacto que reciben (<em>retweets</em> recibidos), se utilizará una gráfica de doble escala. Dado que ambas variables tienen diferentes órdenes de magnitud, este tipo de gráfica permitirá una mejor comparación. Además, se incluirá una anotación con la fecha de compra de Twitter para distinguir los cambios antes y después de este evento.</p>
<p>En esta gráfica se podrá ver cómo se van superponiendo capas de dibujo.</p>
<p>Se preparan los datos en dos <code>data.frames</code> y se calcula la relación de escala:</p>
<ul>
<li>
<code>tweets_propios_day</code> con de los <em>tweets</em> propios por día y los mensajes originales/hora:</li>
</ul>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tweets_propios_day</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una columna con el tiempo en días</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_in_days <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"1 day"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tipo_tweet</span> <span class="op">!=</span> <span class="st">"RT"</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co"># elimina los retweets</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time_in_days</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># agrupa los tweets por día</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> num_tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print (tweets_propios_day) # Descomentar para ver el resultado</span></span></code></pre></div>
<ul>
<li>
<code>tweets_RT_day</code> con los <em>retweets</em> recibidos por día:</li>
</ul>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tweets_RT_day</span> <span class="op">&lt;-</span> <span class="va">tweets_user</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creamos una columna con el tiempo en días</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_in_days <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">created_at</span>, <span class="st">"1 day"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tipo_tweet</span> <span class="op">!=</span> <span class="st">"RT"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time_in_days</span>, <span class="va">tipo_tweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> num_tweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">retweet_count</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print(tweets_RT_day) # descomentar para ver el resultado</span></span></code></pre></div>
<ul>
<li>Se calculan las escalas:</li>
</ul>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Máximo número de tweets propios</span></span>
<span><span class="va">max_tweets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">tweets_propios_day</span><span class="op">$</span><span class="va">num_tweets</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Máximo número de retweets recibidos</span></span>
<span><span class="va">max_RT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">tweets_RT_day</span><span class="op">$</span><span class="va">num_tweets</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ajuste_escala</span> <span class="op">&lt;-</span> <span class="va">max_RT</span> <span class="op">/</span> <span class="va">max_tweets</span> <span class="co"># Ajsute de escala</span></span>
<span><span class="co"># print (ajuste_escala)  # desencomentar para ver el ajuste</span></span>
<span><span class="va">my_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Num. original tweets"</span> <span class="op">=</span> <span class="st">"steelblue4"</span>, <span class="st">"RTs"</span> <span class="op">=</span> <span class="st">"red4"</span><span class="op">)</span></span></code></pre></div>
<p>La Fig. <a href="cap-twitter.html#fig:elon-musk-impacto">50.5</a> muestra un incremento masivo de los <em>retweets</em> recibidos desde la compra de Twitter, siendo el día que tomó posesión, el que generó el mayor pico: 800K RTs.</p>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Pinta la evolución de los tweets propios/día</span></span>
<span>  <span class="co"># Pinta el área que representa los tweets propios por día</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tweets_propios_day</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_in_days</span>, y <span class="op">=</span> <span class="va">num_tweets</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue4"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Pinta el borde del área por estética</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> data <span class="op">=</span> <span class="va">tweets_propios_day</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_in_days</span>, y <span class="op">=</span> <span class="va">num_tweets</span>, color <span class="op">=</span> <span class="st">"Num. original tweets"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Pinta la evolución de los RTs/día</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tweets_RT_day</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_in_days</span>, y <span class="op">=</span> <span class="va">num_tweets</span> <span class="op">/</span> <span class="va">ajuste_escala</span>, color <span class="op">=</span> <span class="st">"RTs"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Marcamos la linea de la compra de Twitter por Elon Musk</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">compra_twitter</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Anotamos el evento</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tweets_propios_day</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">compra_twitter</span> <span class="op">-</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">num_tweets</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.95</span>,</span>
<span>      label <span class="op">=</span> <span class="st">"Elon Musk\ncompra Twitter"</span><span class="op">)</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"grey50"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Dibuja una flecha con curva para señalar el evento</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tweets_propios_day</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">compra_twitter</span> <span class="op">-</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">num_tweets</span><span class="op">)</span>,</span>
<span>      xend <span class="op">=</span> <span class="va">compra_twitter</span>,</span>
<span>      yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">num_tweets</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.90</span></span>
<span>    <span class="op">)</span>,</span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="st">"inch"</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"gray20"</span>, curvature <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Ajusta la escala de tiempo y su formato</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_datetime</a></span><span class="op">(</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%d\n%b"</span>,</span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 week"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># doble escala, derecha: tweets propios, izquierda: retweets</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Num. Original tweets por día"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/number.html">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">sec_axis</a></span><span class="op">(</span></span>
<span>      trans <span class="op">=</span> <span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="va">ajuste_escala</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"RTs por día"</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/number.html">cut_short_scale</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_color</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,  color <span class="op">=</span> <span class="st">""</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"sans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue4"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    axis.title.y.right <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red4"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue4"</span><span class="op">)</span>,</span>
<span>    axis.text.y.right <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red4"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:elon-musk-impacto"></span>
<img src="212050_cd_elon_musk_files/figure-html/elon-musk-impacto-1.png" alt="Tweets vs. retweets de Elon Musk" width="60%"><p class="caption">
Figura 50.5: Tweets vs. retweets de Elon Musk
</p>
</div>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></div>
<div class="next"><a href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de Rstudio a su periódico</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Índice capítulo"><h2>Índice capítulo</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cap-twitter"><span class="header-section-number">50</span> ¿Cómo twitea Elon Musk?</a></li>
<li><a class="nav-link" href="#introducci%C3%B3n-25"><span class="header-section-number">50.1</span> Introducción </a></li>
<li>
<a class="nav-link" href="#an%C3%A1lisis-visual-de-los-tweets-de-elon-musk"><span class="header-section-number">50.2</span> Análisis visual de los tweets de Elon Musk </a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cu%C3%A1les-son-los-temas-m%C3%A1s-recurrentes"><span class="header-section-number">50.2.1</span> ¿Cuáles son los temas más recurrentes? </a></li>
<li><a class="nav-link" href="#qui%C3%A9nes-son-los-usuarios-con-los-que-m%C3%A1s-conversa"><span class="header-section-number">50.2.2</span> ¿Quiénes son los usuarios con los que más conversa? </a></li>
<li><a class="nav-link" href="#cu%C3%A1l-es-su-rutina-de-publicaci%C3%B3n"><span class="header-section-number">50.2.3</span> ¿Cuál es su rutina de publicación? </a></li>
<li><a class="nav-link" href="#cu%C3%A1l-es-su-timeline-de-publicaci%C3%B3n"><span class="header-section-number">50.2.4</span> ¿Cuál es su timeline de publicación? </a></li>
<li><a class="nav-link" href="#cu%C3%A1l-es-el-impacto-de-sus-tweets"><span class="header-section-number">50.2.5</span> ¿Cuál es el impacto de sus tweets? </a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentos de ciencia de datos con R</strong>" coordinado por <a href="https://blog.uclm.es/gemafaviles/" class="text-light">Gema Fernández-Avilés y José-María Montero</a>. Generado por última vez el día 2023-06-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro ha sido generado con el paquete de R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

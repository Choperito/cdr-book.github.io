<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 60 Detección de fraude de tarjetas de crédito | Fundamentos de ciencia de datos con R</title>
<meta name="author" content="Gema Fernández-Avilés y José-María Montero">
<meta name="description" content="Pedro Albarracín García  60.1 Introducción En un informe publicado en diciembre de 2021 por Nilson Report (https://nilsonreport.com/upload/content_promo/NilsonReport_Issue1209.pdf), se informó de...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Capítulo 60 Detección de fraude de tarjetas de crédito | Fundamentos de ciencia de datos con R">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/cover.png">
<meta property="og:description" content="Pedro Albarracín García  60.1 Introducción En un informe publicado en diciembre de 2021 por Nilson Report (https://nilsonreport.com/upload/content_promo/NilsonReport_Issue1209.pdf), se informó de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 60 Detección de fraude de tarjetas de crédito | Fundamentos de ciencia de datos con R">
<meta name="twitter:description" content="Pedro Albarracín García  60.1 Introducción En un informe publicado en diciembre de 2021 por Nilson Report (https://nilsonreport.com/upload/content_promo/NilsonReport_Issue1209.pdf), se informó de...">
<meta name="twitter:image" content="/img/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="bs4_book.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentos de ciencia de datos con R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
</form>

      <nav aria-label="Contenido"><h2>Contenido</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Ciencia, datos, software… y científicos</li>
<li><a class="" href="ciencia-datos.html"><span class="header-section-number">1</span> ¿Es la ciencia de datos una ciencia?</a></li>
<li><a class="" href="metodologia.html"><span class="header-section-number">2</span> Metodología en ciencia de datos</a></li>
<li><a class="" href="ch-110003.html"><span class="header-section-number">3</span> R para ciencia de datos</a></li>
<li><a class="" href="cap-etica.html"><span class="header-section-number">4</span> Ética en la ciencia de datos</a></li>
<li class="book-part">Bienvenidos a la jungla de datos</li>
<li><a class="" href="datos-sql.html"><span class="header-section-number">5</span> Gestión de bases de datos relacionales</a></li>
<li><a class="" href="cap-nosql.html"><span class="header-section-number">6</span> Gestión de bases de datos NoSQL</a></li>
<li><a class="" href="DGDQM.html"><span class="header-section-number">7</span> Gobierno, gestión y calidad del dato</a></li>
<li><a class="" href="id_130009.html"><span class="header-section-number">8</span> Integración y limpieza de datos</a></li>
<li><a class="" href="chap-feature.html"><span class="header-section-number">9</span> Selección y transformación de variables</a></li>
<li><a class="" href="chap-herramientas.html"><span class="header-section-number">10</span> Herramientas para el análisis en ciencia de datos</a></li>
<li><a class="" href="id_120006-aed.html"><span class="header-section-number">11</span> Análisis exploratorio de datos</a></li>
<li class="book-part">Fundamentos de estadística</li>
<li><a class="" href="Funda-probab.html"><span class="header-section-number">12</span> Probabilidad</a></li>
<li><a class="" href="Fundainfer.html"><span class="header-section-number">13</span> Inferencia estadística</a></li>
<li><a class="" href="muestreo.html"><span class="header-section-number">14</span> Muestreo y remuestreo</a></li>
<li class="book-part">Modelización estadística</li>
<li><a class="" href="cap-lm.html"><span class="header-section-number">15</span> Modelización lineal</a></li>
<li><a class="" href="cap-glm.html"><span class="header-section-number">16</span> Modelos lineales generalizados</a></li>
<li><a class="" href="cap-gam.html"><span class="header-section-number">17</span> Modelos aditivos generalizados</a></li>
<li><a class="" href="cap-mxm.html"><span class="header-section-number">18</span> Modelos mixtos</a></li>
<li><a class="" href="cap-sparse.html"><span class="header-section-number">19</span> Modelos sparse y métodos penalizados de regresión</a></li>
<li><a class="" href="cap-series-temp.html"><span class="header-section-number">20</span> Modelización de series temporales</a></li>
<li><a class="" href="cap-discriminante.html"><span class="header-section-number">21</span> Análisis discriminante</a></li>
<li><a class="" href="cap-conjunto.html"><span class="header-section-number">22</span> Análisis conjunto</a></li>
<li><a class="" href="tablas-contingencia.html"><span class="header-section-number">23</span> Análisis de tablas de contingencia</a></li>
<li class="book-part">Machine learning supervisado</li>
<li><a class="" href="cap-arboles.html"><span class="header-section-number">24</span> Árboles de clasificación y regresión</a></li>
<li><a class="" href="cap-svm.html"><span class="header-section-number">25</span> Máquinas de vector soporte</a></li>
<li><a class="" href="cap-knn.html"><span class="header-section-number">26</span> Clasificador k-vecinos más próximos</a></li>
<li><a class="" href="cap-naive-bayes.html"><span class="header-section-number">27</span> Naive Bayes</a></li>
<li><a class="" href="cap-bagg-rf.html"><span class="header-section-number">28</span> Métodos ensamblados: bagging y random forest</a></li>
<li><a class="" href="cap-boosting-xgboost.html"><span class="header-section-number">29</span> Boosting y el algoritmo XGBoost</a></li>
<li class="book-part">Machine learning no supervisado</li>
<li><a class="" href="jerarquico.html"><span class="header-section-number">30</span> Análisis cluster: clusterización jerárquica</a></li>
<li><a class="" href="no-jerarquico.html"><span class="header-section-number">31</span> Análisis cluster: clusterización no jerárquica</a></li>
<li><a class="" href="acp.html"><span class="header-section-number">32</span> Análisis de componentes principales</a></li>
<li><a class="" href="an%C3%A1lisis-factorial.html"><span class="header-section-number">33</span> Análisis factorial</a></li>
<li><a class="" href="escalamiento-multidimensional.html"><span class="header-section-number">34</span> Escalamiento multidimensional</a></li>
<li><a class="" href="correspondencias.html"><span class="header-section-number">35</span> Análisis de correspondencias</a></li>
<li class="book-part">Deep learning</li>
<li><a class="" href="capNN.html"><span class="header-section-number">36</span> Redes neuronales artificiales</a></li>
<li><a class="" href="cap-redes-convol.html"><span class="header-section-number">37</span> Redes neuronales convolucionales</a></li>
<li class="book-part">Ciencia de datos de texto y redes</li>
<li><a class="" href="mineria-textos.html"><span class="header-section-number">38</span> Minería de textos</a></li>
<li><a class="" href="grafos.html"><span class="header-section-number">39</span> Análisis de grafos y redes sociales</a></li>
<li class="book-part">Ciencia de datos espaciales</li>
<li><a class="" href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></li>
<li><a class="" href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="" href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li><a class="" href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></li>
<li class="book-part">Comunica y colabora</li>
<li><a class="" href="id_120007-informes.html"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></li>
<li><a class="" href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></li>
<li><a class="" href="geoproces.html"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li class="book-part">Casos de estudio en ciencia de datos</li>
<li><a class="" href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></li>
<li><a class="" href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></li>
<li><a class="" href="cap-twitter.html"><span class="header-section-number">50</span> ¿Cómo twitea Elon Musk?</a></li>
<li><a class="" href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de Rstudio a su periódico</a></li>
<li><a class="" href="paro-clm.html"><span class="header-section-number">52</span> Crisis: impacto en el paro de Castilla-La Mancha</a></li>
<li><a class="" href="cap-rfm.html"><span class="header-section-number">53</span> Segmentación de clientes en el comerico minorista</a></li>
<li><a class="" href="cap-medicina.html"><span class="header-section-number">54</span> Análisis de datos en medicina</a></li>
<li><a class="" href="cap-futbol.html"><span class="header-section-number">55</span> Messi y Ronaldo: dos ídolos desde la perspectiva de los datos</a></li>
<li><a class="" href="cambioclimatico.html"><span class="header-section-number">56</span> Un dato sobre el cambio climático</a></li>
<li><a class="" href="cap-ree.html"><span class="header-section-number">57</span> Predicción de consumo eléctrico con redes neuronales</a></li>
<li><a class="" href="cap-sist-exp.html"><span class="header-section-number">58</span> Implementación de un sistema experto en el ámbito pediátrico</a></li>
<li><a class="" href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></li>
<li><a class="active" href="cap-fraude.html"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></li>
<li><a class="" href="referncias.html">Referncias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cap-fraude" class="section level1" number="60">
<h1>
<span class="header-section-number">Capítulo 60</span> Detección de fraude de tarjetas de crédito<a class="anchor" aria-label="anchor" href="#cap-fraude"><i class="fas fa-link"></i></a>
</h1>
<p><em>Pedro Albarracín García</em></p>
<div id="introducción-30" class="section level2" number="60.1">
<h2>
<span class="header-section-number">60.1</span> Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n-30"><i class="fas fa-link"></i></a>
</h2>
<p>En un informe publicado en diciembre de 2021 por Nilson Report
(<a href="https://nilsonreport.com/upload/content_promo/NilsonReport_Issue1209.pdf" class="uri">https://nilsonreport.com/upload/content_promo/NilsonReport_Issue1209.pdf</a>),
se informó de que los emisores de tarjetas de crédito, comerciantes y
consumidores sufrieron un total de 28.580 millones de dólares de
pérdidas por fraude en 2020, es decir, 6,8 centavos por cada 100 dólares
en volumen de compras. El fraude sólo en USA representa el 35,83% del
total mundial.</p>
<p>En Europa la situación no es más alentadora. Según un informe del Banco
Central Europeo publicado en 2020
(<a href="https://www.ecb.europa.eu/pub/cardfraud/html/ecb.cardfraudreport202008~521edb602b.en.html#toc2" class="uri">https://www.ecb.europa.eu/pub/cardfraud/html/ecb.cardfraudreport202008~521edb602b.en.html#toc2</a>),
el valor total de las transacciones con tarjeta en la zona SEPA
ascendieron a 4.84 billones de euros en 2018, de los cuales 1.800
millones correspondieron a operaciones fraudulentas.</p>
<p>Las entidades financieras trabajan a diario en el desarrollo de modelos
de machine learning y deep learning que les permitan detectar, con la
mayor precisión posible, aquellas operaciones de compra con tarjetas de
crédito, débito o prepago que puedan ser sospechosas de fraude, o que al
menos puedan ser identificadas como anómalas. En este sentido, es
importante destacar que no existe una única solución posible, ya que el
problema presenta, en la mayoría de los casos, múltiples variantes que
hacen de éste, un problema complejo y que puede y debe ser abordado
desde múltiples perspectivas y con diferentes enfoques.</p>
<p>En primer lugar, es posible identificar dos tipos de fraude. Por un
lado, el que se comete físicamente, como, por ejemplo, la compra o la
retirada de efectivo con tarjetas robadas o falsas. Por otro lado, están
aquellas transacciones fraudulentas que se cometen online, en las que no
es necesaria la tarjeta física, y en las que se utilizan los datos de
las tarjetas obtenidas por los delincuentes mediante técnicas como el
phishing y que son utilizados posteriormente para realizar pagos online.</p>
<p>Otro hándicap asociado a este tipo de escenarios es el derivado de la
gran diversidad de fuentes de datos que forman parte de una transacción
y que pueden dar lugar a divergencias metodológicas, tanto en la
recogida y transmisión de los datos, como en su posterior almacenaje, lo
que ocasiona que, en muchos casos, la calidad de los datos disponibles
no sea la esperada, o simplemente nos encontremos ante datasets
inconsistentes. Los datos requeridos para este caso de uso pueden
categorizarse en variables relativas a:</p>
<p>• Cliente</p>
<p>• Transacción</p>
<p>• Geolocalización</p>
<p>• Comercio</p>
<p>• Tarjetas</p>
<p>• Hábitos de compra</p>
<p>Cada una de estas categorías, y otras que puedan aparecer aportan
información que permite abordar el problema desde diferentes ángulos.
Por un lado es posible enfocar el problema desde el punto de vista del
cliente y sus hábitos de compra para ver si existe alguna característica
anómala en una transacción, tal vez la hora de la compra, o quizás
analizar los datos de geolocalización junto con los del comercio para
analizar si es una compra en un comercio habitual y desde una
localización conocida, etc.</p>
</div>
<div id="modelización-del-fraude-en-la-compra-con-tarjetas-de-crédito" class="section level2" number="60.2">
<h2>
<span class="header-section-number">60.2</span> Modelización del fraude en la compra con tarjetas de crédito<a class="anchor" aria-label="anchor" href="#modelizaci%C3%B3n-del-fraude-en-la-compra-con-tarjetas-de-cr%C3%A9dito"><i class="fas fa-link"></i></a>
</h2>
<p>El objetivo de este caso de uso es la construcción de un modelo que
permita detectar si una operación de compra realizada con tarjeta de
crédito es fraudulenta o no. Para ello, se utilizará un dataset
anonimizado de operaciones con tarjeta de crédito ya etiquetadas
disponible desde la web de Kaggle en el siguiente enlace:
<a href="https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud" class="uri">https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud</a>.
No obstante, los datos se han incorporado la paquete <code>CDR</code> del libro
con el nombre <code>creditcard</code>. El conjunto de datos consta de
284.807 transacciones, de las cuales 492 están
etiquetadas como fraudulentas, es decir, sólo un 0,172% del total de las
transacciones. Es un dataset por lo tanto muy desequilibrado, lo que
añade cierto grado de dificultad. El dataset <code>creditcard</code> tiene un conjunto de 31
variables, de las cuales 28 están identificadas como <code>V1</code>, …, <code>V28</code>, una
variable <code>Time</code> que registra los segundos transcurridos entre esa
transacción y la primera, una variable <code>Amount</code> que registra el importe
de la transacción, y la variable dependiente <code>class</code> que indica, con
valor 0, que la operación es “no fraudulenta”, y con valor 1 las
operaciones fraudulentas.</p>
<p>Para concluir esta breve descripción del dataset, es necesario recordar
que todos los valores de entrada son numéricos y que ya han sufrido
algunas transformaciones. Por motivos de confidencialidad, las variables
V1 a V28 no incluyen sus nombres originales ni se añade más información
de contexto.</p>
<p><strong>Carga de los datos y obtención de algunos descriptivos</strong></p>
<div class="sourceCode" id="cb850"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">creditcard</span> <span class="op">&lt;-</span> <span class="fu">CDR</span><span class="fu">::</span><span class="va">creditcard</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">creditcard</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Time         V1          V2        V3         V4          V5          V6</span></span>
<span><span class="co">#&gt; 1    0 -1.3598071 -0.07278117 2.5363467  1.3781552 -0.33832077  0.46238778</span></span>
<span><span class="co">#&gt; 2    0  1.1918571  0.26615071 0.1664801  0.4481541  0.06001765 -0.08236081</span></span>
<span><span class="co">#&gt; 3    1 -1.3583541 -1.34016307 1.7732093  0.3797796 -0.50319813  1.80049938</span></span>
<span><span class="co">#&gt; 4    1 -0.9662717 -0.18522601 1.7929933 -0.8632913 -0.01030888  1.24720317</span></span>
<span><span class="co">#&gt; 5    2 -1.1582331  0.87773675 1.5487178  0.4030339 -0.40719338  0.09592146</span></span>
<span><span class="co">#&gt; 6    2 -0.4259659  0.96052304 1.1411093 -0.1682521  0.42098688 -0.02972755</span></span>
<span><span class="co">#&gt;            V7          V8         V9         V10        V11         V12</span></span>
<span><span class="co">#&gt; 1  0.23959855  0.09869790  0.3637870  0.09079417 -0.5515995 -0.61780086</span></span>
<span><span class="co">#&gt; 2 -0.07880298  0.08510165 -0.2554251 -0.16697441  1.6127267  1.06523531</span></span>
<span><span class="co">#&gt; 3  0.79146096  0.24767579 -1.5146543  0.20764287  0.6245015  0.06608369</span></span>
<span><span class="co">#&gt; 4  0.23760894  0.37743587 -1.3870241 -0.05495192 -0.2264873  0.17822823</span></span>
<span><span class="co">#&gt; 5  0.59294075 -0.27053268  0.8177393  0.75307443 -0.8228429  0.53819555</span></span>
<span><span class="co">#&gt; 6  0.47620095  0.26031433 -0.5686714 -0.37140720  1.3412620  0.35989384</span></span>
<span><span class="co">#&gt;          V13        V14        V15        V16         V17         V18</span></span>
<span><span class="co">#&gt; 1 -0.9913898 -0.3111694  1.4681770 -0.4704005  0.20797124  0.02579058</span></span>
<span><span class="co">#&gt; 2  0.4890950 -0.1437723  0.6355581  0.4639170 -0.11480466 -0.18336127</span></span>
<span><span class="co">#&gt; 3  0.7172927 -0.1659459  2.3458649 -2.8900832  1.10996938 -0.12135931</span></span>
<span><span class="co">#&gt; 4  0.5077569 -0.2879237 -0.6314181 -1.0596472 -0.68409279  1.96577500</span></span>
<span><span class="co">#&gt; 5  1.3458516 -1.1196698  0.1751211 -0.4514492 -0.23703324 -0.03819479</span></span>
<span><span class="co">#&gt; 6 -0.3580907 -0.1371337  0.5176168  0.4017259 -0.05813282  0.06865315</span></span>
<span><span class="co">#&gt;           V19         V20          V21          V22         V23         V24</span></span>
<span><span class="co">#&gt; 1  0.40399296  0.25141210 -0.018306778  0.277837576 -0.11047391  0.06692807</span></span>
<span><span class="co">#&gt; 2 -0.14578304 -0.06908314 -0.225775248 -0.638671953  0.10128802 -0.33984648</span></span>
<span><span class="co">#&gt; 3 -2.26185710  0.52497973  0.247998153  0.771679402  0.90941226 -0.68928096</span></span>
<span><span class="co">#&gt; 4 -1.23262197 -0.20803778 -0.108300452  0.005273597 -0.19032052 -1.17557533</span></span>
<span><span class="co">#&gt; 5  0.80348692  0.40854236 -0.009430697  0.798278495 -0.13745808  0.14126698</span></span>
<span><span class="co">#&gt; 6 -0.03319379  0.08496767 -0.208253515 -0.559824796 -0.02639767 -0.37142658</span></span>
<span><span class="co">#&gt;          V25        V26          V27         V28 Amount Class</span></span>
<span><span class="co">#&gt; 1  0.1285394 -0.1891148  0.133558377 -0.02105305 149.62     0</span></span>
<span><span class="co">#&gt; 2  0.1671704  0.1258945 -0.008983099  0.01472417   2.69     0</span></span>
<span><span class="co">#&gt; 3 -0.3276418 -0.1390966 -0.055352794 -0.05975184 378.66     0</span></span>
<span><span class="co">#&gt; 4  0.6473760 -0.2219288  0.062722849  0.06145763 123.50     0</span></span>
<span><span class="co">#&gt; 5 -0.2060096  0.5022922  0.219422230  0.21515315  69.99     0</span></span>
<span><span class="co">#&gt; 6 -0.2327938  0.1059148  0.253844225  0.08108026   3.67     0</span></span>
<span><span class="co"># psych::describe(creditcard)  # descomentar para ver los descriptivos</span></span></code></pre></div>
<p><strong>División de los datos</strong></p>
<p>A continuación es necesario dividir los datos en dos dataframes que
denominados <code>creditcard_X</code> y <code>creditcard_y</code>, de esta forma se separan
las variables independientes de la variable dependiente o <code>Class</code>.</p>
<div class="sourceCode" id="cb851"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Se dividen los datos</span></span>
<span><span class="va">creditcard_X</span> <span class="op">&lt;-</span> <span class="va">creditcard</span><span class="op">[</span>,<span class="op">-</span><span class="fl">31</span><span class="op">]</span></span>
<span><span class="va">creditcard_y</span> <span class="op">&lt;-</span> <span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span></span></code></pre></div>
<p><strong>Tratamiento de datos desequilibrados</strong></p>
<p>Uno de los principales problemas a la hora de abordar este tipo de
escenarios, es lo que se conoce como “datos desequilibrados”.
Se dice que un dataset está desequilibrado cuando la variable dependiente
presenta más observaciones de una clase que de otra. En el caso de
transacciones fraudulentas con tarjeta de crédito, es evidente que la
mayoría de las operaciones son legítimas o benignas, y que sólo un
pequeño porcentaje resultan ser maliciosas. ¿Cuál es el problema?</p>
<p>Por lo general, los modelos entrenados con datasets desequilibrados no
se comportan bien cuando tienen que generalizar, es decir, cuando tienen
que realizar predicciones sobre conjuntos de datos que no han sido
vistos anteriormente por el modelo. El desequilibrio de los datos es un
sesgo hacia la clase mayoritaria, por lo que, en última instancia,
muestra una tendencia al sobreajuste u overfitting hacia esa clase.
Existen diversas técnicas que permiten corregir esta situación:</p>
<ul>
<li><p><strong><em>Undersampling</em></strong> o Submuestreo. Esta técnica consiste en reducir el
número de observaciones de la clase mayoritaria, estableciendo quizás
una ratio de 60/40. Esta técnica resulta efectiva si se respetan los
grupos naturales que existen en los datos, así como el resto de las
características presentes en la clase mayoritaria.</p></li>
<li><p><strong><em>Oversampling</em></strong> o Sobremuestreo. Esta técnica consiste en aumentar
el número de observaciones de la clase minoritaria mediante la creación
de datos sintéticos que, al igual que la técnica anterior, respeten las
características de esa clase.</p></li>
</ul>
<p>Para la creación de datos sintéticos en escenarios de oversampling
existen varios algoritmos que proporcionan buenos resultados. Quizás el
más conocido y utilizado sea <em>Synthetic Minority Oversampling
TEchnique</em> (SMOTE). SMOTE no realiza una copia de las observaciones del
dataset, sino que en su lugar genera nuevos datos de forma sintética
utilizando los vecinos más cercanos de esos casos, respetando las
características estadísticas de la clase. Además, los ejemplos de la
clase mayoritaria también son submuestreados, lo que da lugar a un
conjunto de datos más equilibrado. En R, el algoritmo SMOTE pertenece al
paquete <code>DMwR</code>.</p>
<p>Para este caso particular, se utilizará una técnica simple de
submuestreo basada en el paquete <code>unbalanced</code>, que actualmente no se
encuentra disponible en el repositorio de CRAN por lo que, para su
instalación, se debe ejecutar el siguiente código:</p>
<div class="sourceCode" id="cb852"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("devtools") # descomentar para instalar </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/">"devtools"</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"dalpozz/unbalanced"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://mlg.ulb.ac.be">"unbalanced"</a></span><span class="op">)</span></span></code></pre></div>
<p>Una vez instalado, al igual que todas sus dependencias, se realiza el
submuestreo del dataset siguiendo los siguientes pasos:</p>
<p>1.- Convertir la variable dependiente “Class” en factor:</p>
<div class="sourceCode" id="cb853"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html">as.factor</a></span><span class="op">(</span><span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">levels</a></span><span class="op">(</span><span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'0'</span>, <span class="st">'1'</span><span class="op">)</span> </span></code></pre></div>
<p>2.- A continuación, ejecutar la función de submuestreo:</p>
<div class="sourceCode" id="cb854"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">undersampled_creditcard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/unbalanced/man/ubBalance.html">ubBalance</a></span><span class="op">(</span><span class="va">creditcard_X</span>, <span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span>, type<span class="op">=</span><span class="st">'ubUnder'</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Proportion of positives after ubUnder : 50 % of 984 observations</span></span>
<span><span class="va">undersampled_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">undersampled_creditcard</span><span class="op">$</span><span class="va">X</span>,   </span>
<span>                               <span class="va">undersampled_creditcard</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">undersampled_combined</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">undersampled_combined</span><span class="op">)</span> <span class="op">==</span> <span class="st">"undersampled_creditcard$Y"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Class"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">levels</a></span><span class="op">(</span><span class="va">undersampled_combined</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Legítima'</span>, <span class="st">'Fraude'</span><span class="op">)</span></span></code></pre></div>
<p>3.- Comprobar el número de casos en el dataset sobre el que se ha
ejecutado la función de submuestreo</p>
<div class="sourceCode" id="cb855"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html">as.factor</a></span><span class="op">(</span><span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">levels</a></span><span class="op">(</span><span class="va">creditcard</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'0'</span>, <span class="st">'1'</span><span class="op">)</span> </span></code></pre></div>
<p>4.- Realizar la gráfica para visualizar el número de elementos de cada
clase después de realizar el submuestreo</p>
<div class="sourceCode" id="cb856"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">undersampled_combined</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Número de casos de cada clase después de submuestreo"</span>, </span>
<span>          subtitle<span class="op">=</span><span class="st">"Total muestrass: 984"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Muestras"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"ninguna"</span>, </span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="212060_cd_finanzas_files/figure-html/unnamed-chunk-7-1.png" width="60%" style="display: block; margin: auto;"></div>
<p><strong>Modelo de clasificación mediante regresión lógística</strong></p>
<p>A continuación se procederá a la construcción de un modelo de regresión
logística (véase Cap. <a href="cap-glm.html#cap-glm">16</a>) para una clasificación binaria
en relación al fraude en transacciones con tarjeta de crédito a partir
de los datos equilibrados obtenidos anteriormente. El dataframe que se
utilizará, por lo tanto, será “undersampled_combined” que contiene 984
observaciones, un 50% de las cuales son transacciones identificadas como
fraude.</p>
<p>Lo primero, será realizar un par de pequeños cambios en el dataset, es
decir, eliminar las variables <code>Time</code> y <code>Amount</code>, ya que no van a ser
relevantes para el modelo, y cambiar por 0 y 1 las etiquetas “Legitima”
y “Fraude”, respectivamente.</p>
<div class="sourceCode" id="cb857"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">undersampled_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span> <span class="va">undersampled_combined</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Amount</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">undersampled_combined</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">undersampled_combined</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="st">"Fraude"</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Lo siguiente será dividir el conjunto de datos en los datasets de
entrenamiento y test, para lo cual se aplicará la función “split()” con
un SplitRatio de 0.80, es decir, un 80% de los datos irán de forma
aleatoria al dataset de entrenamiento, 788 observaciones, frente a las
196 observaciones que formarán el dataset de testing.</p>
<div class="sourceCode" id="cb858"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("caTools") # descomentar para instalar</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"caTools"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">split</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caTools/man/sample.split.html">sample.split</a></span><span class="op">(</span><span class="va">undersampled_combined</span><span class="op">$</span><span class="va">Class</span>, SplitRatio <span class="op">=</span> <span class="fl">0.80</span><span class="op">)</span></span>
<span><span class="va">training</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">undersampled_combined</span>, <span class="va">split</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">undersampled_combined</span>, <span class="va">split</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Con los datasets necesarios ya disponibles, el siguiente paso es
entrenar el modelo de regresión logística que clasificará las
transacciones en legítimas o fraudulentas. Para ello se utilizará el
algoritmo GLM, creando un clasificador que se identificará como
<code>undersampledModel</code>y al que se le pasarán los parámetros siguientes:</p>
<p>• <code>formula</code>: con este parámetro se indica la variable dependiente, class,
seguida del simbolo ~ y un punto (con el punto se hace referencia al
resto de variables del dataset, es decir, <code>V1</code> a <code>V28</code>).</p>
<p>• <code>data</code>: el dataset con los datos de entrenamiento.</p>
<p>• <code>family</code>: al ser un clasificador con dos valores posibles (0, 1), se
indica que será de tipo “binomial”.</p>
<div class="sourceCode" id="cb859"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">undersampledModel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">training</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Para ver,</p>
<div class="sourceCode" id="cb860"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">undersampledModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = Class ~ ., family = binomial(), data = training)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -5.6665  -0.2824  -0.0100   0.0207   2.8822  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -3.07010    0.27924 -10.995  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; V1          -0.11097    0.09205  -1.206 0.227989    </span></span>
<span><span class="co">#&gt; V2           0.01988    0.11120   0.179 0.858113    </span></span>
<span><span class="co">#&gt; V3          -0.05131    0.10141  -0.506 0.612875    </span></span>
<span><span class="co">#&gt; V4           0.73337    0.14655   5.004  5.6e-07 ***</span></span>
<span><span class="co">#&gt; V5           0.06131    0.12566   0.488 0.625621    </span></span>
<span><span class="co">#&gt; V6          -0.25720    0.18061  -1.424 0.154428    </span></span>
<span><span class="co">#&gt; V7           0.04104    0.14351   0.286 0.774892    </span></span>
<span><span class="co">#&gt; V8          -0.59200    0.17242  -3.433 0.000596 ***</span></span>
<span><span class="co">#&gt; V9           0.09649    0.25616   0.377 0.706430    </span></span>
<span><span class="co">#&gt; V10         -0.36799    0.23336  -1.577 0.114816    </span></span>
<span><span class="co">#&gt; V11          0.17731    0.17308   1.024 0.305633    </span></span>
<span><span class="co">#&gt; V12         -0.42350    0.18651  -2.271 0.023165 *  </span></span>
<span><span class="co">#&gt; V13         -0.46607    0.17870  -2.608 0.009105 ** </span></span>
<span><span class="co">#&gt; V14         -0.60792    0.16403  -3.706 0.000210 ***</span></span>
<span><span class="co">#&gt; V15         -0.20302    0.19558  -1.038 0.299246    </span></span>
<span><span class="co">#&gt; V16         -0.05732    0.24961  -0.230 0.818359    </span></span>
<span><span class="co">#&gt; V17          0.03321    0.17355   0.191 0.848234    </span></span>
<span><span class="co">#&gt; V18         -0.02035    0.27096  -0.075 0.940146    </span></span>
<span><span class="co">#&gt; V19         -0.17014    0.21817  -0.780 0.435475    </span></span>
<span><span class="co">#&gt; V20          0.20927    0.21526   0.972 0.330979    </span></span>
<span><span class="co">#&gt; V21         -0.17569    0.24956  -0.704 0.481436    </span></span>
<span><span class="co">#&gt; V22          0.37758    0.26040   1.450 0.147059    </span></span>
<span><span class="co">#&gt; V23         -0.13444    0.13370  -1.006 0.314618    </span></span>
<span><span class="co">#&gt; V24          0.10680    0.35270   0.303 0.762037    </span></span>
<span><span class="co">#&gt; V25          0.01945    0.35147   0.055 0.955869    </span></span>
<span><span class="co">#&gt; V26         -0.24275    0.39213  -0.619 0.535882    </span></span>
<span><span class="co">#&gt; V27         -0.44250    0.33671  -1.314 0.188780    </span></span>
<span><span class="co">#&gt; V28          1.01477    0.78764   1.288 0.197619    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1092.40  on 787  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  254.81  on 759  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 312.81</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 9</span></span></code></pre></div>
<p>Con el modelo ya entrenado, se realizan las predicciones para los datos
del conjunto de testing, utilizando para ello la función “predict()”.
Los parámetros son simples: el primero es el modelo o clasificador que
se va a utilizar y que será “undersampledModel”; a continuación el tipo
de dato que devolverá, en este caso “response”, el cual indica que el
algoritmo devolverá las probabilidades de fraude listadas en un único
vector, el cual estará disponible a partir de la variable “fraud_prob”;
y por último, el parámetro “newdata” que hace referencia al dataset en
el que se descarta la última columna por ser la que representa la
variable dependiente.</p>
<div class="sourceCode" id="cb861"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fraud_prob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/predict.html">predict</a></span><span class="op">(</span><span class="va">undersampledModel</span>, type <span class="op">=</span> <span class="st">"response"</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">[</span>,<span class="op">-</span><span class="fl">29</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">fraud_prob</span><span class="op">)</span></span>
<span><span class="co">#&gt;        620       2171       2342       2934       5051       6109 </span></span>
<span><span class="co">#&gt; 0.04012917 0.22457711 0.01231549 0.09225823 0.23155212 0.99999667</span></span></code></pre></div>
<p>La visualización del vector con las predicciones puede parecer algo
confusa, por lo que, a menudo, es preciso realizar una conversión de
esas predicciones en valores 0 y 1, dependiendo del rango de valores a
partir del cual se estime que una transacción es fraudulenta: por
ejemplo, a partir del 60% de probabilidad, la transacción será
etiquetada como “1”; en caso contrario será etiquetada como “0”. Para
ello se utiliza el siguiente código “ifelse”:</p>
<div class="sourceCode" id="cb862"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">fraud_prob</span> <span class="op">&gt;</span> <span class="fl">0.6</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><strong>La matriz de confusión</strong></p>
<p>Como último paso del ejercicio se crea la matriz de confusión con el fin
de visualizar qué tal se ha comportado el algoritmo, es decir, cuántos
positivos y negativos ha logrado predecir correctamente. Para ello se
creará la variable <code>confusionMatrix</code>, en la cual se almacenará el
resultado de la comparación entre el vector del dataset de testing, es
decir, los datos etiquetados originalmente, y el vector de sus
traducciones a 0 y 1, resultado del algoritmo. El resultado, como se
puede comprobar es que ha evaluado correctamente 186 de las 196
observaciones.</p>
<div class="sourceCode" id="cb863"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confusionMatrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>, <span class="fl">29</span><span class="op">]</span>, <span class="va">y_pred</span><span class="op">)</span></span>
<span><span class="va">confusionMatrix</span></span>
<span><span class="co">#&gt;    y_pred</span></span>
<span><span class="co">#&gt;      0  1</span></span>
<span><span class="co">#&gt;   0 97  1</span></span>
<span><span class="co">#&gt;   1 11 87</span></span></code></pre></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></div>
<div class="next"><a href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Índice capítulo"><h2>Índice capítulo</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cap-fraude"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li><a class="nav-link" href="#introducci%C3%B3n-30"><span class="header-section-number">60.1</span> Introducción</a></li>
<li><a class="nav-link" href="#modelizaci%C3%B3n-del-fraude-en-la-compra-con-tarjetas-de-cr%C3%A9dito"><span class="header-section-number">60.2</span> Modelización del fraude en la compra con tarjetas de crédito</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentos de ciencia de datos con R</strong>" coordinado por <a href="https://blog.uclm.es/gemafaviles/" class="text-light">Gema Fernández-Avilés y José-María Montero</a>. Generado por última vez el día 2023-06-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro ha sido generado con el paquete de R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

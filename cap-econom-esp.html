<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 42 Modelos econométricos espaciales | Fundamentos de ciencia de datos con R</title>
<meta name="author" content="Gema Fernández-Avilés y José-María Montero">
<meta name="description" content="Andrés Vallone\(^{a}\) y Coro Chasco\(^{b}\) \(^{a}\)Universidad Católica del Norte\(^{b}\)Universidad Autónoma de Madrid  42.1 La dependencia espacial  En muchas ocasiones, los fenómenos de...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Capítulo 42 Modelos econométricos espaciales | Fundamentos de ciencia de datos con R">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/cover.png">
<meta property="og:description" content="Andrés Vallone\(^{a}\) y Coro Chasco\(^{b}\) \(^{a}\)Universidad Católica del Norte\(^{b}\)Universidad Autónoma de Madrid  42.1 La dependencia espacial  En muchas ocasiones, los fenómenos de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 42 Modelos econométricos espaciales | Fundamentos de ciencia de datos con R">
<meta name="twitter:description" content="Andrés Vallone\(^{a}\) y Coro Chasco\(^{b}\) \(^{a}\)Universidad Católica del Norte\(^{b}\)Universidad Autónoma de Madrid  42.1 La dependencia espacial  En muchas ocasiones, los fenómenos de...">
<meta name="twitter:image" content="/img/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="bs4_book.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentos de ciencia de datos con <strong>R</strong></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
</form>

      <nav aria-label="Contenido"><h2>Contenido</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li><a class="" href="pr%C3%B3logo-by-julia-silge.html">Prólogo (by Julia Silge)</a></li>
<li><a class="" href="pr%C3%B3logo-por-yanina-bellini.html">Prólogo (por Yanina Bellini)</a></li>
<li class="book-part">Ciencia, datos, software… y científicos</li>
<li><a class="" href="ciencia-datos.html"><span class="header-section-number">1</span> ¿Es la ciencia de datos una ciencia?</a></li>
<li><a class="" href="metodologia.html"><span class="header-section-number">2</span> Metodología en ciencia de datos</a></li>
<li><a class="" href="ch-110003.html"><span class="header-section-number">3</span> R para ciencia de datos</a></li>
<li><a class="" href="cap-etica.html"><span class="header-section-number">4</span> Ética en la ciencia de datos</a></li>
<li class="book-part">Bienvenidos a la jungla de datos</li>
<li><a class="" href="datos-sql.html"><span class="header-section-number">5</span> Gestión de bases de datos relacionales</a></li>
<li><a class="" href="cap-nosql.html"><span class="header-section-number">6</span> Gestión de bases de datos NoSQL</a></li>
<li><a class="" href="DGDQM.html"><span class="header-section-number">7</span> Gobierno, gestión y calidad del dato</a></li>
<li><a class="" href="cap-130009.html"><span class="header-section-number">8</span> Integración y limpieza de datos</a></li>
<li><a class="" href="chap-feature.html"><span class="header-section-number">9</span> Selección y transformación de variables</a></li>
<li><a class="" href="chap-herramientas.html"><span class="header-section-number">10</span> Herramientas para el análisis en ciencia de datos</a></li>
<li><a class="" href="cap-120006-aed.html"><span class="header-section-number">11</span> Análisis exploratorio de datos</a></li>
<li class="book-part">Fundamentos de estadística</li>
<li><a class="" href="Funda-probab.html"><span class="header-section-number">12</span> Probabilidad</a></li>
<li><a class="" href="Fundainfer.html"><span class="header-section-number">13</span> Inferencia estadística</a></li>
<li><a class="" href="muestreo.html"><span class="header-section-number">14</span> Muestreo y remuestreo</a></li>
<li class="book-part">Modelización estadística</li>
<li><a class="" href="cap-lm.html"><span class="header-section-number">15</span> Modelización lineal</a></li>
<li><a class="" href="cap-glm.html"><span class="header-section-number">16</span> Modelos lineales generalizados</a></li>
<li><a class="" href="cap-gam.html"><span class="header-section-number">17</span> Modelos aditivos generalizados</a></li>
<li><a class="" href="cap-mxm.html"><span class="header-section-number">18</span> Modelos mixtos</a></li>
<li><a class="" href="cap-sparse.html"><span class="header-section-number">19</span> Modelos \(\textit{sparse}\) y métodos penalizados de regresión</a></li>
<li><a class="" href="cap-series-temp.html"><span class="header-section-number">20</span> Modelización de series temporales</a></li>
<li><a class="" href="cap-discriminante.html"><span class="header-section-number">21</span> Análisis discriminante</a></li>
<li><a class="" href="cap-conjunto.html"><span class="header-section-number">22</span> Análisis conjunto</a></li>
<li><a class="" href="tablas-contingencia.html"><span class="header-section-number">23</span> Análisis de tablas de contingencia</a></li>
<li class="book-part">Machine learning supervisado</li>
<li><a class="" href="cap-arboles.html"><span class="header-section-number">24</span> Árboles de clasificación y regresión</a></li>
<li><a class="" href="cap-svm.html"><span class="header-section-number">25</span> Máquinas de vector soporte</a></li>
<li><a class="" href="cap-knn.html"><span class="header-section-number">26</span> Clasificador \(k\)-vecinos más próximos</a></li>
<li><a class="" href="cap-naive-bayes.html"><span class="header-section-number">27</span> Naive Bayes</a></li>
<li><a class="" href="cap-bagg-rf.html"><span class="header-section-number">28</span> Métodos ensamblados: \(\bf \textit {bagging}\) y \(\bf \textit{random}\) \(\bf \textit{forest}\)</a></li>
<li><a class="" href="cap-boosting-xgboost.html"><span class="header-section-number">29</span> \(\bf \textit{Boosting}\) y el algoritmo XGBoost</a></li>
<li class="book-part">Machine learning no supervisado</li>
<li><a class="" href="cap-cluster.html"><span class="header-section-number">30</span> Análisis clúster: clusterización jerárquica</a></li>
<li><a class="" href="no-jerarquico.html"><span class="header-section-number">31</span> Análisis clúster: clusterización no jerárquica</a></li>
<li><a class="" href="acp.html"><span class="header-section-number">32</span> Análisis de componentes principales</a></li>
<li><a class="" href="af.html"><span class="header-section-number">33</span> Análisis factorial</a></li>
<li><a class="" href="mds.html"><span class="header-section-number">34</span> Escalamiento multidimensional</a></li>
<li><a class="" href="correspondencias.html"><span class="header-section-number">35</span> Análisis de correspondencias</a></li>
<li class="book-part">Deep learning</li>
<li><a class="" href="capNN.html"><span class="header-section-number">36</span> Redes neuronales artificiales</a></li>
<li><a class="" href="cap-redes-convol.html"><span class="header-section-number">37</span> Redes neuronales convolucionales</a></li>
<li class="book-part">Ciencia de datos de texto y redes</li>
<li><a class="" href="mineria-textos.html"><span class="header-section-number">38</span> Minería de textos</a></li>
<li><a class="" href="grafos.html"><span class="header-section-number">39</span> Análisis de grafos y redes sociales</a></li>
<li class="book-part">Ciencia de datos espaciales</li>
<li><a class="" href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></li>
<li><a class="" href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="active" href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li><a class="" href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></li>
<li class="book-part">Comunica y colabora</li>
<li><a class="" href="cap-120007-informes.html"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></li>
<li><a class="" href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></li>
<li><a class="" href="geoproces.html"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li class="book-part">Casos de estudio en ciencia de datos</li>
<li><a class="" href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></li>
<li><a class="" href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></li>
<li><a class="" href="cap-twitter.html"><span class="header-section-number">50</span> ¿Cómo tuitea Elon Musk?</a></li>
<li><a class="" href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de RStudio a su periódico favorito</a></li>
<li><a class="" href="paro-clm.html"><span class="header-section-number">52</span> El impacto de las crisis financiera y de la COVID-19 en el paro de CLM</a></li>
<li><a class="" href="cap-rfm.html"><span class="header-section-number">53</span> Segmentación de clientes en el comercio minorista</a></li>
<li><a class="" href="cap-medicina.html"><span class="header-section-number">54</span> Análisis de datos en medicina</a></li>
<li><a class="" href="cap-futbol.html"><span class="header-section-number">55</span> Messi y Ronaldo: dos ídolos desde la perspectiva de los datos</a></li>
<li><a class="" href="cambioclimatico.html"><span class="header-section-number">56</span> Una nota sobre el cambio climático</a></li>
<li><a class="" href="cap-sist-exp.html"><span class="header-section-number">57</span> Implementación de un sistema experto en el ámbito pediátrico</a></li>
<li><a class="" href="cap-ree.html"><span class="header-section-number">58</span> Predicción de consumo eléctrico con redes neuronales artificiales</a></li>
<li><a class="" href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></li>
<li><a class="" href="cap-fraude.html"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></li>
<li><a class="" href="referencias.html">Referencias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cap-econom-esp" class="section level1" number="42">
<h1>
<span class="header-section-number">Capítulo 42</span> Modelos econométricos espaciales<a class="anchor" aria-label="anchor" href="#cap-econom-esp"><i class="fas fa-link"></i></a>
</h1>
<p><em>Andrés Vallone</em><span class="math inline">\(^{a}\)</span> y <em>Coro Chasco</em><span class="math inline">\(^{b}\)</span></p>
<p><span class="math inline">\(^{a}\)</span>Universidad Católica del Norte<br><span class="math inline">\(^{b}\)</span>Universidad Autónoma de Madrid</p>
<div id="la-dependencia-espacial" class="section level2" number="42.1">
<h2>
<span class="header-section-number">42.1</span> La dependencia espacial<a class="anchor" aria-label="anchor" href="#la-dependencia-espacial"><i class="fas fa-link"></i></a>
</h2>
<p></p>
<p>En muchas ocasiones, los fenómenos de estudio no son independientes del espacio geográfico en el cual se producen. Esta circunstancia es precisamente la que se pone de manifiesto en la <strong>primera ley de la geografía</strong> enunciada por <span class="citation">Tobler (<a href="referencias.html#ref-tobler1970computer">1970</a>)</span>: “Todas las cosas están relacionadas entre sí, pero las cosas más próximas en el espacio tienen una relación mayor que las distantes” <span class="citation">(<a href="referencias.html#ref-tobler1970computer">Tobler, 1970, p. 236</a>)</span>. Esta situación produce una violación del supuesto básico de independencia de las variables aleatorias requerido por el método de estimación de mínimos cuadrados ordinarios (MCO).</p>
<p>En este contexto, los estimadores MCO ya no son óptimos y, por tanto, los estadísticos de contraste <span class="math inline">\(t\)</span> y <span class="math inline">\(F\)</span> pueden llevar a conclusiones erróneas <span class="citation">(<a href="referencias.html#ref-anselin1988spatial">Anselin, 1988</a>)</span>. Por ello, es necesario encontrar la manera de incorporar el espacio geográfico en los procesos de modelización. En este capítulo se aborda esta cuestión, mostrando primero los métodos de exploración de datos espaciales, para luego presentar las formas de modelización de las relaciones espaciales y los métodos de estimación en presencia de dichas relaciones.</p>
<p>Los modelos econométricos espaciales se centran en manejar las situaciones de <strong>dependencia espacial</strong>. Existe dependencia espacial cuando lo que sucede en una localización <span class="math inline">\(i\)</span> está influenciado por lo que sucede en una localización <span class="math inline">\(j\)</span> y viceversa <span class="citation">(<a href="referencias.html#ref-anselin2013">Anselin, 2013</a>)</span>. La dependencia espacial se traduce en que los valores de la variable en las localizaciones <span class="math inline">\(i\)</span> y <span class="math inline">\(j\)</span> con <span class="math inline">\(i\neq j\)</span> están correlacionados entre sí, hecho que se conoce como <strong>autocorrelación espacial</strong> <span class="citation">(<a href="referencias.html#ref-anselin2013">Anselin, 2013</a>)</span>. La autocorrelación espacial puede ser positiva, cuando las localizaciones con valores similares tienden a estar juntos (altos con altos, bajos con bajos), o negativa, cuando las unidades espaciales tienden a estar rodeadas de vecinos con valores diferentes. Los patrones espaciales formados por la existencia de autocorrelación se muestran en la Fig. <a href="cap-econom-esp.html#fig:plot-dep-W">42.1</a>. La ausencia de autocorrelación es lo que se entiende como aleatoriedad espacial <span class="citation">(<a href="referencias.html#ref-anselin2013">Anselin, 2013</a>)</span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-dep-W"></span>
<img src="img/plot-dep-W.png" alt="Patrones de autocorrelación espacial." width="60%"><p class="caption">
Figura 42.1: Patrones de autocorrelación espacial.
</p>
</div>
<div id="modelización-de-las-relaciones-espaciales" class="section level3" number="42.1.1">
<h3>
<span class="header-section-number">42.1.1</span> Modelización de las relaciones espaciales<a class="anchor" aria-label="anchor" href="#modelizaci%C3%B3n-de-las-relaciones-espaciales"><i class="fas fa-link"></i></a>
</h3>
<p>El espacio puede jugar un rol importante en la configuración de los procesos a modelizar. Por ello, es necesario encontrar una forma de incorporar el espacio en los procesos de estimación. Para modelizar la interacción de una variable consigo misma es natural pensar en el concepto de autocorrelación. No obstante, a diferencia de la autocorrelación temporal, que es unidireccional (solo el pasado puede afectar el presente), en el caso del espacio la influencia es multidireccional en el entorno o vecindario de la localidad de análisis y, por tanto, es crucial definir el <strong>vecindario</strong>.</p>
<p>La matriz de vecindad o contigüidad <span class="math inline">\(\mathbf{W}_{n \times n}\)</span> muestra la relación entre las <span class="math inline">\(n\)</span> localidades analizadas, y por tanto, la interacción existente entre sí. Es una matriz simétrica y binaria, de forma que <span class="math inline">\(w_{ij} = 1\)</span> si las localidades <span class="math inline">\(i\)</span> y <span class="math inline">\(j\)</span> son vecinas y cero si no lo son. Por tanto, <span class="math inline">\(w_{ii}=0\)</span> puesto que una localidad no puede ser vecina de sí misma. Existen distintos criterios de definición de vecindad dependiendo del proceso que se desee modelizar y las características de los datos. Si se cuenta con un mapa de polígonos, entonces se puede utilizar alguno de los criterios que se presentan en la Fig. <a href="cap-econom-esp.html#fig:plot-criterio-W">42.2</a> para configurar la matriz <span class="math inline">\(\mathbf{W}\)</span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-criterio-W"></span>
<img src="img/plot-criterio-W.png" alt="Criterios de vecindad." width="60%"><p class="caption">
Figura 42.2: Criterios de vecindad.
</p>
</div>
<p>Las matrices <span class="math inline">\(\mathbf{W}\)</span> generadas bajo el <strong>criterio lineal</strong> consideran como vecinas a la localidad <span class="math inline">\(i\)</span> todas aquellas localidades que compartan un borde situadas en la misma dirección cardinal, norte-sur o este-oeste, de esta localidad. El resto de los criterios de contigüidad siguen los movimientos de las piezas del ajedrez para definir la vecindad de la localidad <span class="math inline">\(i\)</span>. La construcción de una matriz de vecindad bajo el <strong>criterio de la torre</strong> implica considerar como vecinos de la localidad <span class="math inline">\(i\)</span> aquellas localidades situadas al norte, sur, este u oeste y que compartan un borde con dicha localidad. El <strong>criterio de alfil</strong> considera como vecindad de la localidad <span class="math inline">\(i\)</span> aquellas localidades situadas al noreste, noroeste, sureste o suroeste de la localidad <span class="math inline">\(i\)</span> y que tengan, al menos, un punto en común. El <strong>criterio de la reina</strong> considera como vecindario de la unidad espacial <span class="math inline">\(i\)</span> a las localidades, en cualquier dirección cardinal e intercardinal, que tengan al menos un punto en común con ella <span class="citation">(<a href="referencias.html#ref-martori2008incorporacion">Martori et al., 2008</a>)</span>.</p>
<p>Dependiendo del fenómeno que se analice, la matriz de contigüidad puede ser construida considerando un vecindario más amplio; por ejemplo, considerando como vecinos de la localidad <span class="math inline">\(i\)</span> a los vecinos de los vecinos de dicha localidad. En este caso se dice que la matriz de vecindad es de orden 2 (los vecinos y los vecinos de los vecinos). Las matrices <span class="math inline">\(\mathbf{W}\)</span> se utilizan para capturar el efecto del vecindario a partir de medias ponderadas basadas en la cercanía de las unidades espaciales. Es por ello que las matrices de vecindad se estandarizan por filas. Los elementos de la matriz estandarizada se obtienen de la siguiente manera:</p>
<span class="math display">\[\begin{equation}
w^e_{ij}=\frac{w_{ij}}{\sum_{j=1}^n w_{ij}}.
\end{equation}\]</span>
<p>En palabras simples, cada elemento de cada fila de la matriz <span class="math inline">\(\mathbf{W}\)</span> se divide por el total de dicha fila. Esto asegura que cada elemento de la matriz <span class="math inline">\(\mathbf{W}\)</span> estandarizada se encuentre entre 0 y 1, y que la suma de cada una de sus filas sea siempre 1. Las matrices de vecindad estandarizadas llevan el nombre de matrices de pesos espaciales. A partir de ahora, cuando se haga relación a la matriz <span class="math inline">\(\mathbf{W}\)</span> se estará haciendo referencia a una matriz de pesos espaciales.</p>
<p>Para el cálculo de las matrices de vecindad se utiliza el paquete <code>spdep</code> <span class="citation">(<a href="referencias.html#ref-R-spdep">Bivand, 2022</a>)</span>. La función <code>poly2nb()</code> construye la relación de vecindad a partir de los polígonos de un objeto espacial según el criterio y el orden que se indique; la función <code>nb2listw()</code> transforma la relación de vecindad en una lista de pesos espaciales. Para ejemplificar la construcción de la matriz <span class="math inline">\(\mathbf{W}\)</span>, se utilizará el conjunto de datos del estudio de <span class="citation">Guerry (<a href="referencias.html#ref-guerry1833essai">1833</a>)</span>. Esta base de datos contiene información respecto a estadísticas morales, criminales y sociales de las distintas provincias de Francia en 1830.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Una descripción completa de la base de datos está disponible en &lt;a href="https://geodacenter.github.io/data-and-lab/Guerry/" class="uri"&gt;https://geodacenter.github.io/data-and-lab/Guerry/&lt;/a&gt;.&lt;/p&gt;'><sup>273</sup></a></p>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-spatial/spdep/">"spdep"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"CDR"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reina</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">guerry</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">w_reina</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">reina</span>, style <span class="op">=</span> <span class="st">"W"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">w_reina</span></span>
<span><span class="co">#&gt; Characteristics of weights list object:</span></span>
<span><span class="co">#&gt; Neighbour list object:</span></span>
<span><span class="co">#&gt; Number of regions: 85</span></span>
<span><span class="co">#&gt; Number of nonzero links: 420</span></span>
<span><span class="co">#&gt; Percentage nonzero weights: 5.813149</span></span>
<span><span class="co">#&gt; Average number of links: 4.941176</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Weights style: W</span></span>
<span><span class="co">#&gt; Weights constants summary:</span></span>
<span><span class="co">#&gt;    n  nn  S0     S1        S2</span></span>
<span><span class="co">#&gt; W 85 7225 85 37.2761 347.6683</span></span></code></pre></div>
<p>En la salida anterior S0, S1 y S2 son constantes que se utilizan en los procesos inferenciales de los estadísticos de autocorrelación espacial global, como los tests <em>I</em> de Moran, <em>C</em> de Geary y <em>G</em> de Getis-Ord, entre otros.</p>
<p>Para construir una matriz de contigüidad de la torre de orden 1 se utilizan las mismas funciones, cambiando el parámetro <code>queen</code> de la función <code>poly2nb()</code>:</p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">torre</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">guerry</span>, queen <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">w_torre</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">torre</span>, style <span class="op">=</span> <span class="st">"W"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Cuando se trabaja con datos a escala puntual, o cuando existen situaciones geográficas de no contigüidad como, por ejemplo, una isla, la construcción de la matriz de contigüidad no es tan evidente. En estos casos, resulta más oportuno definir la matriz de vecindad a partir de <strong>criterios de distancia</strong>. Las matrices de <span class="math inline">\(\mathbf{W}\)</span> basadas en distancias pueden tener configuraciones continuas de la matriz respecto a la distancia <span class="math inline">\(d\)</span> entre las localidades <span class="math inline">\(i\)</span> y <span class="math inline">\(j\)</span>, de tal manera que <span class="math inline">\(w_{ij}=1/d_{ij}\)</span> o <span class="math inline">\(w_{ij}=1/d_{ij}^2\)</span> y <span class="math inline">\(w_{ii}=0\)</span>. Otras configuraciones implican considerar un número <span class="math inline">\(k\)</span> de vecinos más cercanos a cada localidad <span class="math inline">\(i\)</span>, de tal manera que:</p>
<span class="math display">\[\begin{align}
    \begin{cases}
    w_{ij}(k)=0 &amp; i=j, \hspace{0,1cm}\forall k \\
    w_{ij}(k)=1 &amp; d_{ij} \leq d_i(k)\\
    w_{ij}(k)=0 &amp; d_{ij} &gt; d_i(k)
    \end{cases}
\end{align}\]</span>
<p>donde <span class="math inline">\(d_i(k)\)</span> es la <em>k</em>-ésima menor distancia entre las localidades <span class="math inline">\(i\)</span> y <span class="math inline">\(j\)</span>.</p>
<p>A continuación se calcula matriz de contigüidad basada en los 5 vecinos más próximos de las áreas urbanas chilenas con más de 2.000 habitantes. Para ello se utilizan funciones de <span class="citation">Bivand (<a href="referencias.html#ref-R-spdep">2022</a>)</span> y <span class="citation">Pebesma (<a href="referencias.html#ref-pebesma2018simple">2018</a>)</span> y los datos de <span class="citation">Vallone &amp; Chasco (<a href="referencias.html#ref-valloneSpatiotemporalMethodsAnalysis2020">2020</a>)</span>.</p>
<div class="sourceCode" id="cb634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://r-spatial.github.io/sf/">"sf"</a></span><span class="op">)</span></span>
<span><span class="co"># Se extraen las coordenadas de las ciudades</span></span>
<span><span class="va">coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">cities</span><span class="op">)</span></span>
<span><span class="co"># Calcula la matriz vecindad de 5 vecinos más cercanos</span></span>
<span><span class="va">w5knn</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">coord</span>, k <span class="op">=</span> <span class="fl">5</span>, longlat <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>El uso de matrices de <span class="math inline">\(k\)</span> vecinos próximos puede forzar la vecindad entre localidades, considerando vecinas a localidades que estén muy distantes entre sí. Para evitar este problema se puede usar una configuración de vecindad basada en una distancia límite <span class="math inline">\(d_{max}\)</span>, de tal manera que:</p>
<span class="math display">\[\begin{align}
  \begin{cases}
  w_{ij}=1 &amp; d_{ij} \leq d_{max}\\
  w_{ij}=0 &amp; d_{ij} &gt; d_{max}.\\
  \end{cases}
\end{align}\]</span>
<p>El problema de este criterio de vecindad es la posibilidad de generar unidades espaciales aisladas cuando <span class="math inline">\(d_{max}\)</span> se fija en un valor muy bajo. Este problema se evita fijando la distancia máxima de tal manera que se asegure que todas las unidades espaciales tengan al menos un vecino.</p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calcula la k=1 matriz W</span></span>
<span><span class="va">knn1</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">coord</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Obtiene la distancia crítica</span></span>
<span><span class="va">distancia_critica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">nbdists</span><span class="op">(</span><span class="va">knn1</span>, <span class="va">coord</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># genera la matriz de vecindad de distancia con w_ij distinto de cero para d_ij &lt;= d_max</span></span>
<span><span class="va">k1</span> <span class="op">&lt;-</span> <span class="fu">dnearneigh</span><span class="op">(</span><span class="va">coord</span>, <span class="fl">0</span>, <span class="va">distancia_critica</span><span class="op">)</span></span>
<span><span class="va">w_dist</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">k1</span><span class="op">)</span></span></code></pre></div>
<p>Debe considerarse que la configuración basada en <span class="math inline">\(k\)</span> vecinos y en la distancia censurada dan lugar a matrices binarias, mientras que las matrices <span class="math inline">\(\mathbf{W}\)</span> basadas en distancias no.</p>
<p>Para realizar el cálculo de la matriz <span class="math inline">\(\mathbf{W}\)</span> basado en la distancia inversa (<span class="math inline">\(1/d_{ij}\)</span>) se utilizará el mismo conjunto de datos que en las matrices <span class="math inline">\(\mathbf{W}\)</span> basadas en distancias. No obstante, hay que tener en cuenta que: <span class="math inline">\((i)\)</span> hay que utilizar una función decreciente respecto a la distancia (en este caso una hipérbola) para satisfacer la ley de Tobler <span class="citation">(<a href="referencias.html#ref-tobler1970computer">Tobler, 1970</a>)</span>; y <span class="math inline">\((ii)\)</span> dado que la incidencia que puede tener una localidad <span class="math inline">\(j\)</span> que se encuentre muy lejana a la localidad <span class="math inline">\(i\)</span> tiende a cero <span class="citation">(<a href="referencias.html#ref-tobler1970computer">Tobler, 1970</a>)</span>, la matriz suele censurarse a una distancia máxima <span class="math inline">\(d_{max}\)</span> a partir de la cual la incidencia entre unidades espaciales es nula. El criterio para la fijación de <span class="math inline">\(d_{max}\)</span> es el mismo que el utilizado para evitar la existencia de unidades espaciales aisladas.</p>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knn1</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">coord</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">distancia_critica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">nbdists</span><span class="op">(</span><span class="va">knn1</span>, <span class="va">coord</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k1</span> <span class="op">&lt;-</span> <span class="fu">dnearneigh</span><span class="op">(</span><span class="va">coord</span>, <span class="fl">0</span>, <span class="va">distancia_critica</span><span class="op">)</span></span>
<span><span class="co"># Calcula la distancia entre los vecinos</span></span>
<span><span class="va">dist_list</span> <span class="op">&lt;-</span> <span class="fu">nbdists</span><span class="op">(</span><span class="va">k1</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">cities</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Calcula la distancia inversa</span></span>
<span><span class="va">i_dist_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">dist_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># Crea la matriz W</span></span>
<span><span class="va">w_dist_i</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">k1</span>, glist <span class="op">=</span> <span class="va">i_dist_list</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code></pre></div>
<p>Se ha indicado anteriormente que la matriz <span class="math inline">\(\mathbf{W}\)</span> se utiliza para capturar los efectos espaciales a partir de medias ponderadas, es decir, mediante la matriz <span class="math inline">\(\mathbf{W}\)</span> se puede de construir el <strong>retardo espacial</strong> de una variable <span class="math inline">\(X\)</span> sin más que multiplicar <span class="math inline">\(\bf{W}\)</span> por <span class="math inline">\(\bf x\)</span>, el vector de observaciones de dicha variable. Por tanto, cada elemento del retardo espacial (o variable retardada espacialmente) <span class="math inline">\(\bf{Wx}\)</span> es la media ponderada de las observaciones de la variable <span class="math inline">\(X\)</span> en el vecindario de cada <span class="math inline">\(i\)</span>-ésima localidad.</p>
</div>
</div>
<div id="medidas-de-autocorrelación-espacial" class="section level2" number="42.2">
<h2>
<span class="header-section-number">42.2</span> Medidas de autocorrelación espacial<a class="anchor" aria-label="anchor" href="#medidas-de-autocorrelaci%C3%B3n-espacial"><i class="fas fa-link"></i></a>
</h2>
<p></p>
<p>Una buena herramienta para comprender las medidas de autocorrelación espacial es el <strong>diagrama de Moran</strong> <span class="citation">(<a href="referencias.html#ref-anselinMoranScatterplotESDA1996">Anselin, 1996</a>)</span>. El diagrama de Moran relaciona una variable con lo que sucede en su entorno mediante su retardo espacial en un gráfico de puntos. La Fig. <a href="cap-econom-esp.html#fig:plot-moranplot">42.3</a> presenta un diagrama de Moran para la variable <em>clergy</em> del conjunto de datos <code>Guerry</code>. Esta variable hace referencia a la ratio de sacerdotes católicos sobre la población de cada provincia francesa. La línea horizontal discontinua en la Fig. <a href="cap-econom-esp.html#fig:plot-moranplot">42.3</a> indica el promedio del retardo espacial, mientras que la línea vertical discontinua indica el promedio de la variable <em>clergy</em>. La división del diagrama de Moran a partir de dichos promedios genera cuatro zonas: <span class="math inline">\((i)\)</span> el cuadrante superior derecho, que contiene las localidades en las que tanto en ellas como en su vecindario el valor de la variable <em>clergy</em> es superior al promedio correspondiente; <span class="math inline">\((ii)\)</span> el cuadrante inferior izquierdo, en la que se ubican las localidades en las que tanto en ellas como en sus correspondientes vecindarios la variable <em>clergy</em> tiene valores inferiores a sus correspondientes promedios; <span class="math inline">\((iii)\)</span> el cuadrante superior izquierdo, que contiene las localidades en las que el valor de la variable <em>clergy</em> es inferior al promedio, pero en su vecindario supera el valor promedio; y <span class="math inline">\((iv)\)</span> el cuadrante inferior derecho, donde las localidades tienen un valor de la variable <em>clergy</em> superior al promedio de localidades, pero su vecindario no supera el valor promedio de los vecindarios.</p>
<p>A partir del diagrama de Moran es posible observar la situación de una variable respecto a su entorno. Si las localidades se sitúan mayoritariamente en los cuadrantes inferior izquierdo y superior derecho, las localidades con altos valores (superiores al promedio) de la variable de interés están rodeadas por localidades con altos valores de dicha variable, y las localidades con valores bajos (inferiores al promedio) están rodeadas de localidades con valores bajos, lo cual es una señal de existencia de autocorrelación espacial positiva. Si la concentración tiene lugar en los cuadrantes superior izquierdo e inferior derecho, la autocorrelación espacial es negativa.</p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-spatial/spdep/">"spdep"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"CDR"</span><span class="op">)</span></span>
<span><span class="va">w_reina_francia</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">guerry</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">nb2listw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Diagrama de Moran</span></span>
<span><span class="fu">moran.plot</span><span class="op">(</span><span class="va">guerry</span><span class="op">$</span><span class="va">clergy</span>, <span class="va">w_reina_francia</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Clergy"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Retardo espacial de Clergy"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-moranplot"></span>
<img src="img/moran-clergy.png" alt="Diagrama de Moran de la variable Clergy." width="60%"><p class="caption">
Figura 42.3: Diagrama de Moran de la variable Clergy.
</p>
</div>
<p>En la Fig. <a href="cap-econom-esp.html#fig:plot-moranplot">42.3</a> se pueden apreciar indicios de la existencia de autocorrelación positiva, es decir, las localidades francesas tienden a estar rodeadas de localidades con una ratio similar de clérigos. El diagrama de Moran es una herramienta gráfica. Para comprobar estadísticamente la existencia de autocorrelación espacial se utiliza el indicador <span class="math inline">\(I\)</span> de Moran.</p>
<div id="el-indicador-i-de-moran" class="section level3" number="42.2.1">
<h3>
<span class="header-section-number">42.2.1</span> El indicador <em>I</em> de Moran<a class="anchor" aria-label="anchor" href="#el-indicador-i-de-moran"><i class="fas fa-link"></i></a>
</h3>
<p>Sea una variable genérica <span class="math inline">\(X\)</span>. Sea <span class="math inline">\(Z=X- \bar{X}\)</span> la variable <span class="math inline">\(X\)</span> centrada. Entonces, el valor del indicador de Moran se obtiene como:</p>
<span class="math display" id="eq:moranI">\[\begin{equation}
I = \dfrac{n}{\sum_{i=1}^n\sum_{j=1}^n w_{ij}}\dfrac{\sum_{i=1}^{n}\sum_{j=1}^{n} z_{i}w_{ij}z_{j}}{\sum_{i=1}^{n}z_{i}^{2}}.  \tag{42.1}
\end{equation}\]</span>
<p>Su campo de variación es <span class="math inline">\([-1, 1]\)</span> y el signo coincide con el tipo de autocorrelación: valores positivos son indicativos de autocorrelación positiva y valores negativos son indicadores de la existencia de autocorrelación negativa. Nótese que <span class="math inline">\(I\)</span> no es sino el cociente entre la covarianza de la variable <span class="math inline">\(X\)</span> y su retardo espacial y la varianza de la variable <span class="math inline">\(X\)</span>. Por tanto, coincide con el coeficiente de la regresión lineal del retardo espacial de <span class="math inline">\(X\)</span> sobre la propia variable <span class="math inline">\(X\)</span>. La línea con pendiente positiva en la Fig. <a href="cap-econom-esp.html#fig:plot-moranplot">42.3</a> es precisamente la recta de regresión del retardo espacial de <em>clergy</em> sobre la propia variable y, por tanto, su pendiente es el indicador <span class="math inline">\(I\)</span> de Moran. En este sentido, cuanto mayor sea la pendiente de esta recta mayor será el grado de autocorrelación espacial existente. La significatividad estadística del indicador <span class="math inline">\(I\)</span> se establece bajo la hipótesis nula de <strong>aleatoriedad espacial</strong>. La aleatoriedad espacial implica la inexistencia de autocorrelación espacial en la variable analizada; es decir, considera que la variable que se analiza está distribuida en forma aleatoria entre las localidades. En este contexto, <span class="math inline">\(p\)</span>-valores bajos permiten rechazar la hipótesis de aleatoriedad espacial, indicando la existencia de autocorrelación espacial en la variable estudiada <span class="citation">(<a href="referencias.html#ref-anselin2013">Anselin, 2013</a>)</span>.</p>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">moran.test</span><span class="op">(</span><span class="op">(</span><span class="va">guerry</span><span class="op">$</span><span class="va">clergy</span><span class="op">)</span>, <span class="va">w_reina_francia</span>,</span>
<span>  randomisation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"two.sided"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Moran I test under randomisation</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; data: (guerry$clergy)</span></span>
<span><span class="co">#&gt; weights: w_reina_francia</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Moran I statistic standard deviate = 6.1632, p-value = 7.13e-10</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; Moran I statistic       Expectation         Variance</span></span>
<span><span class="co">#&gt;       0.421118648      -0.011904762      0.004936422</span></span></code></pre></div>
<p></p>
<p>Como puede apreciarse en la salida de <strong>R</strong> anterior, en el ejemplo de la variable <em>clergy</em> el <span class="math inline">\(p\)</span>-valor permite rechazar la hipótesis nula de aleatoriedad espacial en favor de la existencia de autocorrelación positiva.</p>
</div>
</div>
<div id="modelos-econométricos-espaciales-de-corte-transversal" class="section level2" number="42.3">
<h2>
<span class="header-section-number">42.3</span> Modelos econométricos espaciales de corte transversal<a class="anchor" aria-label="anchor" href="#modelos-econom%C3%A9tricos-espaciales-de-corte-transversal"><i class="fas fa-link"></i></a>
</h2>
<p></p>
<p>Los modelos espaciales deben ser identificados antes de proceder a su estimación y contraste. Para ello, es importante disponer de una estrategia de identificación propia que permita al investigador estimar los parámetros poblacionales a partir de la observación de una muestra de datos.</p>
<p>Tradicionalmente, la econometría espacial ha resuelto este problema asumiendo que la especificación de los modelos es algo que se conoce <em>a priori</em>, bien a partir de la teoría económica existente o bien aplicando ciertas estrategias consistentes en la comparación de varios modelos competitivos. Dentro de esta última opción, se pueden destacar dos estrategias de modelización ampliamente utilizadas: <span class="math inline">\((i)\)</span> la que va de lo particular (modelo básico sin efectos de autocorrelación espacial) a lo general (modelo con variables explicativas espacialmente retardadas) y <span class="math inline">\((ii)\)</span> la que parte de un modelo general para terminar en un modelo de autocorrelación espacial más sencillo. A partir de estos dos enfoques previos es posible plantear la estrategia híbrida de <span class="citation">Elhorst (<a href="referencias.html#ref-elhorstAppliedSpatialEconometrics2010">2010</a>)</span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:estrat"></span>
<img src="img/Estrategia.png" alt="Estrategia de especificación híbrida Elhorst (2010)." width="90%"><p class="caption">
Figura 42.4: Estrategia de especificación híbrida Elhorst (2010).
</p>
</div>
<p>Como puede verse en la Fig. <a href="cap-econom-esp.html#fig:estrat">42.4</a>, la estrategia híbrida comienza con la estimación de un <strong>modelo básico sin efectos espaciales</strong>:</p>
<span class="math display">\[\begin{equation}
\mathbf{y} = \alpha \boldsymbol{\iota_n} + \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon},
\end{equation}\]</span>
<p>siendo <span class="math inline">\(\mathbf{y}\)</span> el vector de observaciones de la variable dependiente, de orden <span class="math inline">\((n\times 1)\)</span>; <span class="math inline">\(\mathbf{X}\)</span> la matriz que contiene los valores de las variables explicativas, de orden <span class="math inline">\((n\times k)\)</span>; <span class="math inline">\(\boldsymbol{\iota_n}\)</span> un vector formado por 1, de orden <span class="math inline">\((n \times 1)\)</span>; <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\boldsymbol{\beta}\)</span> son el conjunto de <span class="math inline">\((p+1)\)</span> parámetros a estimar; y <span class="math inline">\(\boldsymbol{\epsilon}\)</span> es el vector de perturbaciones aleatorias, de orden <span class="math inline">\((n\times 1)\)</span>, que se distribuye como <span class="math inline">\(\boldsymbol{\epsilon} \sim N(\mathbf{0},\sigma_{\epsilon}\mathbf{I}_n)\)</span>, siendo <span class="math inline">\(\mathbf{I}_n\)</span> la matriz identidad de orden <span class="math inline">\(n\)</span>.</p>
<p>Este modelo se estima por MCO y luego se llevan a cabo dos contrastes del multiplicador de Lagrange (LM) sobre los errores de la regresión para contrastar si son ruido blanco desde el punto de vista espacial. Se trata de dos tests orientados a una única hipótesis alternativa cada uno de ellos: el LMLAG, para la hipótesis de variable dependiente espacialmente retardada, y el LMERR, para la hipótesis de dependencia residual. La hipótesis nula (el modelo básico MCO es válido) se rechaza si alguno de los estadísticos de contraste, que se distribuyen como una Chi cuadrado con 1 grado de libertad (<span class="math inline">\(\chi_1^2\)</span>) bajo la hipótesis nula, resulta estadísticamente significativo. En este caso, se recomienda seleccionar el <strong>modelo Durbin espacial</strong> (SDM), que es un modelo general <span class="citation">(<a href="referencias.html#ref-anselin1988spatial">Anselin, 1988</a>)</span>:</p>
<span class="math display">\[\begin{equation}
\mathbf{y} = \rho \mathbf{Wy} + \alpha \boldsymbol{\iota_n} + \mathbf{X}\boldsymbol{\beta} + \mathbf{WX}\boldsymbol{\theta} +\boldsymbol{\epsilon},
\end{equation}\]</span>
<p>siendo <span class="math inline">\(\rho\)</span> un parámetro autorregresivo espacial y <span class="math inline">\(\boldsymbol{\theta}\)</span> un vector de <em>p</em> parámetros autorregresivos espaciales.</p>
<p>Este modelo general incluye dos tipos de interacción espacial: los efectos endógenos (<span class="math inline">\(\mathbf{Wy}\)</span>) y exógenos (<span class="math inline">\(\mathbf{WX}\)</span>). La variable endógena espacialmente retardada (cuyos valores son los componentes del vector <span class="math inline">\(\mathbf{Wy}\)</span>) referida al mismo momento del tiempo que la variable dependiente (con vector de valores <span class="math inline">\(\mathbf{y}\)</span>) produce una situación de simultaneidad y, por tanto, de sesgo, ineficiencia e inconsistencia en los estimadores MCO. Por eso se recomienda su estimación por el método de máxima verosimilitud (<em>maximum likelihood</em> en inglés, ML), que supone normalidad en la distribución de los errores <span class="citation">(véase <a href="referencias.html#ref-anselin1988spatial">Anselin, 1988</a>, Cap. 6)</span>.</p>
<p>La estimación ML de este modelo permite utilizar la ratio de verosimilitud (<em>likelihood ratio</em> en inglés, LR) para contrastar, por separado, las hipótesis nulas <span class="math inline">\(H_0 (\boldsymbol{\theta}=0)\)</span> y <span class="math inline">\(H_0(\rho=0)\)</span>, siendo las hipótesis alternativas las opciones contrarias. Dicho estadístico, bajo la hipótesis nula, se distribuye como una Chi cuadrado con <span class="math inline">\(k\)</span> grados de libertad. En este punto, se pueden dar tres casos:</p>
<ol style="list-style-type: decimal">
<li>Si no se rechaza la primera hipótesis, pero sí la segunda, siempre y cuando los valores de los tests LMLAG &gt; LMERR, el SDM debería simplificarse a un modelo del retardo espacial o modelo autorregresivo espacial de orden 1 (SAR):</li>
</ol>
<span class="math display" id="eq:sar">\[\begin{equation}
\mathbf{y} = \rho \mathbf{Wy} + \alpha \boldsymbol{\iota_n} + \mathbf{X}\boldsymbol{\beta} +\boldsymbol{\epsilon}.  \tag{42.2}
\end{equation}\]</span>
<p>Este modelo se estima por ML si los residuos de la estimación por MCO se distribuyen como una normal.</p>
<ol start="2" style="list-style-type: decimal">
<li>Si no se rechaza la segunda hipótesis, pero sí la primera, y los valores de los tests LMERR &gt; LMLAG, debería seleccionarse el <strong>modelo del error espacial</strong> (SEM):</li>
</ol>
<span class="math display">\[\begin{equation}
\begin{cases}
\mathbf{y} = \alpha \boldsymbol{\iota_n} + \mathbf{X}\boldsymbol{\beta} +\mathbf{u}\\
u=\lambda\mathbf{W}\boldsymbol{\epsilon} + \boldsymbol{\epsilon},
\end{cases}
\end{equation}\]</span>
<p>siendo <span class="math inline">\(\lambda\)</span> un parámetro autorregresivo espacial a estimar. La estimación MCO produciría estimadores insesgados y consistentes, pero ineficientes. Por eso, se considera aceptable estimar el modelo SEM por MCO realizando una inferencia robusta de la matriz de varianzas y covarianzas de los estimadores por el método KP-HET propuesto por <span class="citation">Kelejian &amp; Prucha (<a href="referencias.html#ref-kelejianSpecificationEstimationSpatial2010">2010</a>)</span>, que tiene en cuenta la existencia conjunta de heterocedasticidad y autocorrelación espacial en los residuos de la regresión.</p>
<ol start="3" style="list-style-type: decimal">
<li>Si se rechazan ambas hipótesis nulas o no hubiera consenso entre los resultados del test LR y los tests LM, entonces el SDM sería el modelo que mejor describiría los datos.</li>
</ol>
<p>En segundo lugar, si tras la estimación MCO del modelo básico ninguno de los tests LM fuera estadísticamente significativo, entonces dicho modelo tendría que ser reestimado como un <strong>modelo espacial regresivo transversal</strong> (SLX):</p>
<span class="math display">\[\begin{equation}
\mathbf{y} = \alpha \boldsymbol{\iota_n} + \mathbf{X}\boldsymbol{\beta} + \mathbf{WX}\boldsymbol{\theta} +\boldsymbol{\epsilon}.
\end{equation}\]</span>
<p>Este modelo puede estimarse por MCO, ya que si las variables explicativas son exógenas también lo serán sus correspondientes retardos espaciales. Este modelo puede considerar todas las variables exógenas espacialmente retardadas o un subconjunto de ellas. Si la hipótesis de nulidad de los retardos espaciales de todas ellas fuese rechazada, debería elegirse el modelo básico como el que mejor describe los datos, es decir, no existiría evidencia alguna de la necesidad de efectos de autocorrelación espacial para explicar la variable dependiente. Pero si, por el contrario, la hipótesis <span class="math inline">\(H_0(\boldsymbol{\theta}=0)\)</span> no fuese rechazada, habría que estimar el modelo SDM con las variables <span class="math inline">\(\mathbf{WX}\)</span> estadísticamente significativas para contrastar, de nuevo, la hipótesis nula <span class="math inline">\(H_0(\rho=0)\)</span>. Si se rechaza esta hipótesis, el modelo seleccionado sería el SDM, pero en caso contrario, sería el modelo SLX el que mejor describiría los datos.</p>
<p>Estos modelos pueden estimarse también con metodología bayesiana utilizando el enfoque <em>Markov Chains Monte Carlo</em> (MCMC), tal y como se explica en <span class="citation">LeSage &amp; Pace (<a href="referencias.html#ref-lesage2009introduction">2009</a>)</span> Cap. 5.</p>
<p>El siguiente conjunto de secuencias de código muestra cómo estimar los modelos que intervienen en la estrategia de modelización de Elhorst. Para ello, se utiliza un conjunto de datos de los 120 municipios grandes de España (capitales de provincia y ciudades con población superior a 50.000 habitantes) que forman parte de las áreas urbanas del país <span class="citation">(<a href="referencias.html#ref-mellaUrbanGrowthTerritorial2006">Mella &amp; Chasco, 2006</a>)</span>. Con estos datos se formula un modelo de crecimiento económico urbano en España en el que la tasa media de variación del PIB per cápita, en logaritmos, durante el período 1985-2003 (LPGH), se explica en función del PIB per cápita en logaritmos de 1985 (LGH85), la tasa de variación del número de entidades bancarias en el período 1985-2003 (BANK), el porcentaje de personas con educación secundaria y universitaria sobre la población de 16 y más años en el año 2001 (UNI01) y la tasa del número de patentes por habitante en el año 2000 (PAT00).</p>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-spatial/spatialreg/">"spatialreg"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"tseries"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Matriz de pesos espaciales</span></span>
<span><span class="va">coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span></span>
<span><span class="va">k6</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">coord</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">dmins</span> <span class="op">&lt;-</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="va">k6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">nb2listw</span><span class="op">(</span>style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co"># Estimación modelo básico por MCO</span></span>
<span><span class="va">gdp_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>, data <span class="op">=</span> <span class="va">gdpmap</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_ols</span><span class="op">)</span></span>
<span><span class="fu">jarque.bera.test</span><span class="op">(</span><span class="va">gdp_ols</span><span class="op">$</span><span class="va">res</span><span class="op">)</span> <span class="co"># Test normalidad de residuos</span></span>
<span><span class="fu">lm.LMtests</span><span class="op">(</span><span class="va">gdp_ols</span>, <span class="va">dmins</span>, test <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="co"># Grupo de tests LM</span></span>
<span></span>
<span><span class="co"># Estimación modelo SDM por ML</span></span>
<span><span class="va">gdp_sdm</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>, data <span class="op">=</span> <span class="va">gdpmap</span>, listw <span class="op">=</span> <span class="va">dmins</span>, type <span class="op">=</span> <span class="st">"mixed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_sdm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimación modelo SAR por ML</span></span>
<span><span class="va">gdp_sar</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>, data <span class="op">=</span> <span class="va">gdpmap</span>, listw <span class="op">=</span> <span class="va">dmins</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_sar</span><span class="op">)</span></span>
<span><span class="fu">LR.Sarlm</span><span class="op">(</span><span class="va">gdp_sdm</span>, <span class="va">gdp_sar</span><span class="op">)</span> <span class="co"># Test LR: SDM vs. SAR</span></span>
<span></span>
<span><span class="co"># Estimación del modelo SEM por ML</span></span>
<span><span class="va">gdp_err</span> <span class="op">&lt;-</span> <span class="fu">errorsarlm</span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>, data <span class="op">=</span> <span class="va">gdpmap</span>, listw <span class="op">=</span> <span class="va">dmins</span>, tol.solve <span class="op">=</span> <span class="fl">1e-16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_err</span><span class="op">)</span></span>
<span><span class="fu">LR.Sarlm</span><span class="op">(</span><span class="va">gdp_sdm</span>, <span class="va">gdp_err</span><span class="op">)</span> <span class="co"># Test LR: SDM vs. SEM</span></span>
<span></span>
<span><span class="co"># Estimación del modelo SLX por MCO</span></span>
<span></span>
<span><span class="co"># Cálculo retardos espaciales</span></span>
<span><span class="va">gdpmap</span><span class="op">$</span><span class="va">WLGH85</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">dmins</span>, <span class="va">gdpmap</span><span class="op">$</span><span class="va">LGH85</span><span class="op">)</span></span>
<span><span class="va">gdpmap</span><span class="op">$</span><span class="va">WBANK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">dmins</span>, <span class="va">gdpmap</span><span class="op">$</span><span class="va">BANK</span><span class="op">)</span></span>
<span><span class="va">gdpmap</span><span class="op">$</span><span class="va">WUNI01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">dmins</span>, <span class="va">gdpmap</span><span class="op">$</span><span class="va">UNI01</span><span class="op">)</span></span>
<span><span class="va">gdpmap</span><span class="op">$</span><span class="va">WPAT00</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">dmins</span>, <span class="va">gdpmap</span><span class="op">$</span><span class="va">PAT00</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gdp_slx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span> <span class="op">+</span> <span class="va">WLGH85</span> <span class="op">+</span> <span class="va">WBANK</span> <span class="op">+</span> <span class="va">WUNI01</span> <span class="op">+</span> <span class="va">WPAT00</span>, data <span class="op">=</span> <span class="va">gdpmap</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_slx</span><span class="op">)</span> <span class="co"># Modelo SLX completo</span></span>
<span></span>
<span><span class="va">gdp_slx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span> <span class="op">+</span> <span class="va">WLGH85</span> <span class="op">+</span> <span class="va">WPAT00</span>, data <span class="op">=</span> <span class="va">gdpmap</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_slx2</span><span class="op">)</span> <span class="co"># Modelo SLX parsimonioso</span></span>
<span><span class="fu">LR.Sarlm</span><span class="op">(</span><span class="va">gdp_sdm</span>, <span class="va">gdp_slx2</span><span class="op">)</span> <span class="co"># Test LR: SDM vs. SLX</span></span></code></pre></div>
<div id="estimación-sar" class="section level3" number="42.3.1">
<h3>
<span class="header-section-number">42.3.1</span> Estimación SAR<a class="anchor" aria-label="anchor" href="#estimaci%C3%B3n-sar"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación se muestra la salida de la estimación del modelo SAR, pudiéndose observar que todos los parámetros estimados, incluido <span class="math inline">\(\rho\)</span>, son estadísticamente significativos.</p>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"CDR"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-spatial/spatialreg/">"spatialreg"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"tseries"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-spatial/spdep/">"spdep"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Matriz de pesos espaciales</span></span>
<span><span class="va">coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span></span>
<span><span class="va">k6</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">coord</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">dmins</span> <span class="op">&lt;-</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="va">k6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">nb2listw</span><span class="op">(</span>style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co"># Estimación modelo SAR por ML</span></span>
<span><span class="va">gdpsar</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gdpmap</span>,</span>
<span>  listw <span class="op">=</span> <span class="va">dmins</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdpsar</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; Call:lagsarlm(formula = LPGH ~ LGH85 + BANK + UNI01 + PAT00, data = gdpmap,</span></span>
<span><span class="co">#&gt; listw = dmins)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt; Min 1Q Median 3Q Max</span></span>
<span><span class="co">#&gt; -0.0184657 -0.0034523 0.0012278 0.0032544 0.0194746</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Type: lag</span></span>
<span><span class="co">#&gt; Coefficients: (asymptotic standard errors)</span></span>
<span><span class="co">#&gt; Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept) 2.5745e-01 3.0703e-02 8.3851 &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; LGH85 -3.2962e-02 4.4472e-03 -7.4119 1.246e-13</span></span>
<span><span class="co">#&gt; BANK 6.6493e-05 1.3086e-05 5.0811 3.753e-07</span></span>
<span><span class="co">#&gt; UNI01 4.6884e-04 8.4080e-05 5.5762 2.459e-08</span></span>
<span><span class="co">#&gt; PAT00 4.7256e-02 1.8113e-02 2.6090 0.009082</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Rho: 0.36545, LR test value: 16.353, p-value: 5.2578e-05</span></span>
<span><span class="co">#&gt; Asymptotic standard error: 0.078929</span></span>
<span><span class="co">#&gt; z-value: 4.6302, p-value: 3.6538e-06</span></span>
<span><span class="co">#&gt; Wald statistic: 21.438, p-value: 3.6538e-06</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Log likelihood: 447.309 for lag model</span></span>
<span><span class="co">#&gt; ML residual variance (sigma squared): 3.7602e-05, (sigma: 0.006132)</span></span>
<span><span class="co">#&gt; Number of observations: 122</span></span>
<span><span class="co">#&gt; Number of parameters estimated: 7</span></span>
<span><span class="co">#&gt; AIC: -880.62, (AIC for lm: -866.27)</span></span>
<span><span class="co">#&gt; LM test for residual autocorrelation</span></span>
<span><span class="co">#&gt; test value: 6.4996, p-value: 0.01079</span></span></code></pre></div>
</div>
<div id="comparando-sar-con-sdm" class="section level3" number="42.3.2">
<h3>
<span class="header-section-number">42.3.2</span> Comparando SAR con SDM<a class="anchor" aria-label="anchor" href="#comparando-sar-con-sdm"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación se muestra el resultado del test comparando el modelo SDM con el SAR. A la luz de los valores de la LR se rechaza que <span class="math inline">\(\bf {\theta}=0\)</span> sea cero y, por tanto, el modelo SDM es más adecuado para explicar esta variable que el modelo SAR.</p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Matriz de pesos espaciales</span></span>
<span><span class="va">coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span></span>
<span><span class="va">k6</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">coord</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">dmins</span> <span class="op">&lt;-</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="va">k6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">nb2listw</span><span class="op">(</span>style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimación modelo SDM por ML</span></span>
<span><span class="va">gdpsdm</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gdpmap</span>,</span>
<span>  listw <span class="op">=</span> <span class="va">dmins</span>, type <span class="op">=</span> <span class="st">"mixed"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimación modelo SAR por ML</span></span>
<span><span class="va">gdpsar</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="va">LPGH</span> <span class="op">~</span> <span class="va">LGH85</span> <span class="op">+</span> <span class="va">BANK</span> <span class="op">+</span> <span class="va">UNI01</span> <span class="op">+</span> <span class="va">PAT00</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gdpmap</span>,</span>
<span>  listw <span class="op">=</span> <span class="va">dmins</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">LR.Sarlm</span><span class="op">(</span><span class="va">gdpsdm</span>, <span class="va">gdpsar</span><span class="op">)</span> <span class="co"># Test LR: SDM vs. SAR</span></span>
<span></span>
<span><span class="co">#&gt; Likelihood ratio for spatial linear models</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; data:</span></span>
<span><span class="co">#&gt; Likelihood ratio = 11.559, df = 4, p-value = 0.02095</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; Log likelihood of gdpsdm Log likelihood of gdpsar</span></span>
<span><span class="co">#&gt; 453.0885 447.3090</span></span></code></pre></div>
</div>
<div id="interpretación-de-los-estimadores-de-los-modelos-de-autocorrelación-espacial" class="section level3" number="42.3.3">
<h3>
<span class="header-section-number">42.3.3</span> Interpretación de los estimadores de los modelos de autocorrelación espacial<a class="anchor" aria-label="anchor" href="#interpretaci%C3%B3n-de-los-estimadores-de-los-modelos-de-autocorrelaci%C3%B3n-espacial"><i class="fas fa-link"></i></a>
</h3>
<p></p>
<p>Solo en los modelos de autocorrelación espacial en los que el efecto endógeno (<span class="math inline">\(\mathbf{Wy}\)</span>) no está presente en la parte derecha del modelo, los coeficientes estimados (<span class="math inline">\(\hat{{\bf\beta}}\)</span>) pueden interpretarse de forma directa, como en el modelo básico sin efectos espaciales. Es decir, el efecto marginal en la variable explicada de un cambio del valor de una variable explicativa continua coincide con la estimación del coeficiente correspondiente a dicha variable, para todas y cada una de las localizaciones. Por ejemplo, para la <span class="math inline">\(k\)</span>-ésima variable explicativa, en la <span class="math inline">\(i\)</span>-ésima localización <span class="math inline">\(i=1,..., n\)</span> se tiene:</p>
<span class="math display" id="eq:dpdyx">\[\begin{equation}
\frac{\partial Y_i}{\partial X_{i,k}}= \beta_k . \tag{42.3}
\end{equation}\]</span>
<p>En los modelos SAR y SDM, la correcta interpretación de los estimadores implica pasar antes de su forma estructural a su forma reducida. Así, por ejemplo, en el modelo SAR la forma reducida de la expresión <a href="cap-econom-esp.html#eq:sar">(42.2)</a> sería (bajo ciertas condiciones de invertibilidad):</p>
<span class="math display" id="eq:multiW">\[\begin{equation}
\mathbf{y} = (\mathbf{I}-\rho\mathbf{W})^{-1}(\alpha \boldsymbol{\iota_n}+\mathbf{X}\boldsymbol{\beta}+\boldsymbol{\epsilon}). \tag{42.4}
\end{equation}\]</span>
<p>El término <span class="math inline">\((\mathbf{I}-\rho\mathbf{W})^{-1}\)</span> se denomina <strong>multiplicador espacial</strong> y, utilizando la expansión potencial, puede expresarse también del modo siguiente:</p>
<span class="math display">\[\begin{equation}
(\mathbf{I}-\rho\mathbf{W})^{-1}=\mathbf{I}+\rho\mathbf{W}+\rho^2\mathbf{W}^2+\dots
\end{equation}\]</span>
<p>Si se utiliza esta nueva expresión en la ecuación <a href="cap-econom-esp.html#eq:multiW">(42.4)</a> se observa más claramente que el valor de <span class="math inline">\(Y\)</span> en una determinada localización es función no solo del valor de las variables explicativas en esa localización, sino también del valor de las explicativas en las localizaciones vecinas (a través del término <span class="math inline">\(\rho\mathbf{WX}\boldsymbol{\beta}\)</span>), del valor de las explicativas en las localizaciones vecinas a las vecinas (a través del término <span class="math inline">\(\rho^2\mathbf{W}^2\mathbf{X}\boldsymbol{\beta}\)</span>), etc., hasta llegar a los límites del sistema espacial en estudio.</p>
<span class="math display">\[\begin{equation}
E(Y|\mathbf{X})=\mathbf{X}\boldsymbol{\beta}+\rho\mathbf{W}\mathbf{X}\boldsymbol{\beta}+\rho^2\mathbf{W}^2\mathbf{X}\boldsymbol{\beta}+\rho^3\mathbf{W}^3\mathbf{X}\boldsymbol{\beta}+\dots
\end{equation}\]</span>
<p><span class="citation">LeSage &amp; Pace (<a href="referencias.html#ref-lesage2009introduction">2009</a>)</span> presentan el cambio (también llamado efecto o impacto) experimentado por <span class="math inline">\(\mathbf{y}\)</span> en una localización <span class="math inline">\(i\)</span>, sea cual sea <span class="math inline">\(i\)</span>, debido a un cambio en el valor <span class="math inline">\(X_k\)</span> en otra localización, <span class="math inline">\(j\)</span>, sea cual sea <span class="math inline">\(j\)</span>. Dicho conjunto de impactos o efectos se presenta en una matriz completa, <span class="math inline">\(\mathbf{S}_k(\mathbf{W})_{ij}\)</span>, de orden <span class="math inline">\(n\times n\)</span>. Así, cada variable explicativa <span class="math inline">\(X_k\)</span> del modelo tendrá una matriz completa propia de impactos sobre la variable dependiente:</p>
<span class="math display">\[\begin{equation}
\mathbf{S}_k(\mathbf{W})_{ij}=(\mathbf{I_n}-\rho\mathbf{W})^-1\beta_k .
\end{equation}\]</span>
<p>donde el elemento de la <em>i</em>-ésima columna y la <em>j</em>-ésima fila de la matriz es <span class="math inline">\(\frac{\partial Y_j}{\partial X_{ik}}\)</span>, el impacto de un incremento en la variable
<span class="math inline">\(X_k\)</span> en la <em>i</em>-ésima localización sobre la variable <span class="math inline">\(Y\)</span> en la <em>j</em>-ésima localización.</p>
<p>En los modelos SAR y SDM, también se puede distinguir entre efectos directos e indirectos. El efecto directo sería el efecto causado por cambios en el valor de <span class="math inline">\(X_k\)</span>, en una localización <span class="math inline">\(i\)</span> sobre el valor de <span class="math inline">\(Y\)</span> en esa misma localización. Estos efectos son los valores de la diagonal principal de la matriz, <span class="math inline">\(s_k(\mathbf{W})_{ii}\)</span>. El efecto indirecto viene dado por el resto de los valores de la matriz <span class="math inline">\(\mathbf{S}_k(\mathbf{W})_{ij}\)</span>, que serían los “bucles de retroalimentación” en los que el valor de <span class="math inline">\(X_k\)</span>, en una localización <span class="math inline">\(j\)</span>, afecta al valor de <span class="math inline">\(Y\)</span> en la localización <span class="math inline">\(i \neq j\)</span>, y viceversa, pudiéndose dar recorridos más largos en los que el efecto en una localización podría llegar a la última localización observada <span class="math inline">\(n\)</span> y luego volver de nuevo al punto de partida.</p>
<p>Por ejemplo, <span class="math inline">\(s_k(\mathbf{W})_{11}\)</span> es el efecto directo de un cambio unitario en el valor de la variable <span class="math inline">\(X_k\)</span> en la localización 1 (<span class="math inline">\(\mathbf{x}_{k1}\)</span>) sobre el valor de la variable <span class="math inline">\(Y\)</span> en esa misma localización (<span class="math inline">\(Y_1\)</span>), mientras que el valor <span class="math inline">\(\mathbf{s}_k(\mathbf{W})_{12}\)</span> es el efecto indirecto de un cambio unitario en el valor de la variable <span class="math inline">\(X_{k}\)</span> en la primera localización, sobre el valor de la variable <span class="math inline">\(Y\)</span> en la segunda (<span class="math inline">\(Y_2\)</span>). En las filas, la matriz <span class="math inline">\(\mathbf{S}_k(\mathbf{W})_{ij}\)</span> tiene los efectos de un cambio unitario en <span class="math inline">\(X_k\)</span> en la <span class="math inline">\(i\)</span>-ésima localización en la variable <span class="math inline">\(Y\)</span> y en cada una de sus localizaciones. Las columnas de la matriz contienen el efecto de un cambio unitario en <span class="math inline">\(X_k\)</span>, en cada una de sus posibles localizaciones, sobre la variable <span class="math inline">\(Y_j\)</span>, provocado “desde” todas y cada una de las localizaciones <span class="math inline">\(i\)</span> sobre la localización <span class="math inline">\(j\)</span>.</p>
<p>Dado que no es posible contrastar si todos los impactos directos e indirectos contenidos en la matriz <span class="math inline">\(\mathbf{S}_k(\mathbf{W})_{ij}\)</span> son significativamente distintos de cero o construir intervalos de confianza para ellos, LeSage y Pace proponen llevar a cabo el proceso inferencial sobre el valor medio de los efectos directos y totales, extrayendo el promedio de los efectos indirectos por diferencia: <span class="math display">\[\begin{align}
\bar{M}(k)_{directo}=tr(\mathbf{S}_k(\mathbf{W}))/n \\
\bar{M}(k)_{total}=\boldsymbol{\iota'_n}\mathbf{S}_k(\mathbf{W})\boldsymbol{\iota_n}/n \\
\bar{M}(k)_{indirecto}=\bar{M}(k)_{total}- \bar{M}(k)_{directo},
\end{align}\]</span></p>
<p>donde <span class="math inline">\(\bar{M}\)</span> indica que se trata de un efecto promedio.</p>
<p>El siguiente conjunto de secuencias sirve para calcular las matrices de efectos directos, indirectos y totales, así como la inferencia para los modelos SAR y SDM, en el caso de la modelización del crecimiento económico urbano en España.</p>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"coda"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cálculo de los efectos para el modelo SAR (LeSage y Pace)</span></span>
<span><span class="va">Wsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span><span class="fu">as_dgRMatrix_listw</span><span class="op">(</span><span class="va">dmins</span><span class="op">)</span>, <span class="st">"CsparseMatrix"</span><span class="op">)</span></span>
<span><span class="va">trMat</span> <span class="op">&lt;-</span> <span class="fu">trW</span><span class="op">(</span><span class="va">Wsp</span>, type <span class="op">=</span> <span class="st">"mult"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Simulaciones para el proceso inferencial</span></span>
<span><span class="va">gdpsar_impacts</span> <span class="op">&lt;-</span> <span class="fu">impacts</span><span class="op">(</span><span class="va">gdpsar</span>, tr <span class="op">=</span> <span class="va">trMat</span>, R <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, zstats <span class="op">=</span> <span class="cn">TRUE</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/HPDinterval.html">HPDinterval</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, choice <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/HPDinterval.html">HPDinterval</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, choice <span class="op">=</span> <span class="st">"indirect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/HPDinterval.html">HPDinterval</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, choice <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, choice <span class="op">=</span> <span class="st">"indirect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsar_impacts</span>, trace <span class="op">=</span> <span class="cn">TRUE</span>, density <span class="op">=</span> <span class="cn">FALSE</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cálculo de la matriz de impactos para la variable LGH85</span></span>
<span><span class="va">clear.pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">clear.pr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gdpmap</span><span class="op">$</span><span class="va">MUNICIPIO</span></span>
<span><span class="va">svec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">eye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">gdpmap</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">eye</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">clear.pr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cvec</span> <span class="op">&lt;-</span> <span class="va">svec</span></span>
<span>  <span class="va">cvec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">eye</span> <span class="op">-</span> <span class="va">gdpsar</span><span class="op">[[</span><span class="st">"rho"</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">Wsp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">cvec</span> <span class="op">*</span> <span class="va">gdpsar</span><span class="op">[[</span><span class="st">"coefficients"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"LGH85"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">clear.pr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">eye</span> <span class="op">-</span> <span class="va">gdpsar</span><span class="op">[[</span><span class="st">"rho"</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">Wsp</span><span class="op">)</span></span>
<span><span class="va">deriv_LGH85</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">eye</span> <span class="op">-</span> <span class="va">gdpsar</span><span class="op">[[</span><span class="st">"rho"</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">Wsp</span><span class="op">)</span> <span class="op">*</span> <span class="va">gdpsar</span><span class="op">[[</span><span class="st">"coefficients"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"LGH85"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Cálculo de los efectos para el modelo SDM (LeSage y Pace)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Simulaciones para el proceso inferencial</span></span>
<span><span class="va">gdpsdm_impacts</span> <span class="op">&lt;-</span> <span class="fu">impacts</span><span class="op">(</span><span class="va">gdpsdm</span>, tr <span class="op">=</span> <span class="va">trMat</span>, R <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, zstats <span class="op">=</span> <span class="cn">TRUE</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/HPDinterval.html">HPDinterval</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, choice <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/HPDinterval.html">HPDinterval</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, choice <span class="op">=</span> <span class="st">"indirect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/HPDinterval.html">HPDinterval</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, choice <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, choice <span class="op">=</span> <span class="st">"indirect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdpsdm_impacts</span>, trace <span class="op">=</span> <span class="cn">TRUE</span>, density <span class="op">=</span> <span class="cn">FALSE</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="impacto-del-sdm" class="section level3" number="42.3.4">
<h3>
<span class="header-section-number">42.3.4</span> Impacto del SDM<a class="anchor" aria-label="anchor" href="#impacto-del-sdm"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación se presenta la salida del cálculo de los efectos para el modelo SDM <span class="citation">(<a href="referencias.html#ref-lesage2009introduction">LeSage &amp; Pace, 2009</a>)</span>, pudiéndose observar que todos son estadísticamente significativos y, salvo en el caso de la variable LGH85, todos ellos son positivos. El signo negativo del coeficiente de LGH85 demuestra la convergencia en renta en el grupo de grandes ciudades españolas. El impacto total de un crecimiento del 10% del PIB per cápita en una ciudad en el período inicial (1985) supuso una caída de la tasa media de variación del PIB per cápita en el período 1985-2003 del <span class="math inline">\(-0,63\)</span> % en dicha ciudad. Este impacto es la suma del efecto directo causado por el crecimiento del PIB per cápita en la propia ciudad (<span class="math inline">\(-0,43\)</span>), que es el efecto directo, y el efecto indirecto proveniente del crecimiento del PIB per cápita en el resto de ciudades (<span class="math inline">\(-0,20\)</span>). Por su parte, el efecto total del crecimiento de 10 patentes por habitante supuso un crecimiento del PIB per cápita en el período del <span class="math inline">\(2,12\)</span> %, del cual un <span class="math inline">\(0,5\)</span> % procedía del crecimiento de las patentes per cápita en la propia ciudad (efecto directo) y el <span class="math inline">\(1,62\)</span> % restante fue causado indirectamente por el crecimiento de las patentes en el resto de ciudades.</p>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cálculo de los efectos para el modelo SAR (LeSage y Pace)</span></span>
<span><span class="va">Wsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span><span class="fu">as_dgRMatrix_listw</span><span class="op">(</span><span class="va">dmins</span><span class="op">)</span>, <span class="st">"CsparseMatrix"</span><span class="op">)</span></span>
<span><span class="va">trMat</span> <span class="op">&lt;-</span> <span class="fu">trW</span><span class="op">(</span><span class="va">Wsp</span>, type <span class="op">=</span> <span class="st">"mult"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Simulaciones para el proceso inferencial</span></span>
<span><span class="va">gdp_sdm_impacts</span> <span class="op">&lt;-</span> <span class="fu">impacts</span><span class="op">(</span><span class="va">gdpsdm</span>, tr <span class="op">=</span> <span class="va">trMat</span>, R <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">gdp_sdm_impacts</span>, zstats <span class="op">=</span> <span class="cn">TRUE</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Impact measures (mixed, trace):</span></span>
<span><span class="co">#&gt; Direct Indirect Total</span></span>
<span><span class="co">#&gt; LGH85 -3.967704e-02 -1.656718e-02 -5.624422e-02</span></span>
<span><span class="co">#&gt; BANK 7.484574e-05 -3.878932e-05 3.605642e-05</span></span>
<span><span class="co">#&gt; UNI01 5.459202e-04 3.900067e-04 9.359269e-04</span></span>
<span><span class="co">#&gt; PAT00 5.029859e-02 1.621204e-01 2.124189e-01</span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Simulation results ( variance matrix):</span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Simulated standard errors</span></span>
<span><span class="co">#&gt; Direct Indirect Total</span></span>
<span><span class="co">#&gt; LGH85 4.835913e-03 1.205378e-02 1.208788e-02</span></span>
<span><span class="co">#&gt; BANK 1.289395e-05 4.475846e-05 4.830235e-05</span></span>
<span><span class="co">#&gt; UNI01 8.434442e-05 3.397464e-04 3.621312e-04</span></span>
<span><span class="co">#&gt; PAT00 2.037202e-02 1.317136e-01 1.441993e-01</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Simulated z-values:</span></span>
<span><span class="co">#&gt; Direct Indirect Total</span></span>
<span><span class="co">#&gt; LGH85 -8.246556 -1.3907437 -4.6859617</span></span>
<span><span class="co">#&gt; BANK 5.826543 -0.9252065 0.6980269</span></span>
<span><span class="co">#&gt; UNI01 6.504595 1.2126777 2.6527099</span></span>
<span><span class="co">#&gt; PAT00 2.454730 1.2664303 1.5035704</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Simulated p-values:</span></span>
<span><span class="co">#&gt; Direct Indirect Total</span></span>
<span><span class="co">#&gt; LGH85 2.2204e-16 0.16430 2.7865e-06</span></span>
<span><span class="co">#&gt; BANK 5.6587e-09 0.35486 0.4851604</span></span>
<span><span class="co">#&gt; UNI01 7.7903e-11 0.22525 0.0079848</span></span>
<span><span class="co">#&gt; PAT00 0.014099 0.20536 0.1326920</span></span></code></pre></div>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdp_sdm_impacts</span>, choice <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdp_sdm_impacts</span>, choice <span class="op">=</span> <span class="st">"indirect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">gdp_sdm_impacts</span>, choice <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-imp-dir"></span>
<img src="img/gdp_sdm_imp_dir.png" alt="Impactos directos (SDM)." width="60%"><p class="caption">
Figura 42.5: Impactos directos (SDM).
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-imp-indir"></span>
<img src="img/gdp_sdm_imp_indir.png" alt="Impactos indirectos (SDM)." width="60%"><p class="caption">
Figura 42.6: Impactos indirectos (SDM).
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-imp-total"></span>
<img src="img/gdp_sdm_imp_total.png" alt="Impactos totales (SDM)." width="60%"><p class="caption">
Figura 42.7: Impactos totales (SDM).
</p>
</div>
<p>Como puede observarse en las Figs. <a href="cap-econom-esp.html#fig:plot-imp-dir">42.5</a>, <a href="cap-econom-esp.html#fig:plot-imp-indir">42.6</a> y <a href="cap-econom-esp.html#fig:plot-imp-total">42.7</a>, para cada variable explicativa se estiman tres estimadores, de forma que el efecto total causado por el cambio unitario en el valor de dicha variable sobre el valor de la variable explicada, en una ciudad determinada, es la suma de dos efectos, uno directo, ocasionado por el cambio acaecido en la propia ciudad, y otro indirecto, proveniente del cambio acaecido en el resto de ciudades de España, existiendo tantos efectos como ciudades.</p>
</div>
<div id="resumen-41" class="section level3 unnumbered infobox_resume">
<h3>Resumen<a class="anchor" aria-label="anchor" href="#resumen-41"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>En este capítulo se introduce a la componente espacial en la estimación econométrica y, en particular, el efecto de dependencia espacial inherente en alguna de las variables involucradas en el proceso de modelización.</p></li>
<li><p>Primero, se observa la heterogeneidad espacial de los datos a partir de los mapas temáticos y se presenta el indicador de autocorrelación espacial de Moran.</p></li>
<li><p>Posteriormente, se construye la matriz de pesos espaciales bajo distintas especificaciones.</p></li>
<li><p>Por último, se muestra la taxonomía de los modelos econométricos espaciales, presentando la estrategia de especificación híbrida y se procede a la interpretación de los coeficientes estimados.</p></li>
</ul>
</div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></div>
<div class="next"><a href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Índice del capítulo"><h2>Índice del capítulo</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cap-econom-esp"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li>
<a class="nav-link" href="#la-dependencia-espacial"><span class="header-section-number">42.1</span> La dependencia espacial</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#modelizaci%C3%B3n-de-las-relaciones-espaciales"><span class="header-section-number">42.1.1</span> Modelización de las relaciones espaciales</a></li></ul>
</li>
<li>
<a class="nav-link" href="#medidas-de-autocorrelaci%C3%B3n-espacial"><span class="header-section-number">42.2</span> Medidas de autocorrelación espacial</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#el-indicador-i-de-moran"><span class="header-section-number">42.2.1</span> El indicador I de Moran</a></li></ul>
</li>
<li>
<a class="nav-link" href="#modelos-econom%C3%A9tricos-espaciales-de-corte-transversal"><span class="header-section-number">42.3</span> Modelos econométricos espaciales de corte transversal</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#estimaci%C3%B3n-sar"><span class="header-section-number">42.3.1</span> Estimación SAR</a></li>
<li><a class="nav-link" href="#comparando-sar-con-sdm"><span class="header-section-number">42.3.2</span> Comparando SAR con SDM</a></li>
<li><a class="nav-link" href="#interpretaci%C3%B3n-de-los-estimadores-de-los-modelos-de-autocorrelaci%C3%B3n-espacial"><span class="header-section-number">42.3.3</span> Interpretación de los estimadores de los modelos de autocorrelación espacial</a></li>
<li><a class="nav-link" href="#impacto-del-sdm"><span class="header-section-number">42.3.4</span> Impacto del SDM</a></li>
<li><a class="nav-link" href="#resumen-41">Resumen</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentos de ciencia de datos con <strong>R</strong></strong>" coordinado por <a href="https://blog.uclm.es/gemafaviles/" class="text-light">Gema Fernández-Avilés y José-María Montero</a>. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro ha sido generado con el paquete de R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

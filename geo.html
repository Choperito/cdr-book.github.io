<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 41 Geoestadística | Fundamentos de ciencia de datos con R</title>
<meta name="author" content="Gema Fernández-Avilés y José-María Montero">
<meta name="description" content="Gema Fernández-Avilés\(^{a}\) y José-María Montero\(^{a}\) \(^{a}\)Universidad de Castilla-La Mancha  41.1 Introducción El término geoestadística apareció por primera vez en Matheron (1962), y en...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Capítulo 41 Geoestadística | Fundamentos de ciencia de datos con R">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/cover.png">
<meta property="og:description" content="Gema Fernández-Avilés\(^{a}\) y José-María Montero\(^{a}\) \(^{a}\)Universidad de Castilla-La Mancha  41.1 Introducción El término geoestadística apareció por primera vez en Matheron (1962), y en...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 41 Geoestadística | Fundamentos de ciencia de datos con R">
<meta name="twitter:description" content="Gema Fernández-Avilés\(^{a}\) y José-María Montero\(^{a}\) \(^{a}\)Universidad de Castilla-La Mancha  41.1 Introducción El término geoestadística apareció por primera vez en Matheron (1962), y en...">
<meta name="twitter:image" content="/img/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="bs4_book.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentos de ciencia de datos con <strong>R</strong></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
</form>

      <nav aria-label="Contenido"><h2>Contenido</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li><a class="" href="pr%C3%B3logo.html">Prólogo</a></li>
<li class="book-part">Ciencia, datos, software… y científicos</li>
<li><a class="" href="ciencia-datos.html"><span class="header-section-number">1</span> ¿Es la ciencia de datos una ciencia?</a></li>
<li><a class="" href="metodologia.html"><span class="header-section-number">2</span> Metodología en ciencia de datos</a></li>
<li><a class="" href="ch-110003.html"><span class="header-section-number">3</span> R para ciencia de datos</a></li>
<li><a class="" href="cap-etica.html"><span class="header-section-number">4</span> Ética en la ciencia de datos</a></li>
<li class="book-part">Bienvenidos a la jungla de datos</li>
<li><a class="" href="datos-sql.html"><span class="header-section-number">5</span> Gestión de bases de datos relacionales</a></li>
<li><a class="" href="cap-nosql.html"><span class="header-section-number">6</span> Gestión de bases de datos NoSQL</a></li>
<li><a class="" href="DGDQM.html"><span class="header-section-number">7</span> Gobierno, gestión y calidad del dato</a></li>
<li><a class="" href="id_130009.html"><span class="header-section-number">8</span> Integración y limpieza de datos</a></li>
<li><a class="" href="chap-feature.html"><span class="header-section-number">9</span> Selección y transformación de variables</a></li>
<li><a class="" href="chap-herramientas.html"><span class="header-section-number">10</span> Herramientas para el análisis en ciencia de datos</a></li>
<li><a class="" href="id_120006-aed.html"><span class="header-section-number">11</span> Análisis exploratorio de datos</a></li>
<li class="book-part">Fundamentos de estadística</li>
<li><a class="" href="Funda-probab.html"><span class="header-section-number">12</span> Probabilidad</a></li>
<li><a class="" href="Fundainfer.html"><span class="header-section-number">13</span> Inferencia estadística</a></li>
<li><a class="" href="muestreo.html"><span class="header-section-number">14</span> Muestreo y remuestreo</a></li>
<li class="book-part">Modelización estadística</li>
<li><a class="" href="cap-lm.html"><span class="header-section-number">15</span> Modelización lineal</a></li>
<li><a class="" href="cap-glm.html"><span class="header-section-number">16</span> Modelos lineales generalizados</a></li>
<li><a class="" href="cap-gam.html"><span class="header-section-number">17</span> Modelos aditivos generalizados</a></li>
<li><a class="" href="cap-mxm.html"><span class="header-section-number">18</span> Modelos mixtos</a></li>
<li><a class="" href="cap-sparse.html"><span class="header-section-number">19</span> Modelos sparse y métodos penalizados de regresión</a></li>
<li><a class="" href="cap-series-temp.html"><span class="header-section-number">20</span> Modelización de series temporales</a></li>
<li><a class="" href="cap-discriminante.html"><span class="header-section-number">21</span> Análisis discriminante</a></li>
<li><a class="" href="cap-conjunto.html"><span class="header-section-number">22</span> Análisis conjunto</a></li>
<li><a class="" href="tablas-contingencia.html"><span class="header-section-number">23</span> Análisis de tablas de contingencia</a></li>
<li class="book-part">Machine learning supervisado</li>
<li><a class="" href="cap-arboles.html"><span class="header-section-number">24</span> Árboles de clasificación y regresión</a></li>
<li><a class="" href="cap-svm.html"><span class="header-section-number">25</span> Máquinas de vector soporte</a></li>
<li><a class="" href="cap-knn.html"><span class="header-section-number">26</span> Clasificador \(k\)-vecinos más próximos</a></li>
<li><a class="" href="cap-naive-bayes.html"><span class="header-section-number">27</span> Naive Bayes</a></li>
<li><a class="" href="cap-bagg-rf.html"><span class="header-section-number">28</span> Métodos ensamblados: \(\bf \textit {bagging}\) y \(\bf \textit{random}\) \(\bf \textit{forest}\)</a></li>
<li><a class="" href="cap-boosting-xgboost.html"><span class="header-section-number">29</span> \(\bf \textit{Boosting}\) y el algoritmo XGBoost</a></li>
<li class="book-part">Machine learning no supervisado</li>
<li><a class="" href="an%C3%A1lisis-cl%C3%BAster-clusterizaci%C3%B3n-jer%C3%A1rquica.html"><span class="header-section-number">30</span> Análisis clúster: clusterización jerárquica</a></li>
<li><a class="" href="no-jerarquico.html"><span class="header-section-number">31</span> Análisis clúster: clusterización no jerárquica</a></li>
<li><a class="" href="acp.html"><span class="header-section-number">32</span> Análisis de componentes principales</a></li>
<li><a class="" href="an%C3%A1lisis-factorial.html"><span class="header-section-number">33</span> Análisis factorial</a></li>
<li><a class="" href="escalamiento-multidimensional.html"><span class="header-section-number">34</span> Escalamiento multidimensional</a></li>
<li><a class="" href="correspondencias.html"><span class="header-section-number">35</span> Análisis de correspondencias</a></li>
<li class="book-part">Deep learning</li>
<li><a class="" href="capNN.html"><span class="header-section-number">36</span> Redes neuronales artificiales</a></li>
<li><a class="" href="cap-redes-convol.html"><span class="header-section-number">37</span> Redes neuronales convolucionales</a></li>
<li class="book-part">Ciencia de datos de texto y redes</li>
<li><a class="" href="mineria-textos.html"><span class="header-section-number">38</span> Minería de textos</a></li>
<li><a class="" href="grafos.html"><span class="header-section-number">39</span> Análisis de grafos y redes sociales</a></li>
<li class="book-part">Ciencia de datos espaciales</li>
<li><a class="" href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></li>
<li><a class="active" href="geo.html"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="" href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></li>
<li><a class="" href="cap-pp.html"><span class="header-section-number">43</span> Procesos de puntos</a></li>
<li class="book-part">Comunica y colabora</li>
<li><a class="" href="id_120007-informes.html"><span class="header-section-number">44</span> Informes reproducibles con R Markdown y Quarto</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">45</span> Creación de aplicaciones web interactivas con Shiny</a></li>
<li><a class="" href="github.html"><span class="header-section-number">46</span> Git y GitHub R</a></li>
<li><a class="" href="geoproces.html"><span class="header-section-number">47</span> Geoprocesamiento en nube</a></li>
<li class="book-part">Casos de estudio en ciencia de datos</li>
<li><a class="" href="cap-crimen.html"><span class="header-section-number">48</span> Análisis de una red criminal</a></li>
<li><a class="" href="cap-publicidad.html"><span class="header-section-number">49</span> Optimización de inversiones publicitarias</a></li>
<li><a class="" href="cap-twitter.html"><span class="header-section-number">50</span> ¿Cómo tuitea Elon Musk?</a></li>
<li><a class="" href="cap-periodismo.html"><span class="header-section-number">51</span> Análisis electoral: de RStudio a su periódico</a></li>
<li><a class="" href="paro-clm.html"><span class="header-section-number">52</span> El impacto de las crisis financiera y de la COVID-19 en el paro de CLM</a></li>
<li><a class="" href="cap-rfm.html"><span class="header-section-number">53</span> Segmentación de clientes en el comercio minorista</a></li>
<li><a class="" href="cap-medicina.html"><span class="header-section-number">54</span> Análisis de datos en medicina</a></li>
<li><a class="" href="cap-futbol.html"><span class="header-section-number">55</span> Messi y Ronaldo: dos ídolos desde la perspectiva de los datos</a></li>
<li><a class="" href="cambioclimatico.html"><span class="header-section-number">56</span> Una nota sobre el cambio climático</a></li>
<li><a class="" href="cap-sist-exp.html"><span class="header-section-number">57</span> Implementación de un sistema experto en el ámbito pediátrico</a></li>
<li><a class="" href="cap-ree.html"><span class="header-section-number">58</span> Predicción de consumo eléctrico con redes neuronales artificiales</a></li>
<li><a class="" href="nlp-textil.html"><span class="header-section-number">59</span> El procesamiento del lenguaje natural para tendencias de moda en textil</a></li>
<li><a class="" href="cap-fraude.html"><span class="header-section-number">60</span> Detección de fraude de tarjetas de crédito</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="info-session.html"><span class="header-section-number">A</span> Información de la sesión</a></li>
<li><a class="" href="referncias.html">Referncias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="geo" class="section level1" number="41">
<h1>
<span class="header-section-number">Capítulo 41</span> Geoestadística<a class="anchor" aria-label="anchor" href="#geo"><i class="fas fa-link"></i></a>
</h1>
<p><em>Gema Fernández-Avilés<span class="math inline">\(^{a}\)</span> y José-María Montero</em><span class="math inline">\(^{a}\)</span></p>
<p><span class="math inline">\(^{a}\)</span>Universidad de Castilla-La Mancha</p>
<div id="introducción-21" class="section level2" number="41.1">
<h2>
<span class="header-section-number">41.1</span> Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n-21"><i class="fas fa-link"></i></a>
</h2>
<p>El término <strong>geoestadística</strong> apareció por primera vez en <span class="citation">Matheron (<a href="referncias.html#ref-Matheron1962">1962</a>)</span>, y en él “geo” enfatiza la referencia a las Ciencias de la Tierra,
extendiendo el ámbito de la estadística tradicional, cuyo objetivo es el uso de métodos probabilísticos-inferenciales,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Véanse Caps. &lt;a href="Funda-probab.html#Funda-probab"&gt;12&lt;/a&gt; y &lt;a href="Funda-probab.html#Funda-probab"&gt;12&lt;/a&gt;.&lt;/p&gt;'><sup>265</sup></a> con la incorporación del componente geográfico. </p>
<p>La geoestadística estudia los fenómenos regionalizados, que son aquellos que: </p>
<ul>
<li>Se extienden en el espacio, siendo el dominio espacial, <span class="math inline">\(D\)</span>, continuo (se puede observar en cualquiera de sus puntos) y fijo (las ubicaciones observadas, <span class="math inline">\({\bf s}_i, \hspace{0,1cm} i=1,2,..., n\)</span>, no son estocásticas; se seleccionan, por el procedimiento que sea, a juicio del investigador)<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Los datos geoestadísticos son tan solo una parte de los datos espaciales: otra parte de ellos son los datos &lt;em&gt;laticce&lt;/em&gt;, poligonales o regionales, donde &lt;span class="math inline"&gt;\(D\)&lt;/span&gt; es discreto (códigos postales, provincias, regiones, países…) y las ubicaciones observadas no son estocásticas. De su estudio se suele encargar la econometría espacial (véase Cap. &lt;a href="cap-econom-esp.html#cap-econom-esp"&gt;42&lt;/a&gt;). También hay otro tipo de datos espaciales que surgen en dominios que pueden ser continuos o discretos, pero donde la selección de las ubicaciones observadas no depende del investigador (en este sentido &lt;span class="math inline"&gt;\(D\)&lt;/span&gt; es aleatorio). Se trata de los denominados procesos de puntos (véase Cap. &lt;a href="cap-pp.html#cap-pp"&gt;43&lt;/a&gt;).&lt;/p&gt;'><sup>266</sup></a>.</li>
</ul>
<ul>
<li>Presentan una organización o estructura debida a la dependencia espacial existente. </li>
</ul>
<p>El objetivo fundamental de la geoestadística es sacar provecho de la <strong>dependencia espacial</strong> existente para llevar a cabo predicciones (interpolaciones) óptimas en ubicaciones o áreas de interés (en este sentido se habla de predicciones puntuales o por bloques, respectivamente), o la realización de <em>mappings</em> sobre todo el dominio o parte de él. Al ser <span class="math inline">\(D\)</span> continuo, no se puede hacer una representación exhaustiva del fenómeno, pero sí se puede reconstruir a partir de las observaciones disponibles. </p>
<p>Las consecuencias de utilizar la estadística clásica, que no considera la dependencia espacial, cuando la hay, son muy graves y pueden verse en <span class="citation">J. M. Montero, Fernández-Avilés, and Mateu (<a href="referncias.html#ref-montero2015spatial">2015</a>)</span>.</p>
<p>El ámbito de aplicación de la geoestadística es enorme: minería, industria petrolífera, geología, meteorología, control de la calidad del aire, ecología, epidemiología, salud pública, criminología, economía, etc. Así, por ejemplo, en el ámbito del control de la calidad del aire en las grandes urbes, la concentración de ozono en aire se mide en una serie de estaciones de seguimiento, y a partir de dichas mediciones se reproduce el comportamiento del proceso sobre toda la urbe.</p>
<p>En conclusión, las dos partes del análisis geoestadístico son: el <strong>análisis estructural de la dependencia espacial</strong> y la <strong>predicción</strong> (que se suele acompañar del calificativo “<strong>krigeada</strong>”). Pero antes de estudiarlas, detengámonos en algunos preliminares.</p>
<p>
</p>
</div>
<div id="preliminares-geo" class="section level2" number="41.2">
<h2>
<span class="header-section-number">41.2</span> Preliminares<a class="anchor" aria-label="anchor" href="#preliminares-geo"><i class="fas fa-link"></i></a>
</h2>
<p>Dado que los procedimientos geoestadísticos no pueden ser aplicados directamente sobre los fenómenos regionalizados como tales, porque son realidades físicas, se necesita una descripción matemática de los mismos a la que puedan ser aplicados: la <strong>variable regionalizada</strong> (<em>v.r.</em>) o <strong>regionalización</strong>, definida en un espacio geográfico, y que se supone que mide y representa correctamente dicho fenómeno.</p>
<p>
</p>
<p>Formalmente, cuando <span class="math inline">\(\mathbf{s}\)</span> recorre <span class="math inline">\(D\)</span>, el conjunto <span class="math inline">\(z(\mathbf{s}), \mathbf{s}\in D,\)</span> se denomina <em>v.r.</em>, siendo <span class="math inline">\(z(\mathbf{s_i}), i=1,2,3,...\)</span> una colección de valores regionalizados. </p>
<p>Desde la perspectiva probabilística, cada uno de los valores que toma <em>v.r.</em> puede interpretarse como el resultado de un mecanismo aleatorio, la variable aleatoria, <em>v.a.</em> (véase Sec. <a href="#prob-va"><strong>??</strong></a>). Si se tomasen valores regionalizados en todos los puntos del dominio, <span class="math inline">\(D\)</span>, es decir, si se considerase <em>v.r.</em>, esta podría ser vista como un conjunto infinitamente grande de <em>v.a.</em>, una en cada punto de <span class="math inline">\(D\)</span>, que se conoce como <strong>función aleatoria</strong> (<em>f.a.</em>), <strong>proceso estocástico</strong> o <strong>campo aleatorio</strong> espacial, <span class="math inline">\(Z(\mathbf{s}), \mathbf{s}\in D\)</span>, donde <span class="math inline">\(Z\)</span> representa el fenómeno de interés. Pues bien, <em>v.r.</em> se interpreta como una realización de una <em>f.a.</em> espacial, y esta es una decisión metodológica clave en geoestadística.</p>
<p>
</p>
<p>Es importante tener en cuenta que <em>v.r.</em> <span class="math inline">\((i)\)</span> es, a menudo, muy irregular a escala local, lo que impide su representación mediante una función determinista; y <span class="math inline">\((ii)\)</span> muestra cierta organización o estructura espacial. La interpretación de <em>v.r.</em> como una realización de una <em>f.a.</em> espacial permite considerar estos dos aspectos:</p>
<ul>
<li><p>En cada localización <span class="math inline">\(\mathbf{s}\)</span>, <span class="math inline">\(Z(\mathbf{s})\)</span> es una <em>v.a.</em> (de ahí el aspecto errático).</p></li>
<li><p>Para un conjunto de puntos dado, <span class="math inline">\({\mathbf{s}_1},{\mathbf{s}_2}, ..., {\mathbf{s}_k}\)</span>, las <em>v.a.</em> <span class="math inline">\(Z({\mathbf{s}_1}), Z({\mathbf{s}_2}), ..., Z({\mathbf{s}_k})\)</span> están ligadas por una red de correlaciones espaciales que son las responsables de la similitud en los valores que toman (de ahí el aspecto estructurado).</p></li>
</ul>
<p>Las <em>f.a.</em> <span class="math inline">\(Z(\mathbf{s})\)</span> pueden ser estacionarias (en sentido estricto o de segundo orden), intrínsecamente estacionarias o no estacionarias, y el hecho de que tengan uno u otro tipo de estacionariedad determina el análisis geoestadístico.</p>
<p>Una <em>f.a.</em> espacial es <strong>estrictamente estacionaria</strong> si las familias de <em>v.a.</em> <span class="math inline">\(Z(\mathbf{s}_1),Z(\mathbf{s}_2),...,Z(\mathbf{s}_k)\)</span>, tienen la misma distribución de probabilidad conjunta que <span class="math inline">\(Z(\mathbf{s}_1+\mathbf{h}),Z(\mathbf{s}_2+\mathbf{h}),...,Z(\mathbf{s}_k+\mathbf{h})\)</span>, <span class="math inline">\(\forall k\)</span>, <span class="math inline">\(\forall \mathbf{s}_1, \mathbf{s}_2,...,\mathbf{s}_k\)</span> y <span class="math inline">\(\forall \mathbf{h} \in \mathbb{R}^d\)</span> (donde <span class="math inline">\(\mathbf{h}\)</span> es un vector de traslación), siempre que <span class="math inline">\(\mathbf{s}_1+\mathbf{h}, \mathbf{s}_2+\mathbf{h},...,\mathbf{s}_k+\mathbf{h}\in D\)</span>.
Es decir, la distribución de probabilidad conjunta de <span class="math inline">\(Z(\mathbf{s}_1+\mathbf{h}),Z(\mathbf{s}_2+\mathbf{h}),...,Z(\mathbf{s}_k+\mathbf{h})\)</span> no se ve afectada por una traslación <span class="math inline">\(\mathbf{h}\)</span>, y por tanto, ni ella ni las funciones de densidad de dimensión inferior a <span class="math inline">\(k\)</span> dependen de las localizaciones consideradas.</p>
<p>La estacionariedad estricta es una condición muy restrictiva. Por ello, en la práctica lo que se suele asumir es la <strong>estacionariedad de segundo orden</strong>, que limita la estacionariedad a los dos primeros momentos de la <em>f.a.</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;En &lt;strong&gt;geoestadística lineal&lt;/strong&gt; el interés se centra en los dos primeros momentos de la &lt;em&gt;f.a.&lt;/em&gt;, por lo cual tan solo es necesaria la estacionariedad de segundo orden. Es decir, la esperanza y la varianza existen, son constantes y no dependen de la localización &lt;span class="math inline"&gt;\(\mathbf{s}\)&lt;/span&gt;. La covarianza existe para cada par de &lt;em&gt;v.a.&lt;/em&gt; &lt;span class="math inline"&gt;\(Z(\mathbf{s})\)&lt;/span&gt; y &lt;span class="math inline"&gt;\(Z(\mathbf{s}+\mathbf{h})\)&lt;/span&gt; y solo depende de &lt;span class="math inline"&gt;\(\mathbf{h}\)&lt;/span&gt;.&lt;/p&gt;'><sup>267</sup></a>
</p>
<p>Si una <em>f.a.</em> es estrictamente estacionaria, también es estacionaria de segundo orden. Sin embargo, la relación inversa no tiene por qué ser cierta.</p>
<p>La estacionariedad de segundo orden implica la existencia de la varianza de la <em>f.a.</em> y, por tanto, deja fuera los fenómenos con infinita capacidad de variación. En este caso, si las diferencias <span class="math inline">\(Z(\mathbf{s}+\mathbf{h})-Z(\mathbf{s})\)</span> son estacionarias de segundo orden, se dice que la <em>f.a.</em> es <strong>intrínsecamente estacionaria</strong>.</p>
<p>Aquellas <em>f.a.</em> cuya esperanza y/o varianza dependan de la localización (no son invariantes a las traslaciones) se denominan <strong>no estacionarias</strong>.</p>
<p>Salvo indicación de lo contrario, se asumirá la estacionariedad de segundo orden.</p>
<p>Finalmente, unos breves comentarios sobre la importancia de la estacionariedad. Es imposible inferir la ley de probabilidad que gobierna la <em>f.a.</em> espacial a partir de una sola realización de la misma (una sola regionalización), pues sería como tener una muestra de tamaño 1. Pero en la práctica ese será el caso. Bueno, ni siquiera eso. Solo se dispondrá de una parte de la regionalización: la correspondiente a las localizaciones observadas. La solución a tan importante limitación es adoptar la hipótesis de estacionariedad u homogeneidad espacial. Es decir, sustituir la repetición de realizaciones de la <em>f.a.</em> espacial por repeticiones en el espacio; dicho de otra forma, suponer que los valores observados en distintas localizaciones de <span class="math inline">\(D\)</span> tienen las mismas características estadísticas y pueden ser considerados, en términos estadísticos, como realizaciones de la misma <em>f.a.</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Estas realizaciones no son independientes, y se suele asumir también la hipótesis de &lt;strong&gt;ergodicidad&lt;/strong&gt; (véase Sec. &lt;a href="cap-series-temp.html#conceptos"&gt;20.1&lt;/a&gt;). &lt;/p&gt;'><sup>268</sup></a> Por tanto, la hipótesis de estacionariedad significa que la ley espacial que gobierna <em>f.a.</em>, o parte de ella, es invariante a traslaciones; no depende de las localizaciones específicas observadas sino solo de <span class="math inline">\(\mathbf{h}\)</span>.</p>
<p>La hipótesis de estacionariedad permitirá actuar como si todas las <em>v.a.</em> que conforman la <em>f.a.</em> tuviesen la misma distribución de probabilidad (o los mismos momentos), haciendo posible el proceso inferencial. Por eso se le da tanta importancia a que la <em>f.a.</em> sea estacionaria, del tipo que sea.</p>
</div>
<div id="ana-estructural" class="section level2" number="41.3">
<h2>
<span class="header-section-number">41.3</span> Análisis estructural de la dependencia espacial<a class="anchor" aria-label="anchor" href="#ana-estructural"><i class="fas fa-link"></i></a>
</h2>
<div id="semivariograma" class="section level3" number="41.3.1">
<h3>
<span class="header-section-number">41.3.1</span> Semivariograma<a class="anchor" aria-label="anchor" href="#semivariograma"><i class="fas fa-link"></i></a>
</h3>
<p></p>
<p>La <strong>estadística espacial</strong> se basa en la suposición de que las unidades georreferenciadas cercanas están relacionadas (son dependientes) de alguna manera <span class="citation">(<a href="referncias.html#ref-getis1999">Getis 1999a</a>)</span>, y tanto más cuanto más cercanas estén <span class="citation">(<a href="referncias.html#ref-tobler1970computer">Tobler 1970</a>)</span>.</p>
<p>Los procesos con dependencia espacial se reconocen, visualmente, porque muestran un patrón en el espacio; en los que no la tienen, el patrón es el de la aleatoriedad. La Fig. <a href="geo.html#fig:plot-dep-iid-ch41">41.1</a> muestra una simulación de una <em>f.a.</em> con dependencia espacial (panel izquierdo) frente a unos datos totalmente aleatorios (panel derecho).</p>
<div class="sourceCode" id="cb618"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.leg.ufpr.br/geoR/">"geoR"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/dnychka/fieldsRPackage">"fields"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">728</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_dep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoR/man/grf.html">grf</a></span><span class="op">(</span><span class="fl">401</span>, grid <span class="op">=</span> <span class="st">"reg"</span>, cov.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span><span class="op">)</span>, messages <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/geoR/man/points.geodata.html">points.geodata</a></span><span class="op">(</span><span class="va">sim_dep</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Dependencia espacial"</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/tim.colors.html">tim.colors</a></span><span class="op">(</span><span class="op">)</span>, cex.max <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_indep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoR/man/grf.html">grf</a></span><span class="op">(</span><span class="fl">401</span>, grid <span class="op">=</span> <span class="st">"reg"</span>, cov.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0</span><span class="op">)</span>, messages <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/geoR/man/points.geodata.html">points.geodata</a></span><span class="op">(</span><span class="va">sim_indep</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Aleatoriedad"</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/tim.colors.html">tim.colors</a></span><span class="op">(</span><span class="op">)</span>, cex.max <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-dep-iid-ch41"></span>
<img src="img/dep-aleatoriedad.png" alt="Dependencia espacial frente a aleatoriedad." width="60%"><p class="caption">
Figura 41.1: Dependencia espacial frente a aleatoriedad.
</p>
</div>
<p>Pasando del terreno de las simulaciones a la realidad, la Fig. <a href="geo.html#fig:plot-temp-max-ch41">41.2</a> muestra la temperatura máxima en España el 6 de agosto de 2022,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Los datos ya procesados para el análisis se encuentran en &lt;code&gt;CDR::tempmax_data&lt;/code&gt;. Una descripción puede verse con &lt;code&gt;summary(CDR::tempmax_data)&lt;/code&gt;. Estos datos han sido descargados con la librería &lt;code&gt;climaemet&lt;/code&gt; y &lt;code&gt;mapSpain&lt;/code&gt;. Un desarrollo completo de manipulación de datos espaciales puede verse en &lt;span class="citation"&gt;Pizarro, Hernangómez, and Fernández-Avilés (&lt;a href="referncias.html#ref-R-climaemet"&gt;2021&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>269</sup></a> en plena ola de calor (este es el ejemplo real que se utilizará a lo largo del capítulo). En ella puede observarse claramente una estructura de dependencia espacial, con máximas cercanas a 40 grados en la meseta central y Extremadura, de 30 grados o menos en la cordillera Cantábrica y las costas atlántica, cantábrica y andaluza, y entre 30 y 35 grados en el resto del país (básicamente Murcia, Comunidad Valenciana y Cataluña).</p>
<div class="sourceCode" id="cb619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"CDR"</span><span class="op">)</span></span>
<span><span class="co">#summary(CDR::tempmax_data)</span></span></code></pre></div>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="va">br_paper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">17.5</span>, <span class="fl">45</span>, <span class="fl">2.5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">pal_paper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"YlOrRd"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ESP_utm</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_max_utm_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="co"># temp_max_utm</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">pal_paper</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-temp-max-ch41"></span>
<img src="img/tem-max-spain.png" alt="Temperatura máxima en España peninsular, 6 de agosto de 2022." width="60%"><p class="caption">
Figura 41.2: Temperatura máxima en España peninsular, 6 de agosto de 2022.
</p>
</div>
<p>Ahora bien, para poder llevar a cabo predicciones geoestadísticas es necesario representar previamente los patrones de dependencia espacial observados mediante funciones que indiquen cuál es la estructura de dicha dependencia espacial. Dichas funciones son los <strong>semivariogramas</strong>. Dado que la identificación de la estructura de la dependencia espacial existente en el fenómeno de interés es la clave del éxito del proceso predictivo, al semivariograma se le considera la piedra angular de la predicción geoestadística <span class="citation">(<a href="referncias.html#ref-montero2015spatial">J. M. Montero, Fernández-Avilés, and Mateu 2015</a>)</span>. </p>
<p>Un semivariograma se define como la semivarianza de los incrementos de la <em>f.a.</em>: <span class="math display">\[\begin{equation} (\#eq:vario)
\gamma(\mathbf{s}_i - \mathbf{s}_j) = \frac{1}{2} V[Z(\mathbf{s}_i)-Z(\mathbf{s}_j)] , \hspace{0,2cm} \forall \mathbf{s}_i, \mathbf{s}_j\in D.
\end{equation}\]</span>
que, en el caso habitual de <em>f.a.</em> estacionarias de segundo orden o intrínsecamente estacionarias (sin deriva), se transforma en:
<span class="math display">\[\begin{equation}
\gamma (\mathbf{h}) = \frac{1}{2} V \left( Z(\mathbf{s} + \mathbf{h}) - Z(\mathbf{s}) \right) =\frac{1}{2}E\left( {\left( {Z(\mathbf{s} + \mathbf{h}) - Z(\mathbf{s})} \right)^2} \right).
\end{equation}\]</span></p>
<p>Nótese que:</p>
<ul>
<li>Si hay dependencia espacial (positiva,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Valores cercanos similares. Si es negativa, los valores vecinos son diferentes.&lt;/p&gt;"><sup>270</sup></a> es lo normal), la diferencia entre los valores de la <em>f.a.</em> en los puntos separados por una pequeña distancia será poca y más o menos la misma. Es decir, dichas diferencias serán poco variables y el valor del semivariograma a pequeñas distancias será pequeño.</li>
</ul>
<ul>
<li><p>Si aumenta la distancia, la dependencia espacial se reduce y la diferencia entre los valores de la <em>f.a</em> en los puntos separados por distancias intermedias y grandes no será tan parecida como en el caso anterior, sino mayor, y variará más. Es decir, el valor del semivariograma aumenta con la distancia.</p></li>
<li><p>Si la distancia aumenta lo suficiente como para que ya no haya dependencia espacial, las diferencias entre los valores de la <em>f.a.</em> separados por tal distancia alcanzarán la variabilidad de la <em>f.a</em> en estudio, y si esta es estacionaria de segundo orden, el semivariograma se estabilizará en torno a ella.</p></li>
</ul>
<p>En el caso estacionario, las <strong>funciones de covarianza</strong>, <span class="math inline">\(C(\bf h)\)</span>, también pueden ser utilizadas para representar la estructura de la dependencia espacial, si bien se prefiere el semivariograma porque no requiere el conocimiento de la media de la <em>f.a.</em> en estudio. Además, el semivariograma cubre un espectro más amplio de fenómenos regionalizados que la función de covarianza, ya que esta no puede definirse en el caso de estacionariedad intrínseca. Los detalles pueden verse en <span class="citation">J. M. Montero, Fernández-Avilés, and Mateu (<a href="referncias.html#ref-montero2015spatial">2015</a>)</span> y <span class="citation">J. M. Montero and Larraz (<a href="referncias.html#ref-montero_larraz2008">2008</a>)</span>.
</p>
<p>Cuando el semivariograma depende tanto de la dirección como de la longitud del vector <span class="math inline">\(\mathbf{h}\)</span> que une las localizaciones <span class="math inline">\(\mathbf{s}\)</span> y <span class="math inline">\(\mathbf{s}+ \mathbf{h}\)</span>, se denomina <strong>anisotrópico</strong>. Cuando solo depende de la distancia (<span class="math inline">\(\lvert \mathbf{h} \rvert=|| \mathbf{h} ||\)</span>, porque en el espacio euclídeo el módulo y la norma coinciden) se denomina <strong>isotrópico</strong>.
</p>
<p>Un semivariograma no puede ser cualquier función. Tiene que ser nulo en el origen, no negativo, verificar que <span class="math inline">\(\gamma(\mathbf{h})=\gamma(-\mathbf{h})\)</span>, debe ser una función condicionalmente definida negativa y tener un ritmo de crecimiento inferior a <span class="math inline">\(|\mathbf h|^2\)</span>, es decir, <span class="math inline">\(lim_{|\mathbf h|\to\infty} \frac {\gamma(\mathbf{h})}{|\mathbf h|^2}=0\)</span> cuando el proceso es no estacionario (sin deriva), siendo finito en caso de procesos estacionarios de segundo orden.</p>
<p>El análisis del comportamiento de un semivariograma a pequeñas, medias y grandes distancias es de sumo interés, como se verá a continuación.</p>
<p>En general, a distancias medias y grandes, los semivariogramas asociados a <em>f.a.</em> estacionarias de segundo orden crecen, monótonamente, desde el origen con la distancia hasta alcanzar un valor límite, la <strong>varianza</strong> <strong><em>a priori</em></strong> de la <em>f.a.</em> (o covarianza para <span class="math inline">\(\mathbf {h}=0\)</span>, <span class="math inline">\(C(\mathbf{0})\)</span>), bien de forma exacta o asintóticamente. Dicho valor límite se denomina <strong>meseta</strong>, <span class="math inline">\(m\)</span>, y la distancia a la cual se alcanza se conoce como <strong>alcance</strong> o <strong>rango</strong>, <span class="math inline">\(a\)</span>. Por tanto, el rango es la distancia a partir de la cual ya no hay dependencia espacial. Cuando <span class="math inline">\(m\)</span> se alcanza asintóticamente, el alcance no queda perfectamente definido y se toma como alcance la distancia a la cual el semivariograma toma el valor <span class="math inline">\(0,95 m\)</span>, denominada <strong>alcance efectivo</strong> a efectos prácticos.</p>
<p>
</p>
<p>En el caso no estacionario (por ejemplo, si hay deriva) o intrínsecamente estacionario el semivariograma no tiene meseta.</p>
<p>El comportamiento a pequeñas distancias, sobre todo cerca del origen, que es donde más dependencia espacial hay, está muy relacionado con el grado de continuidad y regularidad de <em>f.a.</em> Cuanto más continua y regular sea, más suaves y estructuradas serán las realizaciones que produzca, y más regular será el comportamiento del semivariograma cerca del origen (Fig. <a href="geo.html#fig:gauss-sph-plot">41.3</a>, panel izquierdo; representación bidimensional).</p>
<p>Los semivariogramas con un <strong>comportamiento lineal cerca del origen</strong> son típicos de <em>v.r.</em> continuas, al menos por partes, pero no diferenciables. Su representación gráfica tridimensional está llena de picos. La amplitud de las fluctuaciones aumenta con la distancia entre localizaciones y es proporcional a la pendiente de la tangente en el origen (Fig. <a href="geo.html#fig:gauss-sph-plot">41.3</a>, panel derecho; representación bidimensional).</p>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fa_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoR/man/grf.html">grf</a></span><span class="op">(</span><span class="fl">1225</span>, grid <span class="op">=</span> <span class="st">"reg"</span>, cov.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.25</span><span class="op">)</span>, cov.model <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/image.html">image</a></span><span class="op">(</span><span class="va">fa_gauss</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/tim.colors.html">tim.colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fa_sph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoR/man/grf.html">grf</a></span><span class="op">(</span><span class="fl">1225</span>, grid <span class="op">=</span> <span class="st">"reg"</span>, cov.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.25</span><span class="op">)</span>, cov.model <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/image.html">image</a></span><span class="op">(</span><span class="va">fa_sph</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/tim.colors.html">tim.colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:gauss-sph-plot"></span>
<img src="img/gauss-sph.png" alt="Representacion bidimensional de dos $f.a.$: con semivariograma parabólico en el origen (izquierda); con semivariograma lineal en el origen (derecha)." width="60%"><p class="caption">
Figura 41.3: Representacion bidimensional de dos <span class="math inline">\(f.a.\)</span>: con semivariograma parabólico en el origen (izquierda); con semivariograma lineal en el origen (derecha).
</p>
</div>
<p>Las <em>v.r.</em> regulares (aquellas cuya gráfica tridimensional no tiene picos) se identifican con un <strong>comportamiento semivariográfico parabólico en el origen</strong>. Si dicho comportamiento persiste a largas distancias, puede que exista una fuerte deriva.</p>
<p>Las discontinuidades en el origen (que teóricamente no pueden darse) son frecuentes en la práctica. Su amplitud se denomina <strong>efecto pepita</strong>
(<em>nugget effect</em>) y son típicas de variables regionalizadas muy irregulares y, quizás, discontinuas. Las causas más frecuentes del efecto pepita son la existencia de una estructura con alcance inferior a la distancia más corta entre localizaciones y los errores de posicionamiento o de medida <span class="citation">(véase <a href="referncias.html#ref-chiles1999">Chilès and Delfiner 1999</a> para más detalle)</span>. </p>
<p>El caso límite del efecto pepita es el <strong>efecto pepita puro</strong>. En ese caso, el semivariograma es constante cualquiera que sea la distancia, indicando ausencia de dependencia espacial.</p>
<p>La Fig. <a href="geo.html#fig:plot-partes-sem">41.4</a> muestra gráficamente los principales elementos de un semivariograma.</p>
<div class="sourceCode" id="cb622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># función para representar el semivariograma</span></span>
<span><span class="va">semivar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoR/man/cov.spatial.html">cov.spatial</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="fu">semivar</span><span class="op">(</span><span class="va">x</span>, cov.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.4</span><span class="op">)</span>, cov.model <span class="op">=</span> <span class="st">"sph"</span><span class="op">)</span>, <span class="fl">0.0</span>, <span class="fl">1</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Distancia"</span>,  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">gamma</a></span><span class="op">(</span><span class="st">"|h|"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"4"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0.4</span>, col <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># alcance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># meseta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="st">"Efecto pepita"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.95</span>, <span class="st">"Meseta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="st">"Alcance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="st">"Ausencia de dependencia"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-partes-sem"></span>
<img src="img/semivar-parts.png" alt="Elementos del semivariograma (meseta unitaria)." width="60%"><p class="caption">
Figura 41.4: Elementos del semivariograma (meseta unitaria).
</p>
</div>
<p> </p>
</div>
<div id="modelos-de-semivariogramas-válidos" class="section level3" number="41.3.2">
<h3>
<span class="header-section-number">41.3.2</span> Modelos de semivariogramas válidos<a class="anchor" aria-label="anchor" href="#modelos-de-semivariogramas-v%C3%A1lidos"><i class="fas fa-link"></i></a>
</h3>
<p></p>
<p>Las funciones que verifican las condiciones que debe cumplir un semivariograma (véase Sec. <a href="geo.html#semivariograma">41.3.1</a>) se conocen como <strong>semivariogramas válidos</strong>. El incumplimiento de alguna de ellas tiene perversas consecuencias en el proceso predictivo (por ejemplo, varianzas de los errores de predicción negativas). Su tipología, siguiendo el enfoque sugerido en <span class="citation">Journel and Huijbregts (<a href="referncias.html#ref-journel1978">1978</a>)</span> y <span class="citation">J. M. Montero, Fernández-Avilés, and Mateu (<a href="referncias.html#ref-montero2015spatial">2015</a>)</span>, es la siguiente:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Aquí se presentan los semivariogramas isotrópicos más utilizados en la práctica. Nos centramos en ellos porque las anisotropías (y por tanto los semivariogramas anisotrópicos) pueden ser representadas reduciéndolas al caso isotrópico sin más que llevar a cabo una transformación lineal de las coordenadas, o representando separadamente cada variabilidad direccional, dependiendo del tipo de anisotropía (geométrica o zonal). Para un análisis detallado, consúltese, por ejemplo, &lt;span class="citation"&gt;J. M. Montero, Fernández-Avilés, and Mateu (&lt;a href="referncias.html#ref-montero2015spatial"&gt;2015&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>271</sup></a></p>
<p></p>
<div id="semivariogramas-con-meseta" class="section level4" number="41.3.2.1">
<h4>
<span class="header-section-number">41.3.2.1</span> Semivariogramas con meseta <a class="anchor" aria-label="anchor" href="#semivariogramas-con-meseta"><i class="fas fa-link"></i></a>
</h4>
<p></p>
<p>Están asociados a <em>f.a.</em> estacionarias de segundo orden. Los más utilizados son:</p>
<ul>
<li>
<strong>Esférico.</strong> Válido en <span class="math inline">\(\mathbb{R}^1\)</span>, <span class="math inline">\(\mathbb{R}^2\)</span> y
<span class="math inline">\(\mathbb{R}^3\)</span>, y viene dado por:
<span class="math display">\[\begin{equation}
\gamma(|\mathbf{h}|)= \left\{
\begin{array}{ll}
m \left( 1.5\frac{|\mathbf{h}|}{a}-0.5\left(\frac{|\mathbf{h}|}{a}\right)^{3} \right) &amp; \mbox{si $|\mathbf{h}|\leq a$} \\
m &amp; \mbox{si $|\mathbf{h}| &gt; a.$}
\end{array}
\right.
\end{equation}\]</span>
</li>
</ul>
<p>Tiene un comportamiento lineal cerca del origen, indicando continuidad y cierto grado de irregularidad en la <em>f.a.</em> A grandes distancias alcanza la meseta cuando <span class="math inline">\(|\mathbf{h}|=a\)</span>. Estas dos características son propias de muchas regionalizaciones observadas en la realidad; de ahí su popularidad.</p>
<ul>
<li>
<strong>Exponencial. </strong> Válido en <span class="math inline">\(\mathbb{R}^d, d\geq1\)</span>, y viene dado por:
<span class="math display">\[\begin{equation}
\gamma (|\mathbf{h}|)= m \left( 1-\exp \left( -\frac{|\mathbf{h}|}{a}
\right) \right).
\end{equation}\]</span>
</li>
</ul>
<p>Igual que el esférico, cerca del origen exhibe un comportamiento lineal, siendo menor la pendiente. A diferencia de él, solo alcanza la meseta asintóticamente. A efectos prácticos, se toma como alcance la distancia para la cual el semivariograma alcanza el valor del 95% de la meseta, <span class="math inline">\(a^\prime \approx 3a\)</span>.</p>
<ul>
<li>
<strong>Gaussiano.</strong> Válido en <span class="math inline">\(\mathbb{R}^d, d \geq1\)</span>. Está definido por:
<span class="math display">\[\begin{equation}   
\gamma (|\mathbf{h}|)=m\left( 1-\exp \left(-\frac{|\mathbf{h}|^{2}}{a^{2}}\right) \right).
\end{equation}\]</span>
</li>
</ul>
<p>A diferencia del esférico y el exponencial, tiene un comportamiento parabólico cerca del origen. Por consiguiente, está asociado con <em>f.a.</em> estacionarias de segundo orden infinitamente diferenciables y, en consecuencia, muy regulares. Igual que el modelo exponencial, alcanza la meseta solo asintóticamente, con <span class="math inline">\(a^\prime \approx a \sqrt 3\)</span>.</p>
<ul>
<li>
<strong>Efecto pepita puro.</strong> Refleja la ausencia de dependencia espacial:</li>
</ul>
<p><span class="math display">\[\begin{equation}
\gamma(|\mathbf{h}|) = \left\{ {\begin{array}{l}
m\;\;\mbox{si}\;|\mathbf{h}| = 0 \\
0\;\;\mbox{ si}\;|\mathbf{h}| &gt; 0 \\
\end{array}}, \right.\; \;\;\; m&gt; 0.
\end{equation}\]</span></p>
<ul>
<li>
<strong>K-Bessel</strong>. Válido en <span class="math inline">\(\mathbb{R}^d, d\geq1\)</span>. Su expresión es:
<span class="math display">\[\begin{equation}
\gamma(|\mathbf{h}|)=m \left(1- \frac{1}{2^{\alpha-1} \Gamma(\alpha)}
\left(\frac{|\mathbf{h}|}{a} \right)^\alpha K_\alpha \left(\frac{|\mathbf{h}|}{a} \right) \right), \quad \alpha &gt;0,
\end{equation}\]</span>
</li>
</ul>
<p>donde <span class="math inline">\(K_\alpha\)</span> es la función de segunda especie de orden <span class="math inline">\(\alpha\)</span>. Este modelo puede representar cualquier tipo de comportamiento cerca del origen. Por ejemplo, para <span class="math inline">\(\alpha=0,5\)</span> se obtiene el modelo exponencial.</p>
</div>
<div id="semivariogramas-con-meseta-y-efecto-hoyo" class="section level4" number="41.3.2.2">
<h4>
<span class="header-section-number">41.3.2.2</span> Semivariogramas con meseta y efecto hoyo <a class="anchor" aria-label="anchor" href="#semivariogramas-con-meseta-y-efecto-hoyo"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<strong>J-Bessel</strong>. Un semivariograma no tiene por qué ser necesariamente una función monótona no decreciente, sino que puede tener “ondas” (efecto hoyo). Tal es el caso del modelo J-Bessel, que puede ser utilizado en presencia de dependencia espacial negativa o, específicamente, en caso de alternancia entre dependencia positiva y negativa. Válido en <span class="math inline">\(\mathbb{R}^d\)</span>, <span class="math inline">\(d\leq 2(\alpha +1)\)</span>, su expresión viene dada por:
<span class="math display">\[\begin{equation}
\gamma(|\mathbf{h}|)=m \left(1- \left(\frac{2a}{|\mathbf{h}|}\right)^{\alpha} \Gamma(\alpha + 1)
J_\alpha \left(\frac{|\mathbf{h}|}{a} \right) \right),
\end{equation}\]</span>
</li>
</ul>
<p>donde <span class="math inline">\(\alpha\)</span> es un parámetro de forma, <span class="math inline">\(a\)</span> es un parámetro de escala, <span class="math inline">\(\Gamma\)</span> es la función de Euler que interpola el factorial y <span class="math inline">\(J_{\alpha}\)</span> es la función J-Bessel de primera especie de orden <span class="math inline">\(\alpha\)</span>.</p>
<!-- El semivariogrmama J-Bessel is the particularization of the J-Bessel -->
<!-- model for $\alpha =1/2$ and is one of the few hole-effect models valid -->
<!-- \index{Valid semivariogram} on $\mathbb{R}^3$ -->
<p>La Fig. <a href="geo.html#fig:semivar-teo-sill-ch41">41.5</a> muestra una representación gráfica de los anteriores semivariogramas.</p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-spatial/gstat/">"gstat"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/show.vgms.html">show.vgms</a></span><span class="op">(</span>models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sph"</span>, <span class="st">"Exp"</span>, <span class="st">"Gau"</span>, <span class="st">"Nug"</span>, <span class="st">"Bes"</span>, <span class="st">"Wav"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:semivar-teo-sill-ch41"></span>
<img src="190041_geoestadistica_files/figure-html/semivar-teo-sill-ch41-1.png" alt="Representación de semivariogramas con meseta válidos  (meseta y alcance efectivo unitarios; a excepción del efecto pepita puro)." width="60%"><p class="caption">
Figura 41.5: Representación de semivariogramas con meseta válidos (meseta y alcance efectivo unitarios; a excepción del efecto pepita puro).
</p>
</div>
</div>
<div id="semivariogramas-sin-meseta" class="section level4" number="41.3.2.3">
<h4>
<span class="header-section-number">41.3.2.3</span> Semivariogramas sin meseta <a class="anchor" aria-label="anchor" href="#semivariogramas-sin-meseta"><i class="fas fa-link"></i></a>
</h4>
<p>Estos modelos van más allá de la hipótesis estacionaria de segundo
orden y corresponden a <em>f.a.</em> con una
capacidad ilimitada de dispersión espacial, es decir, a <em>f.a.</em> intrínsecamente estacionarias, pero no estacionarias de segundo orden. Los más populares son:</p>
<ul>
<li><p><strong>Potencial</strong>. Válido en <span class="math inline">\(\mathbb{R}^d, d\geq1\)</span>, y definido por:
<span class="math display">\[\begin{equation}
\gamma (|\mathbf{h}|)=  (|\mathbf{h}|)^{\alpha }, \quad \mbox  {con } 0&lt;\alpha &lt;2.
\end{equation}\]</span>
</p></li>
<li><p><strong>Logarítmico</strong>. Válido en <span class="math inline">\(\mathbb{R}^d, d\geq1\)</span>, y con expresión:
<span class="math display">\[\begin{equation}
\gamma (|\mathbf{h}|) = b\log |\mathbf{h}|\; \;\mbox{si}\ |\mathbf{h}| \ge 0,
\end{equation}\]</span></p></li>
</ul>
<p>donde <span class="math inline">\(b\)</span> es una constante.</p>
<p></p>
<p>Una representación gráfica de ambos semivariogramas puede verse en la Fig. <a href="geo.html#fig:semivar-teo-no-sill-ch41">41.6</a>.</p>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/show.vgms.html">show.vgms</a></span><span class="op">(</span>models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pow"</span>, <span class="st">"Log"</span><span class="op">)</span>, sill <span class="op">=</span> <span class="fl">1</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, nugget <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:semivar-teo-no-sill-ch41"></span>
<img src="190041_geoestadistica_files/figure-html/semivar-teo-no-sill-ch41-1.png" alt="Representación de semivariogramas sin meseta válidos." width="60%"><p class="caption">
Figura 41.6: Representación de semivariogramas sin meseta válidos.
</p>
</div>
</div>
</div>
<div id="semivariograma-empírico" class="section level3" number="41.3.3">
<h3>
<span class="header-section-number">41.3.3</span> Semivariograma empírico<a class="anchor" aria-label="anchor" href="#semivariograma-emp%C3%ADrico"><i class="fas fa-link"></i></a>
</h3>
<p>Dado que la única información de la que se dispone es una realización observada de la <em>f.a</em> objeto de estudio, en la práctica la estructura de la dependencia espacial se estima mediante el semivariograma empírico.</p>
<p>En el marco de la estacionariedad intrínseca (que incluye la estacionariedead estricta y de segundo orden) y en <span class="math inline">\(\mathbb{R}^d, d\geq1\)</span>, se estiman (insesgadamente) los valores semivariográficos para un número determinado de distancias, por el método de los momentos:
<span class="math display">\[\begin{equation}
\hat{\gamma} (\mathbf{h}) = \frac{1}{2\#N(\mathbf{h})}\sum\limits_{N(\mathbf{h})} {\left( {Z(\mathbf{s}_i + \mathbf{h}) - Z({\mathbf{s}}_i )} \right)^2},
\end{equation}\]</span>
donde <span class="math inline">\(\#N(\mathbf{h})\)</span> es el número de parejas de localizaciones separadas por el vector <span class="math inline">\(\mathbf{h}\)</span>.</p>
<p>La función que mejor ajusta las estimaciones de los valores semivariográficos anteriormente referidos se denomina <strong>semivariograma empírico</strong> y se suele denotar por <span class="math inline">\(\hat{\gamma} (\mathbf{h})\)</span>.</p>
<p>
Los valores semivariográficos se suelen computar para distancias inferiores a la mitad del diámetro de <em>D</em>, porque para distancias superiores el número de parejas de localizaciones suele ser pequeño para proporcionar estimaciones fiables. En la práctica, como en muchas de las direcciones no hay un número de parejas suficiente para calcular el semivariograma con cierta fiabilidad, lo habitual es construir un <strong>semivariograma empírico omnidireccional</strong>, es decir, que depende solo de la distancia (longitud del vector <strong>h</strong>) y no de la dirección. Para ello se crean <strong>regiones de tolerancia</strong>, que no se solapen, basadas en intervalos de distancia (normalmente de la misma longitud) y un <strong>ángulo de tolerancia</strong>. En concreto, la tolerancia se especifica en el módulo de <span class="math inline">\(\mathbf h\)</span> (<span class="math inline">\(\pm\Delta |\mathbf h|\)</span>) y en su dirección (<span class="math inline">\(\pm\Delta\theta\)</span>). Para más detalles y ejemplos, véase <span class="citation">J. M. Montero, Fernández-Avilés, and Mateu (<a href="referncias.html#ref-montero2015spatial">2015</a>)</span>.</p>
<p> </p>
<p>La Fig. <a href="geo.html#fig:plot-semivar-emp">41.7</a> muestra la ubicación de los puntos semivariográficos, indicando el número de parejas a cada distancia, en el caso de las temperaturas máximas en España (06/08/2022).</p>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vgm_tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/variogram.html">variogram</a></span><span class="op">(</span><span class="va">tmax</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">temp_max_utm_sf</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">250000</span> <span class="co"># 250 km</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">vgm_tmax</span>, plot.numbers <span class="op">=</span> <span class="cn">TRUE</span>, pch <span class="op">=</span> <span class="st">"+"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-semivar-emp"></span>
<img src="img/emp-semivar.png" alt="Valores semivariográficos. Temperaturas máximas (06/08/2022)." width="60%"><p class="caption">
Figura 41.7: Valores semivariográficos. Temperaturas máximas (06/08/2022).
</p>
</div>
<p>En el ejemplo ilustrado, la distancia mínima entre dos estaciones meteorológicas es 1.125 m y la máxima 1.027.597 m. Sin embargo, dada la geometría del mapa de España (aunque de Huelva a Gerona hay 987 km en línea recta, más de dos terceras partes de las ciudades españolas no están separadas más de 500 km), se consideró 250.000 m (1/4 de la distancia máxima) como distancia máxima a la hora de calcular los valores semivariográficos, ya que a partir de dicha distancia el número de parejas no es lo suficientemente grande como para obtener resultados fiables. Por convenio, <code>gstat</code> divide la distancia en 15 intervalos (<code>geoR</code> la divide en 13 porque los autores lo hicieron un viernes 13). </p>
</div>
<div id="ajuste-semivariográfico" class="section level3" number="41.3.4">
<h3>
<span class="header-section-number">41.3.4</span> Ajuste semivariográfico<a class="anchor" aria-label="anchor" href="#ajuste-semivariogr%C3%A1fico"><i class="fas fa-link"></i></a>
</h3>
<p> </p>
<p>Cualquier función que dependa de una distancia y una dirección no es necesariamente un semivariograma, pues para ello tienen que cumplir los requisitos especificados en la Sec. <a href="geo.html#semivariograma">41.3.1</a>. Esta es la razón por la que el semivariograma empírico no puede utilizarse directamente para realizar predicciones geoestadísticas. Por ello, a los valores semivariográficos estimados se les ajusta una función que represente un semivariograma válido. Sin embargo, esta tarea, clave para el éxito del posterior proceso predictivo, no es sencilla ni existe consenso en torno a ella.
El ajuste puede ser <strong>manual</strong>, utilizando métodos visuales y gráficos, o <strong>automático</strong>, que usa procedimientos estadísticos. Una combinación de ambos es muy recomendable. </p>
<p>El ajuste manual pudiera parecer “no muy científico” pero, dado que lo más importante a la hora del ajuste no es tanto la bondad del ajuste para todos los puntos semivariográficos sino lo bien que un semivariograma válido representa las principales características del fenómeno, especialmente el tipo de estacionariedad (comportamiento a largas distancias) y, sobre todo, el tipo de continuidad (comportamiento cerca del origen), resulta ser un procedimiento muy práctico si se guía por las anteriores consideraciones. En este sentido, cualquier conocimiento sobre el fenómeno en estudio es bienvenido.</p>
<p>El ajuste automatizado mediante procedimientos estadísticos incluye los <strong>métodos de mínimos cuadrados</strong> (tanto ordinarios como generalizados y ponderados ), que son los más populares en la práctica, y los <strong>métodos basados en máxima verosimilitud</strong>, que incluyen, entre otros, el tradicional método máximo verosímil, la máxima verosimilitud restringida y el método de la verosimilitud compuesta. </p>
<p>La Fig. <a href="geo.html#fig:plot-fit-semivar">41.8</a> muestra el semivariograma empírico correspondiente a los puntos semivariográficos de la Fig. <a href="geo.html#fig:plot-semivar-emp">41.7</a>. De todos los modelos con meseta, el semivariograma ajustado ha sido un exponencial con alcance 76.404,64 metros y meseta 13,74.</p>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_vgm_tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/fit.variogram.html">fit.variogram</a></span><span class="op">(</span><span class="va">vgm_tmax</span>,</span>
<span>                              model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/vgm.html">vgm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sph"</span>, <span class="st">"Exp"</span>, <span class="st">"Gau"</span>, <span class="st">"Nug"</span>, <span class="st">"Bes"</span>, <span class="st">"Wav"</span><span class="op">)</span><span class="op">)</span>, fit.sills <span class="op">=</span> <span class="cn">TRUE</span>, fit.ranges <span class="op">=</span> <span class="cn">TRUE</span>, fit.kappa <span class="op">=</span> <span class="cn">TRUE</span>, fit.method <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fit_vgm_tmax</span></span>
<span><span class="co">#&gt;   model    psill    range</span></span>
<span><span class="co">#&gt;1   Exp 13.74102 76404.64</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">fit_vgm_tmax</span>, <span class="st">"SSErr"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 6.200657e-07</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">vgm_tmax</span>, <span class="va">fit_vgm_tmax</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"2"</span>, pch <span class="op">=</span> <span class="st">"*"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-fit-semivar"></span>
<img src="img/emp-teo-semivar.png" alt="Semivariograma empírico. Temperaturas máximas (06/08/2022)." width="60%"><p class="caption">
Figura 41.8: Semivariograma empírico. Temperaturas máximas (06/08/2022).
</p>
</div>
<p>El método de ajuste ha sido el que figura por defecto en la función <code>vgm</code>: mínimos cuadrados ponderados con ponderaciones <span class="math inline">\(\frac {N_{\bf |h|}} {|\bf h|^2}\)</span>, que funciona bien en la práctica y selecciona el semivariograma que mejor ajusta cuando el número de parejas es elevado y la distancia pequeña, que es la parte del semivariograma que hay que ajustar bien porque a pequeñas distancias es cuando más dependencia espacial hay. Respecto a los parámetros iniciales, aunque el investigador puede especificar los que considere convenientes, se recomienda utilizar los que tiene la función por defecto: <span class="math inline">\((i)\)</span> alcance igual a 1/3 de la distancia máxima en la muestra; <span class="math inline">\((ii)\)</span> como efecto pepita se toma la media de los tres primeros valores semivariográficos; y <span class="math inline">\((iii)\)</span> como meseta parcial (meseta menos efecto pepita), la media de los cinco últimos valores semivariográficos.</p>
<p> </p>
</div>
</div>
<div id="kriging" class="section level2" number="41.4">
<h2>
<span class="header-section-number">41.4</span> <em>Kriging</em><a class="anchor" aria-label="anchor" href="#kriging"><i class="fas fa-link"></i></a>
</h2>
<p>Seleccionado el semivariograma válido que mejor se ajusta a los puntos semivariográficos, se aborda el proceso predictivo. El método predictivo que usa la geoestadística es conocido como <strong><em>kriging</em></strong> en honor al ingeniero de minas D.G. Krige. </p>
<p>El <em>kriging</em> tiene como objetivo predecir el valor de una <em>f.a.</em>, <span class="math inline">\(Z(\mathbf{s})\)</span>, en uno o más puntos (o bloques) no observados, a partir de la regionalización observada (pueden ser puntos o bloques) en un
dominio , y proporciona el mejor predictor lineal insesgado
de la <em>v.r.</em> de interés en tales puntos o bloques no observados.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;En lo que sigue, la exposición se centrará en la predicción puntual a partir de datos puntuales (es decir, en el soporte puntual). La generalización a bloques puede verse en &lt;span class="citation"&gt;J. M. Montero, Fernández-Avilés, and Mateu (&lt;a href="referncias.html#ref-montero2015spatial"&gt;2015&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>272</sup></a> La limitación a la clase de predictores lineales
obedece a que, bajo estacionariedad de segundo orden, solo se requiere el conocimiento de los momentos de segundo orden de la <em>f.a.</em> Con más información estructural, pueden definirse predictores no lineales.</p>
<p>Las principales ventajas del <em>kriging</em> sobre los métodos de interpolación espacial deterministas (método de la distancia inversa, <em>splines</em>, regresión polinomial, etc.), es que (<span class="math inline">\(i\)</span>) considera la estructura de la dependencia espacial (dando lugar a mejores predicciones), (<span class="math inline">\(ii\)</span>) proporciona, junto con la predicción, la varianza del error de predicción y (<span class="math inline">\(iii\)</span>) es un interpolador exacto.</p>
<p>Dependiendo del tipo de estacionariedad que se considere en la <em>f.a.</em> el <em>kriging</em> puede ser universal (no estacionariedad en media) u ordinario (estacionariedad de segundo orden o intrínseca). Este manual se centra en el <strong><em>kriging</em> ordinario</strong> (KO). La generalización al caso universal (hay deriva: la media depende de las localizaciones en vez de ser constante) puede verse en <span class="citation">J. M. Montero, Fernández-Avilés, and Mateu (<a href="referncias.html#ref-montero2015spatial">2015</a>)</span>.</p>
<p>En términos formales, KO se plantea como sigue: Sea <span class="math inline">\(Z =\left\{ Z(\mathbf{s}),\,\, \mathbf{s} \in D\right\}\)</span> una <em>f.a.</em> con estacionariedad de segundo orden o intrínseca y con media desconocida (cuando se conoce, KO se denomina <strong><em>kriging</em> simple</strong>). Sea el <strong>predictor lineal krigeado</strong> <span class="math inline">\(Z^{\ast} (\mathbf{s}_0 ) = \sum\limits_{i = 1}^n {\lambda _i } Z(\mathbf{s}_i )\)</span>, donde las ponderaciones <span class="math inline">\(\lambda _i, i=1,2,...,n\)</span> se obtienen imponiendo al error de predicción las condiciones de esperanza nula y mínima varianza.<br><br></p>
<p>El sistema de ecuaciones que proporciona dichas ponderaciones óptimas es:
<span class="math display">\[\begin{equation}  
\left\{ {\begin{array}{l}
\sum\limits_{j = 1}^n {\lambda _j \gamma (\mathbf{s}_i - \mathbf{s}_j)
+ \alpha = \gamma (\mathbf{s}_i - \mathbf{s}_0 ), \quad \ i = 1,...,n} \\
\sum\limits_{i = 1}^n {\lambda _i = 1}, \; \\
\end{array}} \right.
\end{equation}\]</span>
siendo la <strong>varianza del error de predicción</strong>:
<span class="math inline">\(\sigma_{OK}^2 (\mathbf{s}_0) = \sum\limits_{i = 1}^n {\lambda _i \gamma (\mathbf{s}_i - \mathbf{s}_0 ) + \alpha }\)</span>, donde <span class="math inline">\(\alpha\)</span> es el multiplicador de Lagrange involucrado en el proceso de optimización.</p>
<p>Retomando el ejemplo de las temperaturas máximas en la España peninsular el 6 de agosto de 2022, a continuación se muestra el código necesario para la creación de un <em>mapping</em> de predicción de dichas temperaturas.</p>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kriged_tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">krige</a></span><span class="op">(</span><span class="va">tmax</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  <span class="va">temp_max_utm_sp</span>,</span>
<span>  <span class="va">grd_sp</span>,</span>
<span>  model <span class="op">=</span> <span class="va">fit_vgm_tmax</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [using ordinary kriging]</span></span></code></pre></div>
<div class="sourceCode" id="cb628"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kriged_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">kriged_tmax</span>, xy <span class="op">=</span> <span class="cn">T</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">kriged_df</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">coords.x1</span>, y <span class="op">=</span> <span class="va">coords.x2</span>, fill <span class="op">=</span> <span class="va">var1.pred</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ESP_utm</span>, col <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">pal_paper</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">br_paper</span>,</span>
<span>    labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"º"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"Temp. max."</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-kriging-pred"></span>
<img src="img/tmax-kriged.png" alt="$Mapping$ de temperaturas máximas (06/08/2022)." width="85%"><p class="caption">
Figura 41.9: <span class="math inline">\(Mapping\)</span> de temperaturas máximas (06/08/2022).
</p>
</div>
<p>El <em>mapping</em> de la Fig. <a href="geo.html#fig:plot-kriging-pred">41.9</a> tiene poco valor si no se acompaña de otro que muestre la desviación típica de los errores de predicción. </p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">kriged_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour_filled</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">coords.x1</span>, <span class="va">coords.x2</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var1.var</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2.5</span>, <span class="fl">3</span>, <span class="fl">3.5</span>, <span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">kriged_df</span><span class="op">$</span><span class="va">var1.var</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ESP_utm</span>, col <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_max_utm_sf</span>, col <span class="op">=</span> <span class="st">"blue"</span>, shape <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span> <span class="co"># paleta colores</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"springgreen"</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"PuRd"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Desv. típica\n error predicción"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-sd-error"></span>
<img src="img/tmax-sd-error.png" alt="Desviaciones típicas del error de predicción." width="85%"><p class="caption">
Figura 41.10: Desviaciones típicas del error de predicción.
</p>
</div>
<p>Como se aprecia en la Fig. <a href="geo.html#fig:plot-sd-error">41.10</a>, cuanto mayor es el número de localizaciones observadas alrededor del punto de predicción, menor es la desviación típica del error de predicción.
</p>
<div id="resumen-40" class="section level3 unnumbered infobox_resume">
<h3>Resumen<a class="anchor" aria-label="anchor" href="#resumen-40"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>La geoestadística estudia los fenómenos regionalizados, que son aquellos que se extienden en el espacio y presentan una organización o estructura debida a la dependencia espacial existente.</p></li>
<li><p>Su objetivo es sacar provecho de dicha dependencia espacial para llevar a cabo predicciones (interpolaciones) óptimas en ubicaciones o áreas de interés, o la realización de <em>mappings</em> sobre todo el dominio o parte de él.</p></li>
<li><p>Las dos partes del análisis geoestadístico son: <span class="math inline">\((i)\)</span> el análisis estructural de la dependencia espacial y <span class="math inline">\((ii)\)</span> la predicción “krigeada”.</p></li>
<li><p>La estructura de dependencia espacial se representa mediante un semivariograma. La elección del semivariograma entre el elenco de funciones semivariográficas válidas es la clave del éxito de la predicción geoestadística, y por ello al semivariograma se le considera la piedra angular de la geoestadística.</p></li>
<li><p>La técnica que utiliza la geoestadística para predecir se denomina <em>kriging</em> y presenta un buen número de ventajas sobre los tradicionales métodos de interpolación espacial deterministas al considerar la estructura espacial de las observaciones.</p></li>
</ul>
</div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="datos-espaciales.html"><span class="header-section-number">40</span> Trabajando con datos espaciales</a></div>
<div class="next"><a href="cap-econom-esp.html"><span class="header-section-number">42</span> Modelos econométricos espaciales</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Índice del capítulo"><h2>Índice del capítulo</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#geo"><span class="header-section-number">41</span> Geoestadística</a></li>
<li><a class="nav-link" href="#introducci%C3%B3n-21"><span class="header-section-number">41.1</span> Introducción</a></li>
<li><a class="nav-link" href="#preliminares-geo"><span class="header-section-number">41.2</span> Preliminares</a></li>
<li>
<a class="nav-link" href="#ana-estructural"><span class="header-section-number">41.3</span> Análisis estructural de la dependencia espacial</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#semivariograma"><span class="header-section-number">41.3.1</span> Semivariograma</a></li>
<li><a class="nav-link" href="#modelos-de-semivariogramas-v%C3%A1lidos"><span class="header-section-number">41.3.2</span> Modelos de semivariogramas válidos</a></li>
<li><a class="nav-link" href="#semivariograma-emp%C3%ADrico"><span class="header-section-number">41.3.3</span> Semivariograma empírico</a></li>
<li><a class="nav-link" href="#ajuste-semivariogr%C3%A1fico"><span class="header-section-number">41.3.4</span> Ajuste semivariográfico</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#kriging"><span class="header-section-number">41.4</span> Kriging</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#resumen-40">Resumen</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentos de ciencia de datos con <strong>R</strong></strong>" coordinado por <a href="https://blog.uclm.es/gemafaviles/" class="text-light">Gema Fernández-Avilés y José-María Montero</a>. Generado por última vez el día 2023-11-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro ha sido generado con el paquete de R <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
